

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/logo.png">
  <link rel="icon" href="/img/logo.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Dr.626">
  <meta name="keywords" content="">
  
    <meta name="description" content="用Python编写的Web应用程序框架，基于Werkzeug WSGI工具包和Jinja2模板引擎，由Armin Ronacher带领Pocco团队开发。">
<meta property="og:type" content="article">
<meta property="og:title" content="Python Flask">
<meta property="og:url" content="https://stitch-top.github.io/2021/12/10/python/python13-python-flask/index.html">
<meta property="og:site_name" content="Dr.626">
<meta property="og:description" content="用Python编写的Web应用程序框架，基于Werkzeug WSGI工具包和Jinja2模板引擎，由Armin Ronacher带领Pocco团队开发。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://stitch-top.github.io/img/ThemeMap/3306520481.jpg">
<meta property="article:published_time" content="2021-12-10T14:43:15.000Z">
<meta property="article:modified_time" content="2024-03-08T09:54:04.648Z">
<meta property="article:author" content="Dr.626">
<meta property="article:tag" content="Flask">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://stitch-top.github.io/img/ThemeMap/3306520481.jpg">
  
  
  
  <title>Python Flask - Dr.626</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  



  
<link rel="stylesheet" href="/css/my.css">



  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"stitch-top.github.io","root":"/","version":"1.9.0","typing":{"enable":true,"typeSpeed":70,"cursorChar":"|","loop":true,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":"✍"},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"left","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":1},"lazyload":{"enable":true,"loading_img":"/img/load.gif","onlypost":true,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":false,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":"Jg3BjUa3RtnEFSREy3wsmUR5-MdYXbMMI","app_key":"DwsEb5BeMxwdz0CEJ6MUBdu3","server_url":null,"path":"window.location.pathname","ignore_local":true}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>

  
  
<meta name="generator" content="Hexo 6.2.0"></head>


<body>
  
  

  <header>
    

<div class="header-inner" style="height: 100vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Dr.626</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-link-fill"></i>
                友链
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" target="_self" href="javascript:;" role="button"
                 data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <i class="iconfont icon-code"></i>
                实验室
              </a>
              <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                
                  
                  
                  
                  <a class="dropdown-item" href="/tagsnet">
                    <i class="iconfont icon-bookmark"></i>
                    文章关系网
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/laboratory/plugin">
                    <i class="iconfont icon-bug"></i>
                    Hexo小组件
                  </a>
                
              </div>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/back-1.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="Python Flask"></span>
          
        </div>

        
          
  <div class="mt-3">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-author" aria-hidden="true"></i>
        Dr.626
      </span>
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2021-12-10 22:43" pubdate>
          2021年12月10日 22:43:15
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          70k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          584 分钟
        
      </span>
    

    
    
      
        <span id="leancloud-page-views-container" class="post-meta" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="leancloud-page-views"></span> 次
        </span>
        
      
    
  </div>


        
      </div>

      
        <div class="scroll-down-bar">
          <i class="iconfont icon-arrowdown"></i>
        </div>
      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
  
  <!-- 动态线条背景
  <script type="text/javascript"
  color="0 0 255" opacity='1' zIndex="-2" count="200" src="../js/canvas-nest.js">
  </script> -->
  
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="padding-left: 2rem; margin-right: -1rem">
    <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">Python Flask</h1>
            
            <div class="markdown-body">
              
              <p>用Python编写的Web应用程序框架，基于Werkzeug WSGI工具包和Jinja2模板引擎，由Armin Ronacher带领Pocco团队开发。</p>
<span id="more"></span>



<h1 id="1-微框架"><a href="#1-微框架" class="headerlink" title="1 微框架"></a>1 微框架</h1><ul>
<li>微框架<ul>
<li>WSGI：Web服务器的网关接口，Web服务器和Web应用程序之间通用接口的规范。</li>
<li>Werkzeug：一个WSGI工具包，实现了请求、响应对象和实用函数，能在上面构建Web框架。</li>
<li>jinja2：Python的一个流行模板引擎，Web模板系统将模板与特定数据源组合以呈现动态网页。</li>
<li>命令窗口下使用PIP进行安装：<code>pip install Flask</code>，测试是否安装成功，新建hello.py文件。<ul>
<li><code>app.route(rule, options)</code><ul>
<li>route()函数是一个装饰器，告诉应用程序哪个URL应该调用相关的函数。</li>
<li>rule表示与该函数的URL绑定，options是转发给基础rule对象的参数列表。</li>
</ul>
</li>
<li><code>app.run(host, port, debug, options)</code><ul>
<li>host：主机名，默认为127.0.0.1(localhost)，设为0.0.0.0以使服务器在外部可用。</li>
<li>port：端口号，默认值为5000。</li>
<li>debug：默认false，设为true提供调试信息。</li>
<li>options：要转发到底层的Werkzeug服务器。</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask       <span class="hljs-comment"># hello.py文件，导入Flask模块验证测试</span><br><br>app = Flask(__name__)         <span class="hljs-comment"># Flask构造函数使用当前模块__name的名称作为参数</span><br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)               </span><span class="hljs-comment"># Flask类的route()函数是一个装饰器，告诉应用程序哪个URL应调用相关的函数</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">hello_world</span>():            <span class="hljs-comment"># &#x27;/&#x27;URL与函数绑定，浏览器访问[127.0.0.1:5000]时，显示&#x27;Hello World!&#x27;</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&lt;center&gt;Hello World!&lt;/center&gt;&#x27;</span><br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:    <span class="hljs-comment"># Flask中文网：https://flask.net.cn/</span><br>    app.run()                 <span class="hljs-comment"># Flask类的run()方法是在本地开发服务器上运行应用程序</span><br></code></pre></td></tr></table></figure>



<h2 id="1-1-验证测试"><a href="#1-1-验证测试" class="headerlink" title="1-1 验证测试"></a>1-1 验证测试</h2><ul>
<li>验证测试<ul>
<li>命令窗口进入hello.py文件对应的目录中，<code>python hello.py</code>执行命令。</li>
<li>在浏览器的任务栏中输入“<a target="_blank" rel="noopener" href="http://127.0.0.1:5000/">http://127.0.0.1:5000/</a>”，回车进行查看。</li>
</ul>
</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs Powershell">python hello.py<br><br> * Serving Flask app <span class="hljs-string">&quot;hello&quot;</span> (lazy loading)<br> * Environment: production<br>   WARNING: This is a development server. <span class="hljs-keyword">Do</span> not use it <span class="hljs-keyword">in</span> a production deployment.     <br>   Use a production WSGI server instead.<br> * Debug mode: off<br> * Running on http://<span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">5000</span>/ (Press CTRL+C to quit)<br><br><span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span> - - [<span class="hljs-number">01</span>/<span class="hljs-type">Oct</span>/<span class="hljs-number">2023</span> <span class="hljs-number">17</span>:<span class="hljs-number">07</span>:<span class="hljs-number">14</span>] <span class="hljs-string">&quot;GET / HTTP/1.1&quot;</span> <span class="hljs-number">200</span> -<br></code></pre></td></tr></table></figure>



<h2 id="1-2-调试模式"><a href="#1-2-调试模式" class="headerlink" title="1-2 调试模式"></a>1-2 调试模式</h2><ul>
<li>调试模式<ul>
<li>当应用程序处于开发状态时，如果代码进行了更改，则需要每次都重启更新，操作十分不便。</li>
<li>为了避免频繁手动重启更新，可以开启调试模式，如果代码更改了，服务器将自行重新加载。</li>
<li>调试模式还提供了一个有用的调试器，用于跟踪应用程序中的错误，有两种语法格式的书写。</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask<br><br>app = Flask(__name__)<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">hello_world</span>():            <span class="hljs-comment"># 浏览器访问[127.0.0.1:5000]时，显示&#x27;Hello World!&#x27;</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&lt;center&gt;Hello World!&lt;/center&gt;&#x27;</span><br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.debug = <span class="hljs-literal">True</span>          <span class="hljs-comment"># 调试模式下，若代码更改，服务器将自行重新加载</span><br>    app.run()                 <span class="hljs-comment"># 还提供了一个有用的调试器来跟踪应用程序中的错误</span><br>    <span class="hljs-comment"># app.run(debug=True)     # 或将run与debug写成一个函数带参形式</span><br></code></pre></td></tr></table></figure>



<h2 id="1-3-路由技术"><a href="#1-3-路由技术" class="headerlink" title="1-3 路由技术"></a>1-3 路由技术</h2><ul>
<li>路由技术<ul>
<li>route()装饰器用于将URL与函数进行绑定，可直接访问想访问的页面，不用再从主页开始导航了。</li>
<li>若URL‘&#x2F;hello’规则绑定到hello_world()函数，则浏览器访问“<a target="_blank" rel="noopener" href="http://localhost:5000/hello">http://localhost:5000/hello</a>”。</li>
<li>add_url_rule()函数也可以用于将URL与函数进行绑定。</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask<br><br>app = Flask(__name__)<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/hello&#x27;</span></span>)          </span><span class="hljs-comment"># 访问[http://127.0.0.1:5000/hello]</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">hello_world</span>():<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&lt;center&gt;Hello World!&lt;/center&gt;&#x27;</span><br><br><br>app.add_url_rule(             <span class="hljs-comment"># 访问[http://127.0.0.1:5000/]，可替代route()装饰器</span><br>    <span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-string">&#x27;hello&#x27;</span>, hello_world<br>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.run(debug=<span class="hljs-literal">True</span>)<br></code></pre></td></tr></table></figure>



<h4 id="1-URL构建"><a href="#1-URL构建" class="headerlink" title="(1) URL构建"></a>(1) URL构建</h4><ul>
<li>变量规则<ul>
<li>route()装饰器通过向规则参数添加变量部分，可动态构建URL：<code>route(/&lt;name&gt;/&lt;variable-name&gt;)</code>。</li>
<li>除默认字符串变量部分外，还可使用转换器构建规则：int、float、path(接受用作目录分隔符的斜杠)。<ul>
<li>字符串变量：若访问“<a target="_blank" rel="noopener" href="http://127.0.0.1:5000/hello/Aha">http://127.0.0.1:5000/hello/Aha</a>”，显示“Hello Aha!”。</li>
<li>int整数：若访问“<a target="_blank" rel="noopener" href="http://127.0.0.1:5000/blog/27">http://127.0.0.1:5000/blog/27</a>”，显示“Blog Number 27.”。</li>
<li>float浮点数：若访问“<a target="_blank" rel="noopener" href="http://127.0.0.1:5000/rev/2.7">http://127.0.0.1:5000/rev/2.7</a>”，显示“Revision Number 2.700000.”。</li>
<li>path目录分隔符<ul>
<li>若访问“<a target="_blank" rel="noopener" href="http://127.0.0.1:5000/python/">http://127.0.0.1:5000/python/</a>”，显示“Not Found”。</li>
<li>若访问“<a target="_blank" rel="noopener" href="http://127.0.0.1:5000/python">http://127.0.0.1:5000/python</a>”，显示“Hello Python.”。</li>
<li>访问“<a target="_blank" rel="noopener" href="http://127.0.0.1:5000/golang">http://127.0.0.1:5000/golang</a>”和“<a target="_blank" rel="noopener" href="http://127.0.0.1:5000/golang/">http://127.0.0.1:5000/golang/</a>”都可以正常显示。</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>url_for()函数，接受函数名称作为第一个参数，以及一个或多个关键字参数，每个参数对应于URL的变量部分。<ul>
<li>若访问“<a target="_blank" rel="noopener" href="http://localhost:5000/user/admin">http://localhost:5000/user/admin</a>”，显示“Hello Admin.”。</li>
<li>若访问“<a target="_blank" rel="noopener" href="http://localhost:5000/user/mvl">http://localhost:5000/user/mvl</a>”，显示“Hello mvl as Guest.”。</li>
</ul>
</li>
</ul>
<h5 id="✧-字符串变量"><a href="#✧-字符串变量" class="headerlink" title="✧ 字符串变量"></a>✧ 字符串变量</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask<br><br>app = Flask(__name__)<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/hello/&lt;name&gt;&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">hello_world</span>(<span class="hljs-params">name</span>):        <span class="hljs-comment"># 访问[http://127.0.0.1:5000/hello/Aha]，显示&#x27;Hello Aha!&#x27;</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&lt;center&gt;Hello %s!&lt;/center&gt;&#x27;</span> % name<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.run(debug=<span class="hljs-literal">True</span>)<br></code></pre></td></tr></table></figure>



<h5 id="✧-整数与浮点"><a href="#✧-整数与浮点" class="headerlink" title="✧ 整数与浮点"></a>✧ 整数与浮点</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask<br><br>app = Flask(__name__)<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/blog/&lt;int:postID&gt;&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">show_blog</span>(<span class="hljs-params">postID</span>):        <span class="hljs-comment"># 访问[http://localhost:5000/blog/27]，显示&#x27;Blog Number 27.&#x27;</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&lt;center&gt;Blog Number %d.&lt;/center&gt;&#x27;</span> % postID<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/rev/&lt;float:revNo&gt;&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">revision</span>(<span class="hljs-params">revNo</span>):          <span class="hljs-comment"># 访问[http://localhost:5000/rev/2.7]，显示&#x27;Revision Number 2.700000.&#x27;</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&lt;center&gt;Revision Number %f.&lt;/center&gt;&#x27;</span> % revNo<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.run(debug=<span class="hljs-literal">True</span>)<br></code></pre></td></tr></table></figure>



<h5 id="✧-目录分隔符"><a href="#✧-目录分隔符" class="headerlink" title="✧ 目录分隔符"></a>✧ 目录分隔符</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask<br><br>app = Flask(__name__)<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/python&#x27;</span></span>)         </span><span class="hljs-comment"># 访问[http://127.0.0.1:5000/python/]，显示&#x27;Not Found&#x27;</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">hello_python</span>():           <span class="hljs-comment"># 访问[http://127.0.0.1:5000/python]，显示&#x27;Hello Python.&#x27;</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&lt;center&gt;Hello Python.&lt;/center&gt;&#x27;</span><br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/golang/&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">hello_golang</span>():           <span class="hljs-comment"># 访问[http://127.0.0.1:5000/golang]或[http://127.0.0.1:5000/golang/]</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&lt;center&gt;Hello Golang.&lt;/center&gt;&#x27;</span><br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.run(debug=<span class="hljs-literal">True</span>)<br></code></pre></td></tr></table></figure>



<h5 id="✧-url-for-函数"><a href="#✧-url-for-函数" class="headerlink" title="✧ url_for()函数"></a>✧ url_for()函数</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, redirect, url_for<br><br>app = Flask(__name__)<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/admin&#x27;</span></span>)          </span><span class="hljs-comment"># 访问[http://127.0.0.1:5000/admin]，显示&#x27;Hello Admin.&#x27;</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">hello_admin</span>():<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&lt;center&gt;Hello Admin.&lt;/center&gt;&#x27;</span><br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/guest/&lt;guest&gt;&#x27;</span></span>)  </span><span class="hljs-comment"># 访问[http://127.0.0.1:5000/guest/Admin]</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">hello_guest</span>(<span class="hljs-params">guest</span>):       <span class="hljs-comment"># 显示&#x27;Hello Admin as Guest.&#x27;</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&lt;center&gt;Hello %s as Guest.&lt;/center&gt;&#x27;</span> % guest<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/user/&lt;name&gt;&#x27;</span></span>)    </span><span class="hljs-comment"># 访问[http://127.0.0.1:5000/user/admin]，显示&#x27;Hello Admin.&#x27;</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">hello_user</span>(<span class="hljs-params">name</span>):         <span class="hljs-comment"># 接受来自URL参数的值，检查接收的参数是否与admin匹配</span><br>    <span class="hljs-keyword">if</span> name == <span class="hljs-string">&#x27;admin&#x27;</span>:       <span class="hljs-comment"># 匹配则重定向到hello_admin()函数</span><br>        <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&#x27;hello_admin&#x27;</span>))<br>    <span class="hljs-keyword">else</span>:                     <span class="hljs-comment"># 否则重定向到hello_guest()函数，显示&#x27;Hello &lt;name&gt; as Guest.&#x27;</span><br>        <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&#x27;hello_guest&#x27;</span>, guest=name))<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.run(debug=<span class="hljs-literal">True</span>)<br></code></pre></td></tr></table></figure>



<h4 id="2-请求方法"><a href="#2-请求方法" class="headerlink" title="(2) 请求方法"></a>(2) 请求方法</h4><ul>
<li>HEAD：和GET方法相同，但没有响应体。</li>
<li>GET：以未加密的形式将数据发送到服务器。</li>
<li>PUT：用上传的内容替换目标资源的所有当前表示。</li>
<li>DELETE：删除由URL给出的目标资源的所有当前表示。</li>
<li>POST：用于将HTML表单数据发送到服务器，接收的数据不由服务器缓存。</li>
<li>Flask路由默认响应GET请求，通过route()装饰器提供的方法参数更改请求。<ul>
<li>命令窗口下执行Python脚本开启开发服务器，浏览器打开post.html，输入test后提交。</li>
<li>此时浏览器跳转“<a target="_blank" rel="noopener" href="http://localhost:5000/success/test">http://localhost:5000/success/test</a>”，页面显示“Welcom test.”。</li>
</ul>
</li>
</ul>
<h5 id="✧-post-py"><a href="#✧-post-py" class="headerlink" title="✧ post.py"></a>✧ post.py</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, redirect, url_for, request, render_template<br><br>app = Flask(__name__)<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)               </span><span class="hljs-comment"># 浏览器打开post.html，输入test后提交</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">post</span>():<br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;post.html&#x27;</span>)<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/success/&lt;name&gt;&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">success</span>(<span class="hljs-params">name</span>):            <span class="hljs-comment"># 此时浏览器跳转[http://localhost:5000/success/test]</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&lt;center&gt;Welcome %s.&lt;/center&gt;&#x27;</span> % name<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/login&#x27;</span>, methods=[<span class="hljs-string">&#x27;POST&#x27;</span>, <span class="hljs-string">&#x27;GET&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">login</span>():<br>    <span class="hljs-keyword">if</span> request.method == <span class="hljs-string">&#x27;POST&#x27;</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-number">1</span>)<br>        user = request.form[<span class="hljs-string">&#x27;name&#x27;</span>]<br>        <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&#x27;success&#x27;</span>, name=user))<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-number">2</span>)              <span class="hljs-comment"># args是包含表单参数对及其对应值对的列表字典对象</span><br>        user = request.args.get(<span class="hljs-string">&#x27;name&#x27;</span>)<br>        <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&#x27;success&#x27;</span>, name=user))<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.run(debug=<span class="hljs-literal">True</span>)<br></code></pre></td></tr></table></figure>



<h5 id="✧-post-html"><a href="#✧-post-html" class="headerlink" title="✧ post.html"></a>✧ post.html</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs Html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>请求方法<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;text-align:center;&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;http://localhost:5000/login&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;POST&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>输入姓名<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;name&quot;</span> /&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;提交&quot;</span> /&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure>



<h2 id="1-4-模板引擎"><a href="#1-4-模板引擎" class="headerlink" title="1-4 模板引擎"></a>1-4 模板引擎</h2><ul>
<li>模板引擎<ul>
<li>视图函数的主要作用是生成请求的响应，这是最简单的请求，Flask使用Jinja2这个模板引擎来渲染模板。</li>
<li>视图函数的两个作用是处理业务逻辑，以及返回响应内容，模板则是获取到视图函数的数据结果进行展示。</li>
<li>项目下创建templates文件夹，用于存放所有的模板文件，并且在templates目录下创建mould.html模板文件。</li>
</ul>
</li>
</ul>
<h4 id="1-mould-py"><a href="#1-mould-py" class="headerlink" title="(1) mould.py"></a>(1) mould.py</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, render_template<br><br>app = Flask(__name__)<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)               </span><span class="hljs-comment"># 访问[http://127.0.0.1:5000]</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    my_str = <span class="hljs-string">&#x27;Hello Flask.&#x27;</span>   <span class="hljs-comment"># 往mould.html模板中传入的数据</span><br>    my_int = <span class="hljs-number">27</span><br>    my_dict = &#123;<span class="hljs-string">&#x27;name&#x27;</span>: <span class="hljs-string">&#x27;Lucy&#x27;</span>, <span class="hljs-string">&#x27;age&#x27;</span>: <span class="hljs-number">23</span>&#125;<br>    my_array = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>]<br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;mould.html&#x27;</span>,<br>                           my_str=my_str,<br>                           my_int=my_int,<br>                           my_dict=my_dict,<br>                           my_array=my_array<br>                           )<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.run(debug=<span class="hljs-literal">True</span>)<br></code></pre></td></tr></table></figure>



<h4 id="2-mould-html"><a href="#2-mould-html" class="headerlink" title="(2) mould.html"></a>(2) mould.html</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs Html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>模板引擎<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;text-align:center;&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>模板HTML内容<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span>&#123;&#123; my_str &#125;&#125;<br>    <span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span>&#123;&#123; my_int &#125;&#125;<br>    <span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span>&#123;&#123; my_dict.name &#125;&#125;<br>    <span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span>&#123;&#123; my_dict &#125;&#125;<br>    <span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span>&#123;&#123; my_array &#125;&#125;<br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure>



<h2 id="1-5-静态文件"><a href="#1-5-静态文件" class="headerlink" title="1-5 静态文件"></a>1-5 静态文件</h2><ul>
<li>静态文件<ul>
<li>Web应用程序通常需要静态文件，例如：JavaScript或CSS文件。</li>
<li>一般由应用程序的static文件夹提供，用于生成静态文件的URL。</li>
</ul>
</li>
</ul>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs Markdown">&lt;!-- 项目目录结构 --&gt;<br><span class="hljs-bullet">-</span> static.py<br><span class="hljs-bullet">-</span> static<br><span class="hljs-bullet">    -</span> static.js<br><span class="hljs-bullet">-</span> templates<br><span class="hljs-bullet">    -</span> static.html<br>&lt;!-- 命令窗口下执行&#x27;python static.py&#x27;，访问[http://127.0.0.1:5000] --&gt;<br></code></pre></td></tr></table></figure>



<h4 id="1-static-js"><a href="#1-static-js" class="headerlink" title="(1) static.js"></a>(1) static.js</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs Javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">sayHello</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title function_">alert</span>(<span class="hljs-string">&#x27;Hello World!&#x27;</span>)<br>&#125;<br></code></pre></td></tr></table></figure>



<h4 id="2-static-py"><a href="#2-static-py" class="headerlink" title="(2) static.py"></a>(2) static.py</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, render_template<br><br>app = Flask(__name__)<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)               </span><span class="hljs-comment"># 访问[http://127.0.0.1:5000]</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_static</span>():<br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;static.html&#x27;</span>)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.run(debug=<span class="hljs-literal">True</span>)<br></code></pre></td></tr></table></figure>



<h4 id="3-static-html"><a href="#3-static-html" class="headerlink" title="(3) static.html"></a>(3) static.html</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs Html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>静态文件<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;&#123;&#123; url_for(&#x27;static&#x27;, filename=&#x27;static.js&#x27;) &#125;&#125;&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;text-align:center;&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;button&quot;</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">&quot;sayHello()&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;你好呀！&quot;</span> /&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure>



<h1 id="2-核心内容"><a href="#2-核心内容" class="headerlink" title="2 核心内容"></a>2 核心内容</h1><ul>
<li>核心内容<ul>
<li>来自客户端网页的数据作为全局请求对象发送到服务器，为处理请求数据，应从Flask模块导入。</li>
<li>请求对象的属性<ul>
<li>args(解析查询字符串的内容，是问号之后URL的一部分)。</li>
<li>files(与上传文件有关的数据)、cookies(保存Cookie名称和值的字典对象)。</li>
<li>method(当前请求方法)、form(字典对象，包含表单参数及其值的键值对)。</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="2-1-表单展示"><a href="#2-1-表单展示" class="headerlink" title="2-1 表单展示"></a>2-1 表单展示</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, render_template, request<br><br>app = Flask(__name__)<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)                     </span><span class="hljs-comment"># &#x27;/&#x27;URL呈现表单网页stufill.html</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">stufill</span>():<br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;stufill.html&#x27;</span>)<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/stushow&#x27;</span>, methods=[<span class="hljs-string">&#x27;POST&#x27;</span>, <span class="hljs-string">&#x27;GET&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">stushow</span>():                      <span class="hljs-comment"># 填入的数据将发布到触发stushow()函数的&#x27;/stushow&#x27;URL</span><br>    <span class="hljs-keyword">if</span> request.method == <span class="hljs-string">&#x27;POST&#x27;</span>:    <span class="hljs-comment"># 函数收集request.form中存在的表单数据，并将其发送给stushow.html</span><br>        stushow = request.form      <span class="hljs-comment"># 以字典对象的形式收集并将其转发到stushow.html，呈现在相应的网页上</span><br>        <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;stushow.html&#x27;</span>, result=stushow)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.run(debug=<span class="hljs-literal">True</span>)             <span class="hljs-comment"># 访问[http://localhost:5000]，输入表单数据提交</span><br></code></pre></td></tr></table></figure>



<h4 id="1-stufill-html"><a href="#1-stufill-html" class="headerlink" title="(1) stufill.html"></a>(1) stufill.html</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs Html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>数据填写<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;text-align:center;&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;http://localhost:5000/stushow&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;POST&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>姓名 <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span> = <span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">name</span> = <span class="hljs-string">&quot;姓名&quot;</span> /&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>语文 <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span> = <span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">name</span> = <span class="hljs-string">&quot;语文&quot;</span> /&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>数学 <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span> = <span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">name</span> = <span class="hljs-string">&quot;数学&quot;</span> /&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>英语 <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span> = <span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">name</span> = <span class="hljs-string">&quot;英语&quot;</span> /&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span> = <span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">value</span> = <span class="hljs-string">&quot;提交&quot;</span> /&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure>



<h4 id="2-stushow-html"><a href="#2-stushow-html" class="headerlink" title="(2) stushow.html"></a>(2) stushow.html</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs Html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>表单展示<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="language-css"></span><br><span class="language-css">        <span class="hljs-selector-tag">body</span> &#123;<span class="hljs-attribute">text-align</span>: center;&#125; <span class="hljs-selector-tag">table</span> &#123;<span class="hljs-attribute">margin</span>: auto;&#125;</span><br><span class="language-css">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">table</span> <span class="hljs-attr">border</span>=<span class="hljs-string">&quot;1&quot;</span> <span class="hljs-attr">cellspacing</span>=<span class="hljs-string">&quot;0&quot;</span>&gt;</span><br>    &#123;% for key, value in result.items() %&#125;<br>        <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>&#123;&#123; key &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>&#123;&#123; value &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br>    &#123;% endfor %&#125;<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure>



<h2 id="2-2-Cookies"><a href="#2-2-Cookies" class="headerlink" title="2-2 Cookies"></a>2-2 Cookies</h2><ul>
<li>Cookies<ul>
<li>以文本形式存储于客户端，记录与跟踪用户数据，获得更好的访问者体验和网站统计信息，处理步骤如下。</li>
<li>设置cookie：默认是临时cookie，浏览器关闭立即失效，通过max_age设置有效期，单位是秒。</li>
<li>获取cookie：通过request.cookies的方式获取，返回的是一个字典，可以获取字典里的相应值。</li>
<li>删除cookie：这里删除只是让cookie过期，而非直接删除，通过delete_cookie()方式进行删除。</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, make_response, request<br><br>app = Flask(__name__)<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/set_cookies&#x27;</span></span>)          </span><span class="hljs-comment"># [127.0.0.1:5000/set_cookies]，F12查看Set-Cookie的value值</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">set_cookies</span>():<br>    resp = make_response(<span class="hljs-string">&#x27;&lt;center&gt;success&lt;/center&gt;&#x27;</span>)<br>    resp.set_cookie(<span class="hljs-string">&#x27;flask&#x27;</span>, <span class="hljs-string">&#x27;flask&#x27;</span>, max_age=<span class="hljs-number">3600</span>)<br>    <span class="hljs-keyword">return</span> resp<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/get_cookies&#x27;</span></span>)          </span><span class="hljs-comment"># [http://127.0.0.1:5000/get_cookies]，页面输出cookies信息</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_cookies</span>():<br>    cookie = request.cookies.get(<span class="hljs-string">&#x27;flask&#x27;</span>)<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&lt;center&gt;&#x27;</span> + cookie + <span class="hljs-string">&#x27;&lt;/center&gt;&#x27;</span><br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/delete_cookies&#x27;</span></span>)       </span><span class="hljs-comment"># [http://127.0.0.1:5000/delete_cookies]，F12查看cookies已删(过期)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">delete_cookies</span>():<br>    resp = make_response(<span class="hljs-string">&#x27;&lt;center&gt;del success&lt;/center&gt;&#x27;</span>)<br>    resp.delete_cookie(<span class="hljs-string">&#x27;flask&#x27;</span>)<br>    <span class="hljs-keyword">return</span> resp<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.run(debug=<span class="hljs-literal">True</span>)<br></code></pre></td></tr></table></figure>



<h2 id="2-3-会话工作"><a href="#2-3-会话工作" class="headerlink" title="2-3 会话工作"></a>2-3 会话工作</h2><ul>
<li>会话工作<ul>
<li>session，客户端登录到服务器并注销服务器的时间间隔，在会话中保存的数据会存储在服务器的临时目录中。</li>
<li>为每个客户端的会话分配会话ID，会话数据存储在cookie的顶部，服务器以加密方式对其进行签名。</li>
<li>Flask需要定义的secret_key进行加密，session也是一个字典对象，包含会话变量和关联值的键值对。<ul>
<li><code>Session[&#39;username&#39;] = &#39;admin&#39;</code>：设置username会话变量。</li>
<li><code>session.pop(&#39;username&#39;, None)</code>：释放username会话变量。</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, session, redirect, url_for, request<br><br>app = Flask(__name__)               <span class="hljs-comment"># 访问[http://127.0.0.1:5000]，确保设置应用程序的secret_key</span><br>app.secret_key = <span class="hljs-string">&#x27;flask session&#x27;</span><br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)                     </span><span class="hljs-comment"># 提示用户登录，未设置会话变量username</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;username&#x27;</span> <span class="hljs-keyword">in</span> session:<br>        username = session[<span class="hljs-string">&#x27;username&#x27;</span>]<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&lt;center&gt;登录用户名：&#x27;</span> + username + <span class="hljs-string">&#x27;，&#x27;</span> + \<br>               <span class="hljs-string">&#x27;&lt;b&gt;&lt;a href=&quot;/logout&quot;&gt;点击这里退出&lt;/a&gt;&lt;/b&gt;&#x27;</span> + <span class="hljs-string">&#x27;。&lt;/center&gt;&#x27;</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&lt;center&gt;您暂未登录，&lt;a href=&quot;/login&quot;&gt;&lt;/b&gt;&#x27;</span> + <span class="hljs-string">&#x27;点击这里登录&lt;/b&gt;&lt;/a&gt;&#x27;</span> + <span class="hljs-string">&#x27;。&lt;/center&gt;&#x27;</span><br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/login&#x27;</span>, methods=[<span class="hljs-string">&#x27;GET&#x27;</span>, <span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">login</span>():                        <span class="hljs-comment"># login()视图函数，通过GET方法调用，打开一个登录表单</span><br>    <span class="hljs-keyword">if</span> request.method == <span class="hljs-string">&#x27;POST&#x27;</span>:    <span class="hljs-comment"># 此时会话变量已设置，应用程序重定向到&#x27;/&#x27;，会话变量username被找到</span><br>        session[<span class="hljs-string">&#x27;username&#x27;</span>] = request.form[<span class="hljs-string">&#x27;username&#x27;</span>]<br>        <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&#x27;index&#x27;</span>))<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">    &lt;form action=&#x27;&#x27; method=&#x27;POST&#x27; style=&quot;text-align:center;&quot;&gt;</span><br><span class="hljs-string">        &lt;p&gt;&lt;input type=&#x27;text&#x27; name=&#x27;username&#x27; /&gt;&lt;/p&gt;</span><br><span class="hljs-string">        &lt;p&gt;&lt;input type=&#x27;submit&#x27; value=&#x27;登录&#x27; /&gt;&lt;/p&gt;</span><br><span class="hljs-string">    &lt;/form&gt;</span><br><span class="hljs-string">    &#x27;&#x27;&#x27;</span><br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/logout&#x27;</span></span>)               </span><span class="hljs-comment"># logout()视图函数，弹出username会话变量，&#x27;/&#x27;URL再次显示开始页面</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">logout</span>():<br>    session.pop(<span class="hljs-string">&#x27;username&#x27;</span>, <span class="hljs-literal">None</span>)<br>    <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&#x27;index&#x27;</span>))<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.run(debug=<span class="hljs-literal">True</span>)<br></code></pre></td></tr></table></figure>



<h2 id="2-4-Redirect"><a href="#2-4-Redirect" class="headerlink" title="2-4 Redirect"></a>2-4 Redirect</h2><ul>
<li>Redirect<ul>
<li>函数调用时返回一个响应对象，并将用户重定向到具有指定状态代码的另一目标位置。</li>
<li>redirect()重定向函数原型：<code>Flask.redirect(location, statuscode, response)</code>。</li>
<li>location(重定向响应的URL)、statuscode(发送到浏览器标头，默认302)、response(用于实例化响应)。</li>
<li>状态代码标准化<ul>
<li>HTTP_300_MULTIPLE_CHOICES、HTTP_301_MOVED_PERMANENTLY。</li>
<li>HTTP_302_FOUND、HTTP_303_SEE_OTHER、HTTP_304_NOT_MODIFIED。</li>
<li>HTTP_305_USE_PROXY、HTTP_306_RESERVED、HTTP_307_TEMPORARY_REDIRECT。</li>
</ul>
</li>
<li>示例：执行应用程序，访问“<a target="_blank" rel="noopener" href="http://127.0.0.1:5000/">http://127.0.0.1:5000/</a>”。<ul>
<li>输入用户名guest，F12查看，点击登录，返回“状态代码: 302 FOUND”。</li>
<li>输入用户名admin，点击登录，跳转至“<a target="_blank" rel="noopener" href="http://127.0.0.1:5000/success">http://127.0.0.1:5000/success</a>”。</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="1-redirect-py"><a href="#1-redirect-py" class="headerlink" title="(1) redirect.py"></a>(1) redirect.py</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, redirect, url_for, render_template, request<br><br>app = Flask(__name__)<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)                     </span><span class="hljs-comment"># 访问[http://127.0.0.1:5000]</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;redirect.html&#x27;</span>)<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/login&#x27;</span>, methods=[<span class="hljs-string">&#x27;POST&#x27;</span>, <span class="hljs-string">&#x27;GET&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">login</span>():                        <span class="hljs-comment"># redirect()函数用于在登录尝试失败时再次显示登录页面</span><br>    <span class="hljs-keyword">if</span> request.method == <span class="hljs-string">&#x27;POST&#x27;</span> <span class="hljs-keyword">and</span> request.form[<span class="hljs-string">&#x27;username&#x27;</span>] == <span class="hljs-string">&#x27;admin&#x27;</span>:<br>        <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&#x27;success&#x27;</span>))<br>    <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&#x27;index&#x27;</span>))<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/success&#x27;</span></span>)              </span><span class="hljs-comment"># 输入admin，跳转到[http://127.0.0.1:5000/success]</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">success</span>():                      <span class="hljs-comment"># 输入guest，F12查看返回&#x27;302 FOUND&#x27;</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&lt;center&gt;登录成功！&lt;/center&gt;&#x27;</span><br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.run(debug=<span class="hljs-literal">True</span>)<br></code></pre></td></tr></table></figure>



<h4 id="2-redirect-html"><a href="#2-redirect-html" class="headerlink" title="(2) redirect.html"></a>(2) redirect.html</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs Html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>重定向<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;text-align:center;&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;/login&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;POST&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>用户名：<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;username&quot;</span> /&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;登录&quot;</span> /&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure>



<h2 id="2-5-错误代码"><a href="#2-5-错误代码" class="headerlink" title="2-5 错误代码"></a>2-5 错误代码</h2><ul>
<li>错误代码<ul>
<li>Flask类具有带错误代码的abort()函数：<code>Flask.abort(code)</code>。</li>
<li>400(错误请求)、401(未授权)、403(Forbidden资源不可用)、404(Not Found网页不存在)。</li>
<li>406(无法使用请求的内容特性响应请求的网页)、415(不支持的媒体类型)、429(请求过多)。</li>
<li>更改redirect.py代码，如下所示，执行程序，访问“<a target="_blank" rel="noopener" href="http://127.0.0.1:5000/">http://127.0.0.1:5000/</a>”。<ul>
<li>输入用户名guest，F12查看，点击登录，返回“状态代码: 401 UNAUTHORIZED”。</li>
<li>输入用户名admin，点击登录，跳转“<a target="_blank" rel="noopener" href="http://127.0.0.1:5000/success">http://127.0.0.1:5000/success</a>”，登录成功。</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, redirect, url_for, render_template, request, abort<br><br>app = Flask(__name__)<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)                     </span><span class="hljs-comment"># 访问[http://127.0.0.1:5000]</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;redirect.html&#x27;</span>)<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/login&#x27;</span>, methods=[<span class="hljs-string">&#x27;POST&#x27;</span>, <span class="hljs-string">&#x27;GET&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">login</span>():                        <span class="hljs-comment"># 输入admin，跳转到[http://127.0.0.1:5000/success]</span><br>    <span class="hljs-keyword">if</span> request.method == <span class="hljs-string">&#x27;POST&#x27;</span>:<br>        <span class="hljs-keyword">if</span> request.form[<span class="hljs-string">&#x27;username&#x27;</span>] == <span class="hljs-string">&#x27;admin&#x27;</span>:<br>            <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&#x27;success&#x27;</span>))<br>        <span class="hljs-keyword">else</span>:<br>            abort(<span class="hljs-number">401</span>)<br>    <span class="hljs-keyword">else</span>:                           <span class="hljs-comment"># 输入guest，F12查看返回&#x27;401 UNAUTHORIZED&#x27;</span><br>        <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&#x27;index&#x27;</span>))<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/success&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">success</span>():<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&lt;center&gt;登录成功！&lt;/center&gt;&#x27;</span><br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.run(debug=<span class="hljs-literal">True</span>)<br></code></pre></td></tr></table></figure>



<h2 id="2-6-消息闪现"><a href="#2-6-消息闪现" class="headerlink" title="2-6 消息闪现"></a>2-6 消息闪现</h2><ul>
<li>消息闪现<ul>
<li>Flask提供了一个方法来使用闪现系统向用户反馈信息，可视图中创建消息，并在名为next的视图函数中呈现。</li>
<li>在一个请求结束时记录一个信息，并且在下次(且仅在下一次)求时访问，通常与布局模板结合使用以公开信息。</li>
<li><code>flash(message, category)</code>：将消息传递给下一个请求，该请求通常是一个模板。</li>
<li>message(要闪现的实际消息)、category(“error”、“info”或“warning”，可选)。</li>
<li><code>get_flashed_messages(with_categories, category_filter)</code>：会话中删除消息。</li>
<li>如果接收到的消息具有类别，则第一个参数是元组，第二个参数仅用于显示特定消息。</li>
<li>示例：执行程序，访问“<a target="_blank" rel="noopener" href="http://127.0.0.1:5000/">http://127.0.0.1:5000/</a>”，点击登录跳转到登录页面。<ul>
<li>用户名admin，密码1235，提交，显示“错误：无效用户名或密码，请重试！”。</li>
<li>重新输入用户名admin，密码admin，提交，跳回登录页面并显示“登录成功！”。</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs Html"><span class="hljs-comment">&lt;!-- 闪现在模板中接收消息 --&gt;</span><br>&#123;% with messages = get_flashed_messages() %&#125;<br>    &#123;% if messages %&#125;<br>        &#123;% for message in messages %&#125;<br>            &#123;&#123; message &#125;&#125;<br>        &#123;% endfor %&#125;<br>    &#123;% endif %&#125;<br>&#123;% endwith %&#125;<br></code></pre></td></tr></table></figure>



<h4 id="1-flash-py"><a href="#1-flash-py" class="headerlink" title="(1) flash.py"></a>(1) flash.py</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, flash, redirect, render_template, request, url_for<br><br>app = Flask(__name__)<br>app.secret_key = <span class="hljs-string">&#x27;flask flash&#x27;</span><br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)                     </span><span class="hljs-comment"># 访问[http://127.0.0.1:5000]</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_flash</span>():                    <span class="hljs-comment"># &#x27;/&#x27;URL显示登录页面的链接，没有消息闪现</span><br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;flashmess.html&#x27;</span>)<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/flashlogin&#x27;</span>, methods=[<span class="hljs-string">&#x27;GET&#x27;</span>, <span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">flash_login</span>():                  <span class="hljs-comment"># 显示登录表单，由&#x27;/&#x27;URL链接引导用户到&#x27;/flashlogin&#x27;</span><br>    error = <span class="hljs-literal">None</span><br>    <span class="hljs-keyword">if</span> request.method == <span class="hljs-string">&#x27;POST&#x27;</span>:    <span class="hljs-comment"># 视图函数验证用户名和密码，并闪现登录成功消息或创建error变量</span><br>        <span class="hljs-keyword">if</span> request.form[<span class="hljs-string">&#x27;username&#x27;</span>] != <span class="hljs-string">&#x27;admin&#x27;</span> <span class="hljs-keyword">or</span> request.form[<span class="hljs-string">&#x27;password&#x27;</span>] != <span class="hljs-string">&#x27;admin&#x27;</span>:<br>            error = <span class="hljs-string">&#x27;无效用户名或密码，请重试！&#x27;</span><br>        <span class="hljs-keyword">else</span>:<br>            flash(<span class="hljs-string">&#x27;登录成功！&#x27;</span>)      <span class="hljs-comment"># 输入用户名admin，密码admin，则登录成功，否则失败提示</span><br>            <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&#x27;get_flash&#x27;</span>))<br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;flashlogin.html&#x27;</span>, error=error)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.run(debug=<span class="hljs-literal">True</span>)<br></code></pre></td></tr></table></figure>



<h4 id="2-flashmess-html"><a href="#2-flashmess-html" class="headerlink" title="(2) flashmess.html"></a>(2) flashmess.html</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs HTML"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>消息闪现<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="language-css"></span><br><span class="language-css">        <span class="hljs-selector-tag">body</span> &#123;<span class="hljs-attribute">text-align</span>: center;&#125;</span><br><span class="language-css">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    &#123;% with messages = get_flashed_messages() %&#125;<br>        &#123;% if messages %&#125;<br>            &#123;% for message in messages %&#125;<br>                <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>&#123;&#123; message &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>            &#123;% endfor %&#125;<br>        &#123;% endif %&#125;<br>    &#123;% endwith %&#125;<br>    <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>欢迎！<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span> = <span class="hljs-string">&quot;&#123;&#123; url_for(&#x27;flash_login&#x27;) &#125;&#125;&quot;</span>&gt;</span>点击这里进行登录<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>。<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure>



<h4 id="3-flashlogin-html"><a href="#3-flashlogin-html" class="headerlink" title="(3) flashlogin.html"></a>(3) flashlogin.html</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs HTML"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>登录页面<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="language-css"></span><br><span class="language-css">        <span class="hljs-selector-tag">body</span> &#123;<span class="hljs-attribute">text-align</span>: center;&#125; <span class="hljs-selector-tag">table</span> &#123;<span class="hljs-attribute">margin</span>: auto;&#125;</span><br><span class="language-css">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;POST&quot;</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;http://localhost:5000/flashlogin&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">table</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>用户名<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&#x27;username&#x27;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&#x27;username&#x27;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><br>                <span class="hljs-comment">&lt;!-- &amp;nbsp; 半角不断行的空白格 --&gt;</span><br>                <span class="hljs-comment">&lt;!-- &amp;ensp; 半角的空格 --&gt;</span><br>                <span class="hljs-comment">&lt;!-- &amp;emsp; 全角的空格 --&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>密<span class="hljs-symbol">&amp;emsp;</span>码<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&#x27;password&#x27;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&#x27;password&#x27;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&#x27;submit&#x27;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&#x27;提<span class="hljs-symbol">&amp;emsp;</span>交&#x27;</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br>    &#123;% if error %&#125;<br>        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">strong</span>&gt;</span>错误：<span class="hljs-tag">&lt;/<span class="hljs-name">strong</span>&gt;</span>&#123;&#123; error &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>    &#123;% endif %&#125;<br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure>



<h2 id="2-7-文件上传"><a href="#2-7-文件上传" class="headerlink" title="2-7 文件上传"></a>2-7 文件上传</h2><ul>
<li>文件上传<ul>
<li>需HTML表单，enctype属性设为“multipart&#x2F;form-data”，将文件发布到URL。</li>
<li>URL处理程序从<code>request.files[]</code>对象中提取文件，并将其保存到所需的位置。</li>
<li>每个上传的文件首先保存在服务器的临时位置中，然后再将其保存到最终位置上。</li>
<li>目标文件的名称可以是硬编码的，也可以从<code>request.files[]</code>对象的属性中获取。<ul>
<li><code>secure_filename()</code>：获取安全版本。</li>
<li><code>app.config[&#39;UPLOAD_FOLDER&#39;]</code>：定义上传文件夹的路径。</li>
<li><code>app.config[&#39;MAX_CONTENT_LENGTH&#39;]</code>：指定要上传文件大小的最大值(以字节为单位)。</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="1-upload-py"><a href="#1-upload-py" class="headerlink" title="(1) upload.py"></a>(1) upload.py</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">from</span> werkzeug.utils <span class="hljs-keyword">import</span> secure_filename<br><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, render_template, request<br><br>app = Flask(__name__)               <span class="hljs-comment"># 上传图片路径自定义，必须存在，否则报错</span><br>app.config[<span class="hljs-string">&#x27;UPLOAD_FOLDER&#x27;</span>] = <span class="hljs-string">&#x27;C:/Users/&lt;username&gt;/Pictures/&#x27;</span><br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/upload&#x27;</span></span>)               </span><span class="hljs-comment"># 访问[http://127.0.0.1:5000/upload]</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">upload_file</span>():<br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;upload.html&#x27;</span>)<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/uploaded&#x27;</span>, methods=[<span class="hljs-string">&#x27;GET&#x27;</span>, <span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">uploaded</span>():<br>    <span class="hljs-keyword">if</span> request.method == <span class="hljs-string">&#x27;POST&#x27;</span>:<br>        f = request.files[<span class="hljs-string">&#x27;file&#x27;</span>]<br>        <span class="hljs-built_in">print</span>(request.files)<br>        path = os.path.join(app.config[<span class="hljs-string">&#x27;UPLOAD_FOLDER&#x27;</span>], secure_filename(f.filename))<br>        <span class="hljs-built_in">print</span>(path)                 <span class="hljs-comment"># 注意：图片路径不含中文，中文打印识别不到</span><br>        f.save(path)<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&lt;center&gt;文件上传成功！&lt;/center&gt;&#x27;</span><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;upload.html&#x27;</span>)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.run(debug=<span class="hljs-literal">True</span>)<br></code></pre></td></tr></table></figure>



<h4 id="2-upload-html"><a href="#2-upload-html" class="headerlink" title="(2) upload.html"></a>(2) upload.html</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs Html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>文件上传<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;text-align:center;&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;http://localhost:5000/uploaded&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;POST&quot;</span> <span class="hljs-attr">enctype</span>=<span class="hljs-string">&quot;multipart/form-data&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;file&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;file&quot;</span> /&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;提交&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure>



<h1 id="3-扩展功能"><a href="#3-扩展功能" class="headerlink" title="3 扩展功能"></a>3 扩展功能</h1><ul>
<li>扩展功能<ul>
<li>向Flask应用程序添加特定类型的支持，Flask Extension Registry(扩展注册表)是一个可用的扩展目录。</li>
<li>常用扩展包<ul>
<li>Flask-migrate(管理迁移数据库)、Flask-Admin(可扩展的管理接口框架)。</li>
<li>Flask-script(插入脚本)、Flask-Bable(提供国际化和本地化支持的翻译)。</li>
<li>Flask-Moment(本地化日期和时间)、Flask-Bootstrap(集成前端的Twitter Bootstrap框架)。</li>
<li>Flask-Session(Session存储方式指定)、Flask-OpenID(认证)、Flask-RESTful(开发REST API的工具)。</li>
<li>Flask-Mail(邮件)、Flask-WTF(表单)、Flask-SQLAlchemy(操作数据库)、Flask-Login(认证用户状态)。</li>
</ul>
</li>
<li>扩展通常命名为Flask-Foo或Foo-Flask，在PyPI搜索标记为“<a target="_blank" rel="noopener" href="https://pypi.org/search/?c=Framework+::+Flask">FRAMEWORK::FLASK</a>”扩展包，通过PIP​下载。</li>
</ul>
</li>
</ul>
<h2 id="3-1-Mail"><a href="#3-1-Mail" class="headerlink" title="3-1 Mail"></a>3-1 Mail</h2><ul>
<li>Mail<ul>
<li>通过PIP命令安装Flask-Mail扩展：<code>pip install Flask-Mail</code>。</li>
<li>参数<ul>
<li>MAIL_SERVER-&gt;电子邮件服务器的名称或IP地址、MAIL_PORT-&gt;服务器的端口号。</li>
<li>MAIL_USERNAME-&gt;发件人的用户名、MAIL_DEFAULT_SENDER-&gt;设置默认发件人。</li>
<li>MAIL_PASSWORD-&gt;发件人的密码、MAIL_MAX_EMAILS-&gt;设置要发送的最大邮件数。</li>
<li>MAIL_ASCII_ATTACHMENTS-&gt;如果值设置为True，那么附加的文件名将转换为ASCII。</li>
<li>MAIL_USE_TLS-&gt;启用或禁用传输安全层加密、MAIL_USE_SSL-&gt;启用或禁用安全套接字层加密。</li>
<li>MAIL_DEBUG-&gt;默认调试状态、MAIL_SUPPRESS_SEND-&gt;app.testing设为True，则发送被抑制。</li>
</ul>
</li>
<li>重要类的定义<ul>
<li>Mail类：管理电子邮件消息传递需求，类构造函数为<code>flask-mail.Mail(app = None)</code>。<ul>
<li><code>send_message()</code>：发送消息的对象。</li>
<li><code>connect()</code>：打开与邮件主机的连接。</li>
<li><code>send()</code>：发送Message类对象的内容。</li>
</ul>
</li>
<li>Message类：封装一封电子邮件，类构造函数为<code>flask-mail.Message(subject, ...)</code>。<ul>
<li><code>attach()</code>：支持向邮件添加相关附件。</li>
<li><code>add_recipient()</code>：添加另一个收件人。</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask<br><span class="hljs-keyword">from</span> flask_mail <span class="hljs-keyword">import</span> Mail, Message                <span class="hljs-comment"># flask-mail模块导入Mail和Message类</span><br><br>app = Flask(__name__)                               <span class="hljs-comment"># 配置Flask-Mail</span><br><br>app.config[<span class="hljs-string">&#x27;MAIL_SERVER&#x27;</span>] = <span class="hljs-string">&#x27;smtp.126.com&#x27;</span>          <span class="hljs-comment"># 126电子邮件服务器的名称或IP地址</span><br>app.config[<span class="hljs-string">&#x27;MAIL_PORT&#x27;</span>] = <span class="hljs-number">25</span>                        <span class="hljs-comment"># 服务器的端口号</span><br>app.config[<span class="hljs-string">&#x27;MAIL_USERNAME&#x27;</span>] = <span class="hljs-string">&#x27;Id1@126.com&#x27;</span>         <span class="hljs-comment"># 发件人的用户名</span><br>app.config[<span class="hljs-string">&#x27;MAIL_PASSWORD&#x27;</span>] = <span class="hljs-string">&#x27;******&#x27;</span>              <span class="hljs-comment"># 发件人的密码(授权码)</span><br><span class="hljs-comment"># 并非使用邮箱密码而是授权码，注意授权码需重新获取，旧的不行，否则报错smtplib.SMTPAuthenticationError</span><br><span class="hljs-comment"># 将邮箱的安全验证级别降至最低，例如：设了邮箱登录二次验证(密码登录后需输入手机验证码)，将该功能关闭</span><br><span class="hljs-comment"># ssl.SSLError: [SSL: WRONG_VERSION_NUMBER] wrong version number (_ssl.c:1129)，MAIL_USE_SSL改为False</span><br>app.config[<span class="hljs-string">&#x27;MAIL_USE_SSL&#x27;</span>] = <span class="hljs-literal">False</span>                  <span class="hljs-comment"># 禁用安全套接字层加密</span><br>app.config[<span class="hljs-string">&#x27;MAIL_USE_TLS&#x27;</span>] = <span class="hljs-literal">False</span>                  <span class="hljs-comment"># 禁用传输安全层加密</span><br>mail = Mail(app)                                    <span class="hljs-comment"># 创建Mail类的实例</span><br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)                                     </span><span class="hljs-comment"># 访问[http://127.0.0.1:5000/]即发送邮件</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    msg = Message(<span class="hljs-string">&#x27;Flask-Mail测试&#x27;</span>, sender=<span class="hljs-string">&#x27;Id1@126.com&#x27;</span>, recipients=[<span class="hljs-string">&#x27;Id2@126.com&#x27;</span>])<br>    msg.body = <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">        Name：Dr.626</span><br><span class="hljs-string">        Description：测试Flask-Mail扩展是否生效。</span><br><span class="hljs-string">    &#x27;&#x27;&#x27;</span><br>    mail.send(msg)<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&lt;center&gt;发送成功！&lt;/center&gt;&#x27;</span><br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.run(debug=<span class="hljs-literal">True</span>)<br></code></pre></td></tr></table></figure>



<h2 id="3-2-WTF"><a href="#3-2-WTF" class="headerlink" title="3-2 WTF"></a>3-2 WTF</h2><ul>
<li>WTF<ul>
<li>PIP命令安装Flask-WTF扩展：<code>pip install Flask-WTF</code>。</li>
<li>WTforms包中的标准表单字段<ul>
<li>DecimalField-&gt;显示带小数的数字文本字段、TextAreaField-&gt;<code>&lt;textarea&gt;</code>。</li>
<li>SelectField-&gt;选择表单元素、PasswordField-&gt;<code>&lt;input type=&#39;password&#39;&gt;</code>。</li>
<li>IntegerField-&gt;显示整数的文本字段、RadioField-&gt;<code>&lt;input type=&#39;radio&#39;&gt;</code>。</li>
<li>StringField-&gt;<code>&lt;input type=&#39;text&#39;&gt;</code>、SubmitField-&gt;<code>&lt;input type=&#39;submit&#39;&gt;</code>。</li>
<li>BooleanField-&gt;<code>&lt;input type=&#39;checkbox&#39;&gt;</code>。</li>
</ul>
</li>
<li>WTForms包中常用的验证器<ul>
<li>NumberRange-&gt;验证给定范围内输入字段中的数字、URL-&gt;验证在输入字段中输入的URL。</li>
<li>DataRequired-&gt;检查输入字段是否为空、Email-&gt;检查字段中的文本是否遵循电子邮件的ID约定。</li>
<li>IPAddress-&gt;输入字段中验证IP地址、Length-&gt;验证输入字段中的字符串长度是否在给定范围内。</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="1-form-py"><a href="#1-form-py" class="headerlink" title="(1) form.py"></a>(1) form.py</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> formnew <span class="hljs-keyword">import</span> ContactForm<br><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, render_template, request, flash<br><br>app = Flask(__name__)<br>app.secret_key = <span class="hljs-string">&#x27;flask wtf&#x27;</span><br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/formfill&#x27;</span>, methods=[<span class="hljs-string">&#x27;GET&#x27;</span>, <span class="hljs-string">&#x27;POST&#x27;</span>]</span>)    </span><span class="hljs-comment"># 访问[http://127.0.0.1:5000/formfill]，填写数据</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">form_fill</span>():<br>    form = ContactForm()                            <span class="hljs-comment"># formnew.py中设置了name与email必填</span><br><br>    <span class="hljs-keyword">if</span> request.method == <span class="hljs-string">&#x27;POST&#x27;</span>:<br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> form.validate():                     <span class="hljs-comment"># 判断必填项是否全部填写，没有则提示，有则跳转页面</span><br>            flash(<span class="hljs-string">&#x27;请填写所有必填字段。&#x27;</span>)<br>            <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;formfill.html&#x27;</span>, form=form)<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;formsub.html&#x27;</span>)  <span class="hljs-comment"># 提交后跳转不过来，即使跳转成功URL仍为“/formfill”</span><br>    <span class="hljs-keyword">elif</span> request.method == <span class="hljs-string">&#x27;GET&#x27;</span>:<br>        <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;formfill.html&#x27;</span>, form=form)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.run(debug=<span class="hljs-literal">True</span>)<br></code></pre></td></tr></table></figure>



<h4 id="2-formnew-py"><a href="#2-formnew-py" class="headerlink" title="(2) formnew.py"></a>(2) formnew.py</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> wtforms <span class="hljs-keyword">import</span> validators<br><span class="hljs-keyword">from</span> flask_wtf <span class="hljs-keyword">import</span> FlaskForm<br><span class="hljs-keyword">from</span> wtforms <span class="hljs-keyword">import</span> StringField, IntegerField, TextAreaField, SubmitField, RadioField, SelectField<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">ContactForm</span>(<span class="hljs-title class_ inherited__">FlaskForm</span>):<br>    name = StringField(<span class="hljs-string">&#x27;姓名&#x27;</span>, [validators.DataRequired(message=<span class="hljs-string">&#x27;请输入你的姓名!&#x27;</span>)])<br>    sex = RadioField(<span class="hljs-string">&#x27;性别&#x27;</span>, choices=[(<span class="hljs-string">&#x27;M&#x27;</span>, <span class="hljs-string">&#x27;男&#x27;</span>), (<span class="hljs-string">&#x27;F&#x27;</span>, <span class="hljs-string">&#x27;女&#x27;</span>)])<br>    address = TextAreaField(<span class="hljs-string">&#x27;地址&#x27;</span>)<br>    email = StringField(<span class="hljs-string">&#x27;邮件&#x27;</span>,                     <span class="hljs-comment"># 校验邮箱是否必填，以及邮箱正确性</span><br>                        [validators.DataRequired(message=<span class="hljs-string">&#x27;请输入你的邮件地址!&#x27;</span>),<br>                         validators.Email(message=<span class="hljs-string">&#x27;请输入正确的邮件地址!&#x27;</span>)])<br>    age = IntegerField(<span class="hljs-string">&#x27;年龄&#x27;</span>)<br>    <span class="hljs-comment"># language = SelectField(&#x27;语言&#x27;, choices=[&#x27;C#&#x27;, &#x27;CPP&#x27;, &#x27;Java&#x27;, &#x27;Python&#x27;, &#x27;Golang&#x27;])</span><br>    <span class="hljs-comment"># language上述写法，执行时可能报错ValueError: too many values to unpack (expected 2)</span><br>    language = SelectField(<br>        <span class="hljs-string">&#x27;语言&#x27;</span>,<br>        choices=[<br>            (<span class="hljs-string">&#x27;c#&#x27;</span>, <span class="hljs-string">&#x27;C#&#x27;</span>), (<span class="hljs-string">&#x27;cpp&#x27;</span>, <span class="hljs-string">&#x27;CPP&#x27;</span>), (<span class="hljs-string">&#x27;java&#x27;</span>, <span class="hljs-string">&#x27;Java&#x27;</span>), <br>            (<span class="hljs-string">&#x27;python&#x27;</span>, <span class="hljs-string">&#x27;Python&#x27;</span>), (<span class="hljs-string">&#x27;golang&#x27;</span>, <span class="hljs-string">&#x27;Golang&#x27;</span>)<br>        ],<br>        default=<span class="hljs-string">&#x27;python&#x27;</span>,<br>        render_kw=&#123;<span class="hljs-string">&quot;style&quot;</span>: <span class="hljs-string">&quot;width:180px;height:30px;&quot;</span>&#125;,<br>    )<br>    submit = SubmitField(<span class="hljs-string">&#x27;提交&#x27;</span>)<br></code></pre></td></tr></table></figure>



<h4 id="3-formfill-html"><a href="#3-formfill-html" class="headerlink" title="(3) formfill.html"></a>(3) formfill.html</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs Html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>表单填写<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;text-align: center;&quot;</span>&gt;</span>Flask-WTF表单<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;http://localhost:5000/formfill&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&#x27;POST&#x27;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">fieldset</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">legend</span>&gt;</span>Flask-WTF表单<span class="hljs-tag">&lt;/<span class="hljs-name">legend</span>&gt;</span><br>            <span class="hljs-comment">&lt;!-- formnew.py的ContactForm类创建name字段时，会自动创建CSRF令牌的隐藏字段 --&gt;</span><br>            <span class="hljs-comment">&lt;!-- 防止跨站请求伪造攻击，CSRF令牌的隐藏字段，相当于如下脚本 --&gt;</span><br>            <span class="hljs-comment">&lt;!-- &lt;input id=&quot;csrf_token&quot; name=&quot;csrf_token&quot; type=&quot;hidden&quot; /&gt; --&gt;</span><br>            &#123;&#123; form.hidden_tag() &#125;&#125;<br>            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;font-size:20px;font-weight:bold;text-align:center;&quot;</span>&gt;</span><br>                &#123;&#123; form.name.label &#125;&#125;<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>                &#123;&#123; form.name(style=&#x27;width:170px;height:20px;&#x27;) &#125;&#125;<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>                <span class="hljs-comment">&lt;!-- 这里貌似只校验了邮箱的正确性，必填项弹窗提示词都一致 --&gt;</span><br>                <span class="hljs-comment">&lt;!-- 并不是formnew.py文件中自定义的提示词 --&gt;</span><br>                &#123;% for message in form.name.errors %&#125;<br>                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;alert alert-danger&quot;</span>&gt;</span>&#123;&#123; message &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                &#123;% endfor %&#125;<br>                &#123;&#123; form.sex.label &#125;&#125;<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>                &#123;&#123; form.sex(style=&#x27;display:inline-block;text-align:center;&#x27;) &#125;&#125;<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>                &#123;&#123; form.address.label &#125;&#125;<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>                &#123;&#123; form.address(style=&#x27;width:170px;height:20px;&#x27;) &#125;&#125;<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>                &#123;&#123; form.email.label &#125;&#125;<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>                &#123;&#123; form.email(style=&#x27;width:170px;height:20px;&#x27;) &#125;&#125;<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>                &#123;% for message in form.email.errors %&#125;<br>                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;alert alert-danger&quot;</span>&gt;</span>&#123;&#123; message &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                &#123;% endfor %&#125;<br>                &#123;&#123; form.age.label &#125;&#125;<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>                &#123;&#123; form.age(style=&#x27;width:170px;height:20px;&#x27;) &#125;&#125;<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>                &#123;&#123; form.language.label &#125;&#125;<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>                <span class="hljs-comment">&lt;!-- &#123;&#123; form.language(style=&#x27;width:180px;height:30px;&#x27;) &#125;&#125;&lt;br&gt;&lt;br&gt; --&gt;</span><br>                &#123;&#123; form.language() &#125;&#125;<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>                &#123;&#123; form.submit(style=&#x27;width:50px;height:30px;&#x27;) &#125;&#125;<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">fieldset</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure>



<h4 id="4-formsub-html"><a href="#4-formsub-html" class="headerlink" title="(4) formsub.html"></a>(4) formsub.html</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs Html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>提交显示<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">center</span>&gt;</span>信息提交成功！<span class="hljs-tag">&lt;/<span class="hljs-name">center</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure>



<h2 id="3-3-Sijax"><a href="#3-3-Sijax" class="headerlink" title="3-3 Sijax*"></a>3-3 Sijax*</h2><ul>
<li>Sijax<ul>
<li>即Simple Ajax，可轻松地实现AJAX功能，PIP安装Flask-Sijax扩展：<code>pip install flask-sijax</code>。</li>
<li>Flask-Sijax是一个专门为Flask设计的Sijax扩展，提供了与Flask无缝集成的API，也是个轻量级的库。</li>
</ul>
</li>
</ul>
<h4 id="1-sijaxapp-py"><a href="#1-sijaxapp-py" class="headerlink" title="(1) sijaxapp.py"></a>(1) sijaxapp.py</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">import</span> flask_sijax<br><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, g, render_template<br><br>app = Flask(__name__)<br><br><span class="hljs-comment"># SIJAX_STATIC_PATH，要被镜像的Sijax javascript文件的静态路径，默认“/static/js/sijax/”</span><br><span class="hljs-comment"># SIJAX_JSON_URI，从中加载json2.js静态文件的URI，Sijax使用Json在浏览器和服务器之间传递数据</span><br>app.config[<span class="hljs-string">&#x27;SIJAX_STATIC_PATH&#x27;</span>] = <span class="hljs-string">&#x27;/static/js/sijax/&#x27;</span><br>app.config[<span class="hljs-string">&#x27;SIJAX_JSON_URI&#x27;</span>] = <span class="hljs-string">&#x27;/static/js/sijax/json2.js&#x27;</span><br>flask_sijax.Sijax(app)                              <span class="hljs-comment"># static生成的路径不对(在根目录下)</span><br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)                                     </span><span class="hljs-comment"># 访问[http://127.0.0.1:5000/]</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&lt;center&gt;&lt;a href=&#x27;/app&#x27;&gt;跳转app页面&lt;/a&gt;&lt;/center&gt;&quot;</span><br><br><br><span class="hljs-meta">@flask_sijax.route(<span class="hljs-params">app, <span class="hljs-string">&#x27;/app&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">hello</span>():<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">say_hi</span>(<span class="hljs-params">obj_response</span>):<br>        obj_response.alert(<span class="hljs-string">&#x27;Hi there!&#x27;</span>)             <span class="hljs-comment"># 函数回复浏览器的方式</span><br>        <span class="hljs-keyword">if</span> g.sijax.is_sijax_request:                <span class="hljs-comment"># 不会弹窗显示“Hi there!”</span><br>            g.sijax.register_callback(<span class="hljs-string">&#x27;say_hi&#x27;</span>, say_hi)<br>        <span class="hljs-keyword">return</span> g.sijax.process_request()            <span class="hljs-comment"># 检测到Ajax请求时，Sijax会自行处理</span><br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;sijaxapp.html&#x27;</span>)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.run(debug=<span class="hljs-literal">True</span>)<br></code></pre></td></tr></table></figure>



<h4 id="2-sijaxapp-html"><a href="#2-sijaxapp-html" class="headerlink" title="(2) sijaxapp.html"></a>(2) sijaxapp.html</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs Html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Flask-Sijax<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;/static/js/sijax/sijax.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-handlebars"><span class="hljs-template-variable">&#123;&#123; <span class="hljs-name">g.sijax.get_js</span>()|safe &#125;&#125;</span></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;text-align: center;&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Flask-Sijax<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;javascript://&quot;</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">&quot;Sijax.request(&#x27;say_hi&#x27;);&quot;</span>&gt;</span>点击这里<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- 单击链接将向服务器发出一个Sijax请求，一个特殊的jQuery.ajax()请求 --&gt;</span><br>    <span class="hljs-comment">&lt;!-- 具体参看Flask-Sijax官网“https://pythonhosted.org/Flask-Sijax/” --&gt;</span><br>    <span class="hljs-comment">&lt;!-- GET http://127.0.0.1:5000/static/js/sijax/sijax.js net::ERR_ABORTED 404 (NOT FOUND) --&gt;</span><br>    <span class="hljs-comment">&lt;!-- 请求失效了，Uncaught ReferenceError: Sijax is not defined at HTMLAnchorElement.onclick --&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure>



<h2 id="3-4-SQLite"><a href="#3-4-SQLite" class="headerlink" title="3-4 SQLite"></a>3-4 SQLite</h2><ul>
<li>SQLite<ul>
<li>通过PIP命令安装SQLite扩展：<code>pip install sqlite3</code>。</li>
<li>SQLite是一种嵌入式数据库管理系统，易于使用无需配置。</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">import</span> sqlite3                                       <span class="hljs-comment"># 实例操作前需要先创建数据库和数据表</span><br><br>conn = sqlite3.connect(<span class="hljs-string">&#x27;database.db&#x27;</span>)                <span class="hljs-comment"># 创建SQLite数据库和一个学生表</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;成功打开数据库！&#x27;</span>)<br><br>conn.execute(<span class="hljs-string">&#x27;CREATE TABLE students (name TEXT, address TEXT, city TEXT, pin TEXT)&#x27;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;数据表创建成功！&#x27;</span>)<br>conn.close()<br></code></pre></td></tr></table></figure>



<h4 id="1-sqloper-py"><a href="#1-sqloper-py" class="headerlink" title="(1) sqloper.py"></a>(1) sqloper.py</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">import</span> sqlite3 <span class="hljs-keyword">as</span> sql                               <span class="hljs-comment"># 实例将学生信息添加到数据库中，并列表展示</span><br><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, render_template, request<br><br>app = Flask(__name__)<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)                                     </span><span class="hljs-comment"># 显示[127.0.0.1:5000]主页，链接到sqlhome.html</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">sql_home</span>():<br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;sqlhome.html&#x27;</span>)<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/sqlstu&#x27;</span></span>)                               </span><span class="hljs-comment"># 页面表单添加学生记录，链接到sqlstu.html</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">new_stu</span>():<br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;sqlstu.html&#x27;</span>)<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/addrec&#x27;</span>, methods=[<span class="hljs-string">&#x27;POST&#x27;</span>, <span class="hljs-string">&#x27;GET&#x27;</span>]</span>)      </span><span class="hljs-comment"># 将表单记录插入数据库对应的表中</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add_rec</span>():<br>    <span class="hljs-keyword">global</span> msg<br>    <span class="hljs-keyword">if</span> request.method == <span class="hljs-string">&#x27;POST&#x27;</span>:<br>        <span class="hljs-keyword">try</span>:<br>            name = request.form[<span class="hljs-string">&#x27;name&#x27;</span>]             <span class="hljs-comment"># 这里并未做表单内容的校验</span><br>            address = request.form[<span class="hljs-string">&#x27;address&#x27;</span>]<br>            city = request.form[<span class="hljs-string">&#x27;city&#x27;</span>]<br>            pin = request.form[<span class="hljs-string">&#x27;pin&#x27;</span>]<br>            <span class="hljs-keyword">with</span> sql.connect(<span class="hljs-string">&quot;database.db&quot;</span>) <span class="hljs-keyword">as</span> con:<br>                cur = con.cursor()                  <span class="hljs-comment"># 打开database.db数据库</span><br>                cur.execute(<span class="hljs-string">&quot;INSERT INTO students (name, address, city, pin) \</span><br><span class="hljs-string">                            VALUES(?, ?, ?, ?)&quot;</span>, (name, address, city, pin))<br>                con.commit()                        <span class="hljs-comment"># 将数据插入数据库中并commit提交</span><br>                msg = <span class="hljs-string">&#x27;记录添加成功！&#x27;</span><br>        <span class="hljs-keyword">except</span>:<br>            con.rollback()<br>            msg = <span class="hljs-string">&#x27;插入操作有误！&#x27;</span><br>        <span class="hljs-keyword">finally</span>:<br>            <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&quot;sqlres.html&quot;</span>, msg=msg)<br>            con.close()                             <span class="hljs-comment"># 关闭数据库连接，释放资源避免潜在的问题</span><br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/sqllist&#x27;</span></span>)                              </span><span class="hljs-comment"># 从数据库中检索所有学生信息，并在页面展示</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">sql_list</span>():<br>    con = sql.connect(<span class="hljs-string">&quot;database.db&quot;</span>)<br>    con.row_factory = sql.Row<br>    cur = con.cursor()<br>    cur.execute(<span class="hljs-string">&quot;SELECT * FROM students&quot;</span>)           <span class="hljs-comment"># 数据表记录查询语句</span><br>    rows = cur.fetchall()<br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;sqllist.html&#x27;</span>, rows=rows)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.run(debug=<span class="hljs-literal">True</span>)<br></code></pre></td></tr></table></figure>



<h4 id="2-sqlres-html"><a href="#2-sqlres-html" class="headerlink" title="(2) sqlres.html"></a>(2) sqlres.html</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs Html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>添加结果<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&#x27;text-align: center;&#x27;</span>&gt;</span><br>    添加后的结果 : &#123;&#123; msg &#125;&#125;<br>    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span> = <span class="hljs-string">&quot;\&quot;</span>&gt;</span>点击回到首页<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure>



<h4 id="3-sqlstu-html"><a href="#3-sqlstu-html" class="headerlink" title="(3) sqlstu.html"></a>(3) sqlstu.html</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs Html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>表单填写<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&#x27;&#123;&#123; url_for(&quot;add_rec&quot;) &#125;&#125;&#x27;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&#x27;POST&#x27;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&#x27;text-align: center;&#x27;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>学生信息<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span>姓名<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&#x27;text&#x27;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&#x27;name&#x27;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&#x27;width: 180px; height: 30px;&#x27;</span> /&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span>地址<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">textarea</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&#x27;address&#x27;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&#x27;width: 180px; height: 30px;&#x27;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">textarea</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span>城市<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&#x27;text&#x27;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&#x27;city&#x27;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&#x27;width: 180px; height: 30px;&#x27;</span> /&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span>认证码<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&#x27;text&#x27;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&#x27;pin&#x27;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&#x27;width: 180px; height: 30px;&#x27;</span> /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&#x27;submit&#x27;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&#x27;提交&#x27;</span> /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure>



<h4 id="4-sqllist-html"><a href="#4-sqllist-html" class="headerlink" title="(4) sqllist.html"></a>(4) sqllist.html</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs Html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>列表展示<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="language-css"></span><br><span class="language-css">        <span class="hljs-selector-tag">body</span> &#123;<span class="hljs-attribute">text-align</span>: center;&#125; <span class="hljs-selector-tag">table</span> &#123;<span class="hljs-attribute">margin</span>: auto;&#125;</span><br><span class="language-css">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">table</span> <span class="hljs-attr">border</span>=<span class="hljs-string">2</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">thead</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>姓名<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>地址<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>城市<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>认证码<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">thead</span>&gt;</span><br>        &#123;% for row in rows %&#125;<br>            <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>&#123;&#123; row[&#x27;name&#x27;] &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>&#123;&#123; row[&#x27;address&#x27;] &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>&#123;&#123; row[&#x27;city&#x27;] &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>&#123;&#123; row[&#x27;pin&#x27;] &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br>        &#123;% endfor %&#125;<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span> = <span class="hljs-string">&quot;/&quot;</span>&gt;</span>点击回到首页<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure>



<h4 id="5-sqlhome-html"><a href="#5-sqlhome-html" class="headerlink" title="(5) sqlhome.html"></a>(5) sqlhome.html</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs Html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>数据操作<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&#x27;text-align: center;&#x27;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/sqlstu&quot;</span>&gt;</span>添加记录<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/sqllist&quot;</span>&gt;</span>列表展示<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure>



<h2 id="3-5-SQLAlchemy"><a href="#3-5-SQLAlchemy" class="headerlink" title="3-5 SQLAlchemy"></a>3-5 SQLAlchemy</h2><ul>
<li>SQLAlchemy<ul>
<li>PIP命令安装Flask-SQLAlchemy扩展：<code>pip install flask-sqlalchemy</code>。</li>
<li>Flask-SQLAlchemy是Flask框架的一个扩展，提供了一种简单易用的方式来操作SQL数据库。</li>
<li>使用SQLAlchemy可轻松定义数据模型、查询数据并进行CRUD操作，不必编写原始SQL语句。</li>
<li>ORM，Object-Relational Mapping，对象关系映射，ORM API提供了执行CRUD操作的方法。<ul>
<li>大多数编程语言平台是面向对象的，而RDBMS服务器中的数据存储为表。</li>
<li>ORM将关系数据库表视为对象，把对象参数映射到底层RDBMS表结构中。</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="1-sqlaloper-py"><a href="#1-sqlaloper-py" class="headerlink" title="(1) sqlaloper.py"></a>(1) sqlaloper.py</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> flask_sqlalchemy <span class="hljs-keyword">import</span> SQLAlchemy             <span class="hljs-comment"># 支持添加、编辑、删除和查看学生信息</span><br><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, request, flash, url_for, redirect, render_template<br><br>app = Flask(__name__)<br>app.config[<span class="hljs-string">&#x27;SQLALCHEMY_DATABASE_URI&#x27;</span>] = <span class="hljs-string">&#x27;sqlite:///students.sqlite3&#x27;</span><br>app.config[<span class="hljs-string">&#x27;SECRET_KEY&#x27;</span>] = <span class="hljs-string">&#x27;flask sqlalchemy&#x27;</span><br><br>db = SQLAlchemy(app)<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">students</span>(db.Model):                           <span class="hljs-comment"># students类继承自db.Model类</span><br>    <span class="hljs-built_in">id</span> = db.Column(<span class="hljs-string">&#x27;id&#x27;</span>, db.Integer, primary_key=<span class="hljs-literal">True</span>)<br>    name = db.Column(db.String(<span class="hljs-number">100</span>))                <span class="hljs-comment"># 定义了id、name、city和address四个属性</span><br>    city = db.Column(db.String(<span class="hljs-number">50</span>))<br>    address = db.Column(db.String(<span class="hljs-number">200</span>))<br>    pincode = db.Column(db.String(<span class="hljs-number">10</span>))<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, name, city, address, pincode</span>):<br>        self.name = name                            <span class="hljs-comment"># 定义构造函数，使用四个参数初始化类实例的属性</span><br>        self.city = city<br>        self.address = address<br>        self.pincode = pincode                      <span class="hljs-comment"># 访问[http://127.0.0.1:5000]</span><br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)                                     </span><span class="hljs-comment"># 主应用程序定义两个路由器，“/”和“/sqlalnew”</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">sqlal_show</span>():                                   <span class="hljs-comment"># 访问根路径时渲染sqlalshow.html并显示所有记录</span><br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;sqlalshow.html&#x27;</span>, students=students.query.<span class="hljs-built_in">all</span>())<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/sqlalnew&#x27;</span>, methods=[<span class="hljs-string">&#x27;GET&#x27;</span>, <span class="hljs-string">&#x27;POST&#x27;</span>]</span>)    </span><span class="hljs-comment"># 访问“/sqlalnew”路径时渲染sqlalnew.html模板</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">sqlal_new</span>():                                    <span class="hljs-comment"># 并允许用户添加新的记录到SQLite3数据库中</span><br>    <span class="hljs-keyword">if</span> request.method == <span class="hljs-string">&#x27;POST&#x27;</span>:                    <span class="hljs-comment"># 表单校验，如果用户提交失败，则显示错误消息</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> request.form[<span class="hljs-string">&#x27;name&#x27;</span>] <span class="hljs-keyword">or</span> <span class="hljs-keyword">not</span> request.form[<span class="hljs-string">&#x27;city&#x27;</span>] <span class="hljs-keyword">or</span> <span class="hljs-keyword">not</span> request.form[<span class="hljs-string">&#x27;address&#x27;</span>]:<br>            flash(<span class="hljs-string">&#x27;请输入所有字段！&#x27;</span>, <span class="hljs-string">&#x27;error&#x27;</span>)<br>        <span class="hljs-keyword">else</span>:                                       <span class="hljs-comment"># 用户提交成功，则将新记录添加到数据库中</span><br>            student = students(request.form[<span class="hljs-string">&#x27;name&#x27;</span>], request.form[<span class="hljs-string">&#x27;city&#x27;</span>],<br>                               request.form[<span class="hljs-string">&#x27;address&#x27;</span>], request.form[<span class="hljs-string">&#x27;pincode&#x27;</span>])<br>            db.session.add(student)                 <span class="hljs-comment"># session对象执行CRUD的插入映射表操作</span><br>            db.session.commit()<br>            flash(<span class="hljs-string">&#x27;记录添加成功！&#x27;</span>)<br>            <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&#x27;sqlal_show&#x27;</span>))  <span class="hljs-comment"># 在任何情况下，都会将用户重定向回显示页面</span><br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;sqlalnew.html&#x27;</span>)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-keyword">with</span> app.app_context():                         <span class="hljs-comment"># 创建一个应用程序上下文</span><br>        db.create_all()                             <span class="hljs-comment"># 调用db.create_all()函数以创建数据库表</span><br>    <br>    <span class="hljs-comment"># 若执行时报错ImportError: cannot import name &#x27;EVENT_TYPE_OPENED&#x27; from &#x27;watchdog.events&#x27;</span><br>    app.run(debug=<span class="hljs-literal">True</span>)                             <span class="hljs-comment"># 升级：pip install --upgrade watchdog</span><br></code></pre></td></tr></table></figure>



<h4 id="2-sqlalnew-html"><a href="#2-sqlalnew-html" class="headerlink" title="(2) sqlalnew.html"></a>(2) sqlalnew.html</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs Html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>表单填写<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&#x27;text-align: center;&#x27;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>Flask-SQLAlchemy 实例<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">hr</span>&gt;</span><span class="hljs-comment">&lt;!-- 水平线标签 --&gt;</span><br>    &#123;% for category, message in get_flashed_messages(with_categories = true) %&#125;<br>        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&#x27;alert alert-danger&#x27;</span>&gt;</span><br>            &#123;&#123; message &#125;&#125;<br>        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    &#123;% endfor %&#125;<br>    <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&#x27;&#123;&#123; request.path &#125;&#125;&#x27;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&#x27;post&#x27;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&#x27;name&#x27;</span>&gt;</span>姓名<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&#x27;name&#x27;</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&#x27;姓名&#x27;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&#x27;width: 180px; height: 15px;&#x27;</span> /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&#x27;city&#x27;</span>&gt;</span>城市<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&#x27;text&#x27;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&#x27;city&#x27;</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&#x27;城市&#x27;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&#x27;width: 180px; height: 15px;&#x27;</span> /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&#x27;address&#x27;</span>&gt;</span>地址<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">textarea</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&#x27;address&#x27;</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&#x27;地址&#x27;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&#x27;width: 180px; height: 15px;&#x27;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">textarea</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&#x27;pincode&#x27;</span>&gt;</span>认证码<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&#x27;text&#x27;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&#x27;pincode&#x27;</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&#x27;认证码&#x27;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&#x27;width: 180px; height: 15px;&#x27;</span> /&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&#x27;submit&#x27;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&#x27;提交&#x27;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure>



<h4 id="3-sqlalshow-html"><a href="#3-sqlalshow-html" class="headerlink" title="(3) sqlalshow.html"></a>(3) sqlalshow.html</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs Html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>数据操作<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="language-css"></span><br><span class="language-css">        <span class="hljs-selector-tag">body</span> &#123;<span class="hljs-attribute">text-align</span>: center;&#125; <span class="hljs-selector-tag">table</span> &#123;<span class="hljs-attribute">margin</span>: auto;&#125;</span><br><span class="language-css">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;&#123;&#123; url_for(&#x27;sqlal_show&#x27;) &#125;&#125;&quot;</span>&gt;</span>Flask-SQLAlchemy 实例<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">hr</span>&gt;</span><span class="hljs-comment">&lt;!-- 水平线标签 --&gt;</span><br>    &#123;%- for message in get_flashed_messages() %&#125;<br>        &#123;&#123; message &#125;&#125;<br>    &#123;%- endfor %&#125;<br>    <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>学生：(<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;&#123;&#123; url_for(&#x27;sqlal_new&#x27;) &#125;&#125;&quot;</span>&gt;</span>新增<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>)<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">table</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">thead</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>姓名<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>城市<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>地址<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>认证码<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">thead</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">tbody</span>&gt;</span><br>        &#123;% for student in students %&#125;<br>            <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>&#123;&#123; student.name &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>&#123;&#123; student.city &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>&#123;&#123; student.address &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>&#123;&#123; student.pincode &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br>        &#123;% endfor %&#125;<br>        <span class="hljs-tag">&lt;/<span class="hljs-name">tbody</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure>



<h1 id="4-即插视图"><a href="#4-即插视图" class="headerlink" title="4 即插视图"></a>4 即插视图</h1><ul>
<li>即插视图<ul>
<li>Pluggable Views，一种处理请求的类，可以根据不同的HTTP方法来执行不同的操作。</li>
<li>基本原则<ul>
<li>视图类必须继承自<code>flask.views.View</code>或其子类，例如：<code>flask.views.MethodView</code>。</li>
<li>可定义多个HTTP方法(例如：GET、POST、PUT、DELETE等)来处理不同类型的请求。</li>
<li>请求到达应用程序时，Flask将使用URL规则匹配器查找与该请求URL相对应的视图函数。</li>
<li>如果找到匹配的视图函数，创建该视图类的实例，并调用该类方法(GET等)来处理请求。</li>
<li>提供可选装饰器和钩子函数，以便在调用视图方法前后执行例如授权验证、日志记录等操作。</li>
<li>视图方法应该返回一个响应对象，通常是响应字符串，或者模板渲染结果，亦或是JSON数据。</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask<br><span class="hljs-keyword">from</span> flask.views <span class="hljs-keyword">import</span> View<br><br>app = Flask(__name__)                           <span class="hljs-comment"># 访问[http://127.0.0.1:5000/hello]</span><br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">HelloWorld</span>(<span class="hljs-title class_ inherited__">View</span>):                         <span class="hljs-comment"># 定义了HelloWorld继承自View的即插视图类</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">dispatch_request</span>(<span class="hljs-params">self</span>):                 <span class="hljs-comment"># 实现dispatch_request方法，处理视图接收到的请求</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&lt;center&gt;Hello, World!&lt;/center&gt;&#x27;</span><br><br><br><span class="hljs-comment"># 用户访问“/hello”时创建HelloWorldView实例，并调用dispatch_request方法来响应请求，返回“Hello, World!”</span><br>app.add_url_rule(<span class="hljs-string">&#x27;/hello&#x27;</span>, view_func=HelloWorld.as_view(<span class="hljs-string">&#x27;Hello&#x27;</span>))<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.run(debug=<span class="hljs-literal">True</span>)<br></code></pre></td></tr></table></figure>



<h2 id="4-1-方法调度"><a href="#4-1-方法调度" class="headerlink" title="4-1 方法调度"></a>4-1 方法调度</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> flask.views <span class="hljs-keyword">import</span> MethodView<br><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, request, jsonify<br><br>app = Flask(__name__)<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">HelloWorld</span>(<span class="hljs-title class_ inherited__">MethodView</span>):                   <span class="hljs-comment"># 访问[http://127.0.0.1:5000/hello]</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get</span>(<span class="hljs-params">self</span>):                              <span class="hljs-comment"># 网页访问“/hello”，响应GET请求</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&lt;center&gt;GET请求&lt;/center&gt;&#x27;</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">post</span>(<span class="hljs-params">self</span>):                             <span class="hljs-comment"># 应用程序启动后，使用JMeter模拟响应POST请求</span><br>        data = request.get_json()               <span class="hljs-comment"># 正确的JSON格式：&#123;&quot;name&quot;: &quot;John&quot;, &quot;surname&quot;: &quot;Doe&quot;&#125;</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">f&#x27;&lt;center&gt;POST请求返回的结果：<span class="hljs-subst">&#123;data&#125;</span>。&lt;/center&gt;&#x27;</span><br>        <span class="hljs-comment"># return jsonify(data)                  # JSON数据的所有属性名都必须使用双引号括起来</span><br><br><br><span class="hljs-comment"># 使用app.add_url_rule()方法将HelloWorld类附加到URL规则上，并将as_view()方法作为视图函数</span><br><span class="hljs-comment"># 为特定的HTTP请求方法指定处理函数，可以使用methods参数，发送POST请求时需设置Content-Type标头</span><br>app.add_url_rule(<span class="hljs-string">&#x27;/hello&#x27;</span>, view_func=HelloWorld.as_view(<span class="hljs-string">&#x27;GET-Request&#x27;</span>), methods=[<span class="hljs-string">&#x27;GET&#x27;</span>])<br>app.add_url_rule(<span class="hljs-string">&#x27;/hello&#x27;</span>, view_func=HelloWorld.as_view(<span class="hljs-string">&#x27;POST-Request&#x27;</span>), methods=[<span class="hljs-string">&#x27;POST&#x27;</span>])<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:                      <span class="hljs-comment"># JMeter需设置信息头管理器</span><br>    app.run(debug=<span class="hljs-literal">True</span>)                         <span class="hljs-comment"># Content-Type为application/json; charset=UTF-8;</span><br></code></pre></td></tr></table></figure>



<h2 id="4-2-装饰视图"><a href="#4-2-装饰视图" class="headerlink" title="4-2 装饰视图"></a>4-2 装饰视图</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> functools <span class="hljs-keyword">import</span> wraps<br><span class="hljs-keyword">from</span> flask.views <span class="hljs-keyword">import</span> MethodView<br><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, g, render_template, session, request, redirect<br><br>app = Flask(__name__)                           <span class="hljs-comment"># 访问[http://127.0.0.1:5000/declogin]</span><br><br>app.secret_key = <span class="hljs-string">b&#x27;flask decorating views&#x27;</span><br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">LoginView</span>(<span class="hljs-title class_ inherited__">MethodView</span>):                    <span class="hljs-comment"># LoginView是继承自MethodView基类的视图类</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get</span>(<span class="hljs-params">self</span>):                              <span class="hljs-comment"># 该类包含了一个get()方法和一个post()方法</span><br>        <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;declogin.html&#x27;</span>)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">post</span>(<span class="hljs-params">self</span>):<br>        username = request.form[<span class="hljs-string">&#x27;username&#x27;</span>]     <span class="hljs-comment"># 若输入用户名admin，密码12345，则跳转dechello.html</span><br>        password = request.form[<span class="hljs-string">&#x27;password&#x27;</span>]     <span class="hljs-comment"># 否则显示&#x27;错误：无效的用户名或密码！&#x27;</span><br><br>        <span class="hljs-keyword">if</span> username == <span class="hljs-string">&#x27;admin&#x27;</span> <span class="hljs-keyword">and</span> password == <span class="hljs-string">&#x27;12345&#x27;</span>:<br>            g.user = &#123;<span class="hljs-string">&#x27;username&#x27;</span>: username&#125;<br>            session[<span class="hljs-string">&#x27;user&#x27;</span>] = g.user            <span class="hljs-comment"># 通过验证设置g.user</span><br>            <span class="hljs-keyword">return</span> redirect(<span class="hljs-string">&#x27;/dechello&#x27;</span>)        <span class="hljs-comment"># 重定向到受保护的页面</span><br>        <span class="hljs-keyword">else</span>:<br>            error = <span class="hljs-string">&#x27;错误：无效的用户名或密码！&#x27;</span><br>            <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;declogin.html&#x27;</span>, error=error)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">login_required</span>(<span class="hljs-params">f</span>):                          <span class="hljs-comment"># login_required装饰器函数接受一个函数作为参数</span><br><span class="hljs-meta">    @wraps(<span class="hljs-params">f</span>)                                   </span><span class="hljs-comment"># 并返回一个新的函数，调用原始函数，登录或返回401</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">decorated_function</span>(<span class="hljs-params">*args, **kwargs</span>):    <span class="hljs-comment"># 若未登录进行访问[http://127.0.0.1:5000/dechello]</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> session.get(<span class="hljs-string">&#x27;user&#x27;</span>):             <span class="hljs-comment"># 则页面将显示&#x27;请登录后再进行访问！&#x27;</span><br>            <span class="hljs-keyword">return</span> unauthorized(<span class="hljs-string">&#x27;请登录后再进行访问！&#x27;</span>)<br>        <span class="hljs-keyword">else</span>:<br>            g.user = session[<span class="hljs-string">&#x27;user&#x27;</span>]<br>            <span class="hljs-keyword">return</span> f(*args, **kwargs)<br><br>    <span class="hljs-keyword">return</span> decorated_function<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">unauthorized</span>(<span class="hljs-params">message</span>):<br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;decerror.html&#x27;</span>, message=message), <span class="hljs-number">401</span><br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">HelloView</span>(<span class="hljs-title class_ inherited__">MethodView</span>):<br>    decorators = [login_required]               <span class="hljs-comment"># 引用装饰器函数</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get</span>(<span class="hljs-params">self</span>):<br>        message = <span class="hljs-string">&#x27;Hello, %s!&#x27;</span> % g.user[<span class="hljs-string">&#x27;username&#x27;</span>]<br>        <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;dechello.html&#x27;</span>, message=message)<br><br><br>app.add_url_rule(<span class="hljs-string">&#x27;/declogin&#x27;</span>, view_func=LoginView.as_view(<span class="hljs-string">&#x27;login&#x27;</span>))<br>app.add_url_rule(<span class="hljs-string">&#x27;/dechello&#x27;</span>, view_func=HelloView.as_view(<span class="hljs-string">&#x27;hello&#x27;</span>))<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.run(debug=<span class="hljs-literal">True</span>)<br></code></pre></td></tr></table></figure>



<h4 id="1-declogin-html"><a href="#1-declogin-html" class="headerlink" title="(1) declogin.html"></a>(1) declogin.html</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs Html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>登录页面<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>	<span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="language-css"></span><br><span class="language-css">        <span class="hljs-selector-tag">body</span> &#123;<span class="hljs-attribute">text-align</span>: center;&#125;</span><br><span class="language-css">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>	&#123;% if error %&#125;<br>		<span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>&#123;&#123; error &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>	&#123;% endif %&#125;<br>	<span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;&#123;&#123; url_for(&#x27;login&#x27;) &#125;&#125;&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&#x27;post&#x27;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>		<span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&#x27;username&#x27;</span>&gt;</span>用户名：<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><br>		<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&#x27;text&#x27;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&#x27;username&#x27;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&#x27;username&#x27;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>		<span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&#x27;password&#x27;</span>&gt;</span>密<span class="hljs-symbol">&amp;emsp;</span>码：<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><br>		<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&#x27;password&#x27;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&#x27;password&#x27;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&#x27;password&#x27;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>		<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&#x27;submit&#x27;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&#x27;提<span class="hljs-symbol">&amp;emsp;</span>交&#x27;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>	<span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure>



<h4 id="2-dechello-html"><a href="#2-dechello-html" class="headerlink" title="(2) dechello.html"></a>(2) dechello.html</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs Html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>欢迎首页<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="language-css"></span><br><span class="language-css">        <span class="hljs-selector-tag">body</span> &#123;<span class="hljs-attribute">text-align</span>: center;&#125;</span><br><span class="language-css">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>	<span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>&#123;&#123; message &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br>	<span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;&#123;&#123; url_for(&#x27;login&#x27;) &#125;&#125;&quot;</span>&gt;</span>退出登录<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure>



<h4 id="3-decerror-html"><a href="#3-decerror-html" class="headerlink" title="(3) decerror.html"></a>(3) decerror.html</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs Html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>错误页面<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="language-css"></span><br><span class="language-css">        <span class="hljs-selector-tag">body</span> &#123;</span><br><span class="language-css">            <span class="hljs-attribute">display</span>: flex;</span><br><span class="language-css">            <span class="hljs-attribute">justify-content</span>: center;</span><br><span class="language-css">            <span class="hljs-attribute">align-items</span>: center;</span><br><span class="language-css">            <span class="hljs-attribute">height</span>: <span class="hljs-number">100vh</span>;</span><br><span class="language-css">        &#125;</span><br><span class="language-css">        <span class="hljs-selector-tag">h1</span> &#123;</span><br><span class="language-css">            <span class="hljs-attribute">text-align</span>: center;</span><br><span class="language-css">            <span class="hljs-attribute">font-size</span>: <span class="hljs-number">27px</span>;</span><br><span class="language-css">            <span class="hljs-attribute">color</span>: <span class="hljs-number">#dc3545</span>;</span><br><span class="language-css">        &#125;</span><br><span class="language-css">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>&#123;&#123; message &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure>



<h2 id="4-3-API的方法视图"><a href="#4-3-API的方法视图" class="headerlink" title="4-3 API的方法视图*"></a>4-3 API的方法视图*</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">import</span> json<br><span class="hljs-keyword">from</span> flask.views <span class="hljs-keyword">import</span> MethodView<br><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, request, render_template, redirect, url_for<br><br>app = Flask(__name__)<br>app.secret_key = <span class="hljs-string">&#x27;flask method view of api&#x27;</span><br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">UserAPI</span>(<span class="hljs-title class_ inherited__">MethodView</span>):                      <span class="hljs-comment"># GET查询、POST添加(或登录)、PUT修改、DELETE删除</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        self.load_users()<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">load_users</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;apidata.json&#x27;</span>, <span class="hljs-string">&#x27;r&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>            self.users = json.load(f)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">save_users</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;apidata.json&#x27;</span>, <span class="hljs-string">&#x27;w&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>            json.dump(self.users, f, indent=<span class="hljs-number">2</span>)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get</span>(<span class="hljs-params">self, user_name=<span class="hljs-literal">None</span></span>):              <span class="hljs-comment"># 根据user_name来获取用户的信息</span><br>        <span class="hljs-built_in">print</span>(request.method)<br>        <span class="hljs-keyword">if</span> user_name <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:                   <span class="hljs-comment"># 访问[http://127.0.0.1:5000/users/]</span><br>            user_all = [<br>                &#123;<span class="hljs-string">&#x27;id&#x27;</span>: user[<span class="hljs-string">&#x27;id&#x27;</span>], <span class="hljs-string">&#x27;name&#x27;</span>: user[<span class="hljs-string">&#x27;name&#x27;</span>], <span class="hljs-string">&#x27;age&#x27;</span>: user[<span class="hljs-string">&#x27;age&#x27;</span>], <span class="hljs-string">&#x27;email&#x27;</span>: user[<span class="hljs-string">&#x27;email&#x27;</span>]&#125; <br>                <span class="hljs-keyword">for</span> user <span class="hljs-keyword">in</span> self.users<br>            ]                                   <span class="hljs-comment"># 如果没有提供user_name，将展示所有用户信息</span><br>            <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;apiusers.html&#x27;</span>, users=user_all)<br>        <span class="hljs-keyword">else</span>:                                   <span class="hljs-comment"># 如果提供user_name，只显示该用户信息</span><br>            user_sigle = <span class="hljs-built_in">next</span>((user <span class="hljs-keyword">for</span> user <span class="hljs-keyword">in</span> self.users <span class="hljs-keyword">if</span> user[<span class="hljs-string">&#x27;name&#x27;</span>] == user_name), <span class="hljs-literal">None</span>)<br>            <span class="hljs-keyword">if</span> user_sigle <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:              <span class="hljs-comment"># 例如访问[http://127.0.0.1:5000/users/Adam]</span><br>                <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;apiusers.html&#x27;</span>, message=<span class="hljs-string">&#x27;没有找到用户，请先添加用户！&#x27;</span>)<br>            <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;apiusers.html&#x27;</span>, users=[user_sigle])<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">post</span>(<span class="hljs-params">self</span>):                             <span class="hljs-comment"># 添加新的用户信息</span><br>        <span class="hljs-built_in">print</span>(request.method)<br>        next_id = <span class="hljs-built_in">max</span>(<span class="hljs-built_in">int</span>(user[<span class="hljs-string">&#x27;id&#x27;</span>]) <span class="hljs-keyword">for</span> user <span class="hljs-keyword">in</span> self.users) + <span class="hljs-number">1</span><br>        name = request.form.get(<span class="hljs-string">&#x27;name&#x27;</span>)<br>        age = request.form.get(<span class="hljs-string">&#x27;age&#x27;</span>)           <span class="hljs-comment"># 添加用户，跳转到[http://127.0.0.1:5000/users/add/]</span><br>        email = request.form.get(<span class="hljs-string">&#x27;email&#x27;</span>)<br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> name <span class="hljs-keyword">or</span> <span class="hljs-keyword">not</span> age <span class="hljs-keyword">or</span> <span class="hljs-keyword">not</span> email:<br>            <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;apiadds.html&#x27;</span>)<br>        new_user = &#123;<span class="hljs-string">&#x27;id&#x27;</span>: next_id, <span class="hljs-string">&#x27;name&#x27;</span>: name, <span class="hljs-string">&#x27;age&#x27;</span>: age, <span class="hljs-string">&#x27;email&#x27;</span>: email&#125;<br>        self.users.append(new_user)<br>        next_id += <span class="hljs-number">1</span><br>        self.save_users()                       <span class="hljs-comment"># 将添加的用户信息写入apidata.json中</span><br>        <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&#x27;user_get&#x27;</span>))    <span class="hljs-comment"># 重定向到用户列表页面</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">put</span>(<span class="hljs-params">self, user_name=<span class="hljs-literal">None</span></span>):              <span class="hljs-comment"># 更新指定用户的代码</span><br>        <span class="hljs-built_in">print</span>(request.method)                   <span class="hljs-comment"># 路由无论如何定义都无法请求到该请求！！！</span><br>        users = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">filter</span>(<span class="hljs-keyword">lambda</span> user: user[<span class="hljs-string">&#x27;name&#x27;</span>] == user_name, self.users))<br>        user = users[<span class="hljs-number">0</span>]                         <span class="hljs-comment"># 使用hidden input传递模拟put请求</span><br>        <span class="hljs-keyword">if</span> request.form.get(<span class="hljs-string">&#x27;_method&#x27;</span>) == <span class="hljs-string">&#x27;PUT&#x27;</span>: <br>            age = request.form.get(<span class="hljs-string">&#x27;age&#x27;</span>)<br>            email = request.form.get(<span class="hljs-string">&#x27;email&#x27;</span>)<br>            user[<span class="hljs-string">&#x27;age&#x27;</span>] = age                   <span class="hljs-comment"># 更新用户信息</span><br>            user[<span class="hljs-string">&#x27;email&#x27;</span>] = email<br>            self.save_users()<br>            <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&#x27;user_get&#x27;</span>))<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;apiedit.html&#x27;</span>, user_name=user_name)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">delete</span>(<span class="hljs-params">self, user_name=<span class="hljs-literal">None</span></span>):           <span class="hljs-comment"># 删除指定用户的代码，修改与删除功能未实现！</span><br>        <span class="hljs-keyword">pass</span><br>        <br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">register_api</span>(<span class="hljs-params">view, endpoint, url, pk=<span class="hljs-string">&#x27;name&#x27;</span>, pk_type=<span class="hljs-string">&#x27;string&#x27;</span></span>):<br>    view_func = view.as_view(endpoint)<br>    app.add_url_rule(url, view_func=view_func, methods=[<span class="hljs-string">&#x27;GET&#x27;</span>])<br>    app.add_url_rule(url, view_func=view_func, methods=[<span class="hljs-string">&#x27;POST&#x27;</span>])<br>    app.add_url_rule(<span class="hljs-string">&#x27;%s&lt;%s:%s&gt;&#x27;</span> % (url, pk_type, pk), view_func=view_func, methods=[<span class="hljs-string">&#x27;GET&#x27;</span>, <span class="hljs-string">&#x27;PUT&#x27;</span>])<br><br><br>register_api(UserAPI, <span class="hljs-string">&#x27;user_get&#x27;</span>, <span class="hljs-string">&#x27;/users/&#x27;</span>, pk=<span class="hljs-string">&#x27;user_name&#x27;</span>)<br>register_api(UserAPI, <span class="hljs-string">&#x27;user_post&#x27;</span>, <span class="hljs-string">&#x27;/users/add/&#x27;</span>)<br>register_api(UserAPI, <span class="hljs-string">&#x27;user_put&#x27;</span>, <span class="hljs-string">&#x27;/users/edit/&#x27;</span>, pk=<span class="hljs-string">&#x27;user_name&#x27;</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.run(debug=<span class="hljs-literal">True</span>)<br></code></pre></td></tr></table></figure>



<h4 id="1-apidata-json"><a href="#1-apidata-json" class="headerlink" title="(1) apidata.json"></a>(1) apidata.json</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs Json"><span class="hljs-punctuation">[</span><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Test&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;age&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">32</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;email&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Test@126.com&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Mike&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;age&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">26</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;email&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Mike@example.com&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Adminstator&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;age&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;27&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;email&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Adminstator@qq.com&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">]</span><br></code></pre></td></tr></table></figure>



<h4 id="2-apiadds-html"><a href="#2-apiadds-html" class="headerlink" title="(2) apiadds.html"></a>(2) apiadds.html</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs Html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>添加用户<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;text-align: center;&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>添加用户信息<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;post&quot;</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;&#123;&#123; url_for(&#x27;user_post&#x27;) &#125;&#125;&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;name&quot;</span>&gt;</span>姓名<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;name&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;age&quot;</span>&gt;</span>年龄<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;age&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;email&quot;</span>&gt;</span>邮箱<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;email&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">&quot;return check()&quot;</span>&gt;</span>提交<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">        <span class="hljs-keyword">function</span> <span class="hljs-title function_">check</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">            <span class="hljs-keyword">var</span> name = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementsByName</span>(<span class="hljs-string">&#x27;name&#x27;</span>)[<span class="hljs-number">0</span>].<span class="hljs-property">value</span>;</span><br><span class="language-javascript">            <span class="hljs-keyword">var</span> age = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementsByName</span>(<span class="hljs-string">&#x27;age&#x27;</span>)[<span class="hljs-number">0</span>].<span class="hljs-property">value</span>;</span><br><span class="language-javascript">            <span class="hljs-keyword">var</span> email = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementsByName</span>(<span class="hljs-string">&#x27;email&#x27;</span>)[<span class="hljs-number">0</span>].<span class="hljs-property">value</span>;</span><br><span class="language-javascript">            <span class="hljs-keyword">if</span> (name === <span class="hljs-string">&#x27;&#x27;</span> || age === <span class="hljs-string">&#x27;&#x27;</span> || email === <span class="hljs-string">&#x27;&#x27;</span>) &#123;</span><br><span class="language-javascript">                <span class="hljs-title function_">alert</span>(<span class="hljs-string">&#x27;请先把信息填写完整，再进行提交！&#x27;</span>);</span><br><span class="language-javascript">                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;          <span class="hljs-comment">// 防止表单提交</span></span><br><span class="language-javascript">            &#125;</span><br><span class="language-javascript">            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;</span><br><span class="language-javascript">        &#125;</span><br><span class="language-javascript">        </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure>



<h4 id="3-apiedit-html"><a href="#3-apiedit-html" class="headerlink" title="(3) apiedit.html"></a>(3) apiedit.html</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs Html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>修改用户<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;text-align: center;&quot;</span>&gt;</span><br>    &#123;% for user in users %&#125;<br>        <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>修改用户“&#123;&#123; user.name &#125;&#125;”信息<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;&#123;&#123; url_for(&#x27;user_put&#x27;, user_name=user.name) &#125;&#125;&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;POST&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;hidden&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;_method&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;PUT&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;age&quot;</span>&gt;</span>年龄<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;age&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;&#123;&#123; user.age &#125;&#125;&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;email&quot;</span>&gt;</span>邮箱<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;email&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;&#123;&#123; user.email &#125;&#125;&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;保存&quot;</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;btn btn-primary&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">formaction</span>=<span class="hljs-string">&quot;&#123;&#123; url_for(&#x27;user_get&#x27;) &#125;&#125;&quot;</span>&gt;</span><br>                    取消<br>                <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br>    &#123;% endfor %&#125;<br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure>



<h4 id="4-apiusers-html"><a href="#4-apiusers-html" class="headerlink" title="(4) apiusers.html"></a>(4) apiusers.html</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs Html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>用户信息<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>&#123;&#123; message &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="language-css"></span><br><span class="language-css">        <span class="hljs-selector-tag">table</span> &#123;<span class="hljs-attribute">margin</span>: auto; <span class="hljs-attribute">border-collapse</span>: collapse;&#125;</span><br><span class="language-css">        <span class="hljs-selector-tag">tr</span><span class="hljs-selector-pseudo">:hover</span> &#123;<span class="hljs-attribute">background-color</span>: <span class="hljs-number">#f5f5f5</span>;&#125;</span><br><span class="language-css">        <span class="hljs-selector-tag">td</span>, <span class="hljs-selector-tag">th</span> &#123;<span class="hljs-attribute">padding</span>: <span class="hljs-number">8px</span>; <span class="hljs-attribute">text-align</span>: left;&#125;</span><br><span class="language-css">        <span class="hljs-selector-tag">th</span> &#123;<span class="hljs-attribute">background-color</span>: <span class="hljs-number">#333</span>; <span class="hljs-attribute">color</span>: <span class="hljs-number">#fff</span>; <span class="hljs-attribute">text-align</span>: center;&#125;</span><br><span class="language-css">        <span class="hljs-selector-tag">td</span> &#123;<span class="hljs-attribute">border-bottom</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#ddd</span>;&#125;</span><br><span class="language-css">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;text-align: center;&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">table</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>识别码<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>姓名<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>年龄<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>邮箱<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>操作<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br>        &#123;% for user in users %&#125;<br>        <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>&#123;&#123; user.id &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>&#123;&#123; user.name &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>&#123;&#123; user.age &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>&#123;&#123; user.email &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;&#123;&#123; url_for(&#x27;user_put&#x27;, user_name=user.name) &#125;&#125;&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;POST&quot;</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;hidden&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;_method&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;PUT&quot;</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;btn btn-primary&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span>&gt;</span>修改<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br>        &#123;% endfor %&#125;<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;post&quot;</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;&#123;&#123; url_for(&#x27;user_post&#x27;) &#125;&#125;&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;btn btn-primary&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span>&gt;</span>添加用户<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure>



<h1 id="5-上下文作用域"><a href="#5-上下文作用域" class="headerlink" title="5 上下文作用域"></a>5 上下文作用域</h1><ul>
<li>上下文作用域<ul>
<li>应用上下文，Application Context。<ul>
<li>是整个Flask应用的上下文环境，用于在不同的线程中共享Flask的应用实例。</li>
<li>使用<code>app.app_context()</code>显式创建，也可通过Flask的方法和函数隐式创建。</li>
</ul>
</li>
<li>请求上下文，Request Context。<ul>
<li>是在每个HTTP请求中创建的上下文，包含了当前请求及其相关信息。</li>
<li>在处理请求的过程中，将创建一个请求上下文，然后将请求对象存储在全局变量request中。</li>
<li>可以访问到请求对象、会话对象和其他工具函数，例如：<code>url_for</code>、<code>render_template</code>等。</li>
</ul>
</li>
<li>测试上下文，Test Context。<ul>
<li>是在Flask进行单元测试时使用的上下文环境。</li>
<li>可使用<code>app.test_request_context()</code>显式创建，也可使用FlaskClient类隐式创建。</li>
<li>可以访问到Flask的应用实例、请求对象和响应对象，从而进行针对Flask应用的测试。</li>
<li>还可以访问Flask提供的测试工具函数，例如：<code>jsonify</code>、<code>make_response</code>等。</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="5-1-应用上下文"><a href="#5-1-应用上下文" class="headerlink" title="5-1 应用上下文"></a>5-1 应用上下文</h2><ul>
<li>应用上下文<ul>
<li>隐式创建，适用于大多情况。<ul>
<li>默认的创建方式，运行应用时每个请求都会隐式地创建应用上下文。</li>
<li>方便使用，不需要额外的代码就可以在Flask中访问g对象来共享数据。</li>
</ul>
</li>
<li>显式创建，适用于特殊场景。<ul>
<li>需要手动创建应用上下文对象，使用更加灵活，可以在请求之外的地方使用应用上下文对象。</li>
<li>例如测试Flask应用时，可能需要显式创建应用上下文来测试应用中的某部分，以确保正确性。</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="1-隐式创建"><a href="#1-隐式创建" class="headerlink" title="(1) 隐式创建"></a>(1) 隐式创建</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, g, current_app         <span class="hljs-comment"># 使用g对象来存储和共享应用上下文中的数据</span><br><br>app = Flask(__name__)<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)                                 </span><span class="hljs-comment"># 访问[127.0.0.1:5000]</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():                                    <span class="hljs-comment"># 定义一个路由函数index</span><br>    app_name = current_app.name                 <span class="hljs-comment"># 在视图函数中获取应用上下文的属性</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;应用名：&quot;</span>, app_name)<br><br>    g.username = <span class="hljs-string">&#x27;administrator&#x27;</span>                <span class="hljs-comment"># 访问根路径时使用g对象将用户名存储在应用上下文中</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;用户名：&quot;</span>, g.username)<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&lt;center&gt;Hello, Flask!&lt;/center&gt;&#x27;</span><br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:                      <span class="hljs-comment"># 返回响应后，应用上下文将被弹出</span><br>    app.run(debug=<span class="hljs-literal">True</span>)                         <span class="hljs-comment"># 确保每个请求之间的数据隔离</span><br></code></pre></td></tr></table></figure>



<h4 id="2-显式创建"><a href="#2-显式创建" class="headerlink" title="(2) 显式创建"></a>(2) 显式创建</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, g<br><br>app = Flask(__name__)<br><br><span class="hljs-keyword">with</span> app.app_context():                         <span class="hljs-comment"># 通过使用上下文管理器来显式创建Flask应用上下文</span><br>    g.my_variable = <span class="hljs-literal">None</span>                        <span class="hljs-comment"># 设置全局变量默认值，将其传递到路由处理函数中</span><br><br><span class="hljs-meta">    @app.before_request</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">set_my_variable</span>():<br>        g.my_variable = <span class="hljs-string">&#x27;Hello, Flask!&#x27;</span>         <span class="hljs-comment"># 执行路由处理函数前，设置g.my_variable变量</span><br><br><span class="hljs-meta">    @app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span>, methods=[<span class="hljs-string">&#x27;GET&#x27;</span>]</span>)            </span><span class="hljs-comment"># 访问[127.0.0.1:5000]</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_my_variable</span>():<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">f&#x27;&lt;center&gt;<span class="hljs-subst">&#123;g.my_variable&#125;</span>&lt;/center&gt;&#x27;</span><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:                      <span class="hljs-comment"># 命令函数结束后，应用上下文将被弹出</span><br>    app.run(debug=<span class="hljs-literal">True</span>)                         <span class="hljs-comment"># 确保每个命令之间的数据隔离</span><br></code></pre></td></tr></table></figure>



<h2 id="5-2-请求上下文"><a href="#5-2-请求上下文" class="headerlink" title="5-2 请求上下文"></a>5-2 请求上下文</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, request<br><br>app = Flask(__name__)<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)                                 </span><span class="hljs-comment"># 访问[127.0.0.1:5000]</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():                                    <span class="hljs-comment"># 只在请求处理函数中才能使用request对象，否则抛出异常</span><br>    url = request.url                           <span class="hljs-comment"># 获取当前请求URL</span><br>    path = request.path                         <span class="hljs-comment"># 获取当前请求路径，request对象是Flask的全局变量</span><br>    method = request.method                     <span class="hljs-comment"># 获取当前请求方法</span><br>    headers = request.headers                   <span class="hljs-comment"># 获取当前请求头部信息</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">f&#x27;&lt;div style=&quot;text-align:center;&quot;&gt;&#x27;</span> \<br>           <span class="hljs-string">f&#x27;&lt;p&gt;Request Path: <span class="hljs-subst">&#123;path&#125;</span>&lt;/p&gt;&lt;p&gt;Request Method: <span class="hljs-subst">&#123;method&#125;</span>&lt;/p&gt;&#x27;</span> \<br>           <span class="hljs-string">f&#x27;&lt;p&gt;Request URL: <span class="hljs-subst">&#123;url&#125;</span>&lt;/p&gt;&lt;p&gt;Request Headers: <span class="hljs-subst">&#123;headers&#125;</span>&lt;/p&gt;&lt;/div&gt;&#x27;</span><br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.run(debug=<span class="hljs-literal">True</span>)<br></code></pre></td></tr></table></figure>



<h4 id="1-回调函数"><a href="#1-回调函数" class="headerlink" title="(1) 回调函数"></a>(1) 回调函数</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, request<br><br>app = Flask(__name__)<br><br><br><span class="hljs-meta">@app.before_request                             </span><span class="hljs-comment"># 在每个请求处理之前执行的回调函数</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">before_request</span>():<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27; * 请求处理前---执行&#x27;</span>)<br><br><br><span class="hljs-meta">@app.after_request                              </span><span class="hljs-comment"># 在每个请求处理之后执行的回调函数</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">after_request</span>(<span class="hljs-params">response</span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27; * 请求处理后---执行&#x27;</span>)<br>    <span class="hljs-keyword">return</span> response<br><br><br><span class="hljs-meta">@app.teardown_request                           </span><span class="hljs-comment"># 在每个请求处理完成并响应客户端后执行的回调函数</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">teardown_request</span>(<span class="hljs-params">exc</span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27; * 请求处理完成并响应客户端后---执行&#x27;</span>)<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)                                 </span><span class="hljs-comment"># 访问[127.0.0.1:5000]</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():                                    <span class="hljs-comment"># 只在请求处理函数中才能使用request对象，否则抛出异常</span><br>    url = request.url                           <span class="hljs-comment"># 获取当前请求URL</span><br>    method = request.method                     <span class="hljs-comment"># 获取当前请求方法</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">f&#x27;&lt;div style=&quot;text-align:center;&quot;&gt;&#x27;</span> \<br>           <span class="hljs-string">f&#x27;&lt;p&gt;Request Method: <span class="hljs-subst">&#123;method&#125;</span>&lt;/p&gt;&lt;p&gt;Request URL: <span class="hljs-subst">&#123;url&#125;</span>&lt;/p&gt;&lt;/div&gt;&#x27;</span><br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.run(debug=<span class="hljs-literal">True</span>)<br></code></pre></td></tr></table></figure>



<h4 id="2-错误处理"><a href="#2-错误处理" class="headerlink" title="(2) 错误处理"></a>(2) 错误处理</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, request<br><br>app = Flask(__name__)<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)                                 </span><span class="hljs-comment"># 访问[127.0.0.1:5000]</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    name = request.form.get(<span class="hljs-string">&#x27;name&#x27;</span>)             <span class="hljs-comment"># 定义一个路由，获取表单中的名字</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> name:                                <span class="hljs-comment"># 名字为空时使用ValueError抛出异常</span><br>        <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&#x27;Name is required.&#x27;</span>)<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">f&#x27;&lt;center&gt;Message: Hello, <span class="hljs-subst">&#123;name&#125;</span>!&lt;/center&gt;&#x27;</span><br><br><br><span class="hljs-meta">@app.errorhandler(<span class="hljs-params">ValueError</span>)                   </span><span class="hljs-comment"># 触发错误处理机制，调用page_not_found</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">page_not_found</span>(<span class="hljs-params">error</span>):                      <span class="hljs-comment"># 404错误，属于页面错误</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">f&#x27;&lt;center&gt;Error: <span class="hljs-subst">&#123;<span class="hljs-built_in">str</span>(error)&#125;</span>&lt;/center&gt;&#x27;</span><br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.run(debug=<span class="hljs-literal">True</span>)<br></code></pre></td></tr></table></figure>



<h4 id="3-全局错误"><a href="#3-全局错误" class="headerlink" title="(3) 全局错误"></a>(3) 全局错误</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask<br><br>app = Flask(__name__)<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)                                 </span><span class="hljs-comment"># 访问[127.0.0.1:5000]</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">f&#x27;&lt;center&gt;Hello, Flask!&lt;/center&gt;&#x27;</span><br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/divide/&lt;int:num&gt;&#x27;</span></span>)                 </span><span class="hljs-comment"># 访问[http://127.0.0.1:5000/divide/0]</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">divide</span>(<span class="hljs-params">num</span>):                                <span class="hljs-comment"># 若传递num为0，抛出异常</span><br>    result = <span class="hljs-number">100</span> / num                          <span class="hljs-comment"># 将被Flask全局错误处理捕获</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">f&#x27;&lt;center&gt;Result: <span class="hljs-subst">&#123;result&#125;</span>.&lt;/center&gt;&#x27;</span><br><br><br><span class="hljs-meta">@app.errorhandler(<span class="hljs-params">Exception</span>)                    </span><span class="hljs-comment"># 捕获到异常，调用handle_exception</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">handle_exception</span>(<span class="hljs-params">e</span>):                        <span class="hljs-comment"># 500页面错误，Internal server error</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">f&#x27;&lt;center&gt;An error occurred: <span class="hljs-subst">&#123;<span class="hljs-built_in">str</span>(e)&#125;</span>&lt;/center&gt;&#x27;</span><br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.run(debug=<span class="hljs-literal">True</span>)<br></code></pre></td></tr></table></figure>



<h4 id="4-异常处理"><a href="#4-异常处理" class="headerlink" title="(4) 异常处理"></a>(4) 异常处理</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, request<br><br>app = Flask(__name__)<br>app.config[<span class="hljs-string">&#x27;DEBUG&#x27;</span>] = <span class="hljs-literal">True</span><br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)                                 </span><span class="hljs-comment"># 访问[127.0.0.1:5000]</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():                                    <span class="hljs-comment"># 请求没有传递name参数，抛出ValueError</span><br>    name = request.form.get(<span class="hljs-string">&#x27;name&#x27;</span>)<br>    <span class="hljs-keyword">try</span>:                                        <span class="hljs-comment"># 使用try...except语句处理异常</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> name:                            <span class="hljs-comment"># 使用raise语句手动触发ValueError异常</span><br>            <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&#x27;Name is missing.&#x27;</span>)<br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        app.logger.error(<span class="hljs-string">f&#x27;Error handling request: <span class="hljs-subst">&#123;e&#125;</span>&#x27;</span>)<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">f&#x27;&lt;center&gt;Error: <span class="hljs-subst">&#123;<span class="hljs-built_in">str</span>(e)&#125;</span>&lt;/center&gt;&#x27;</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">f&#x27;&lt;center&gt;Message: Hello, <span class="hljs-subst">&#123;name&#125;</span>!&lt;/center&gt;&#x27;</span><br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/bye&#x27;</span></span>)                              </span><span class="hljs-comment"># 手动抛出一个Exception异常</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">bye</span>():                                      <span class="hljs-comment"># 访问[127.0.0.1:5000/bye]</span><br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">&#x27;Oops, Something went wrong.&#x27;</span>)<br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        app.logger.error(<span class="hljs-string">f&#x27;Error handling request: <span class="hljs-subst">&#123;e&#125;</span>&#x27;</span>)<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">f&#x27;&lt;center&gt;Error: <span class="hljs-subst">&#123;<span class="hljs-built_in">str</span>(e)&#125;</span>&lt;/center&gt;&#x27;</span><br><br><br><span class="hljs-meta">@app.before_request                             </span><span class="hljs-comment"># 在请求到达应用之前，记录请求日志</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">before_request</span>():<br>    app.logger.info(<span class="hljs-string">f&#x27;Request received: <span class="hljs-subst">&#123;request.method&#125;</span> <span class="hljs-subst">&#123;request.url&#125;</span>&#x27;</span>)<br><br><br><span class="hljs-meta">@app.after_request                              </span><span class="hljs-comment"># 应用发送回答之前，记录HTTP响应代码</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">after_request</span>(<span class="hljs-params">response</span>):<br>    app.logger.info(<span class="hljs-string">f&#x27;Response sent: <span class="hljs-subst">&#123;response.status_code&#125;</span>&#x27;</span>)<br>    <span class="hljs-keyword">return</span> response<br><br><br><span class="hljs-meta">@app.teardown_request                           </span><span class="hljs-comment"># 请求的最后阶段，记录请求结束并打印错误信息</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">teardown_request</span>(<span class="hljs-params">exception</span>):<br>    <span class="hljs-keyword">if</span> exception:<br>        app.logger.error(<span class="hljs-string">f&#x27;Error processing request: <span class="hljs-subst">&#123;exception&#125;</span>&#x27;</span>)<br>    <span class="hljs-keyword">else</span>:<br>        app.logger.info(<span class="hljs-string">&#x27;Request processing finished&#x27;</span>)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.run(debug=<span class="hljs-literal">True</span>)<br></code></pre></td></tr></table></figure>



<h4 id="5-日志记录"><a href="#5-日志记录" class="headerlink" title="(5) 日志记录"></a>(5) 日志记录</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, request<br><br>app = Flask(__name__)<br>app.config[<span class="hljs-string">&#x27;DEBUG&#x27;</span>] = <span class="hljs-literal">True</span>                      <span class="hljs-comment"># 开启DEBUG模式</span><br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)                                 </span><span class="hljs-comment"># 访问[127.0.0.1:5000]</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():                                    <span class="hljs-comment"># app.logger记录请求和应用程序状态</span><br>    app.logger.info(<span class="hljs-string">&#x27;Welcome request successful&#x27;</span>)<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">f&#x27;&lt;center&gt;Message: Welcome to the Flask API!&lt;/center&gt;&#x27;</span><br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/bye&#x27;</span></span>)                              </span><span class="hljs-comment"># 访问[127.0.0.1:5000/bye]</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">bye</span>():<br>    name = request.args.get(<span class="hljs-string">&#x27;name&#x27;</span>)<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> name:<br>        app.logger.error(<span class="hljs-string">&#x27;Name is missing in request&#x27;</span>)<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">f&#x27;&lt;center&gt;Error: Name is missing.&lt;/center&gt;&#x27;</span><br>    app.logger.info(<span class="hljs-string">f&#x27;Hello request successful for name <span class="hljs-subst">&#123;name&#125;</span>&#x27;</span>)<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">f&#x27;&lt;center&gt;Message: Hello, <span class="hljs-subst">&#123;name&#125;</span>!&lt;center&gt;&#x27;</span><br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.run(debug=<span class="hljs-literal">True</span>)<br></code></pre></td></tr></table></figure>



<h4 id="6-销毁回调"><a href="#6-销毁回调" class="headerlink" title="(6) 销毁回调"></a>(6) 销毁回调</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, request<br><br>app = Flask(__name__)<br>app.config[<span class="hljs-string">&#x27;DEBUG&#x27;</span>] = <span class="hljs-literal">True</span><br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span>, methods=[<span class="hljs-string">&#x27;GET&#x27;</span>, <span class="hljs-string">&#x27;POST&#x27;</span>]</span>)        </span><span class="hljs-comment"># 访问[127.0.0.1:5000]</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    <span class="hljs-keyword">if</span> request.method == <span class="hljs-string">&#x27;GET&#x27;</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">            &lt;form method=&quot;post&quot; style=&#x27;text-align: center;&#x27;&gt;</span><br><span class="hljs-string">                &lt;label for=&quot;name&quot;&gt;输入姓名&lt;/label&gt;</span><br><span class="hljs-string">                &lt;input type=&quot;text&quot; id=&quot;name&quot; name=&quot;name&quot;&gt;</span><br><span class="hljs-string">                &lt;button type=&quot;submit&quot;&gt;提交&lt;/button&gt;</span><br><span class="hljs-string">            &lt;/form&gt;</span><br><span class="hljs-string">            &#x27;&#x27;&#x27;</span><br>    <span class="hljs-keyword">elif</span> request.method == <span class="hljs-string">&#x27;POST&#x27;</span>:<br>        name = request.form.get(<span class="hljs-string">&#x27;name&#x27;</span>)<br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> name:<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">f&#x27;&lt;center&gt;Error: Name is missing.&lt;/center&gt;&#x27;</span><br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">f&#x27;&lt;center&gt;Message: Hello, <span class="hljs-subst">&#123;name&#125;</span>!&lt;/center&gt;&#x27;</span><br><br><br><span class="hljs-meta">@app.before_request</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">before_request</span>():<br>    app.logger.info(<span class="hljs-string">f&#x27;Request received: <span class="hljs-subst">&#123;request.method&#125;</span> <span class="hljs-subst">&#123;request.url&#125;</span>&#x27;</span>)<br><br><br><span class="hljs-meta">@app.after_request</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">after_request</span>(<span class="hljs-params">response</span>):<br>    app.logger.info(<span class="hljs-string">f&#x27;Response sent: <span class="hljs-subst">&#123;response.status_code&#125;</span>&#x27;</span>)<br>    <span class="hljs-keyword">return</span> response<br><br><br><span class="hljs-meta">@app.teardown_request                           </span><span class="hljs-comment"># 销毁回调，对请求结束后进行清理操作</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">teardown_request</span>(<span class="hljs-params">exception=<span class="hljs-literal">None</span></span>):           <span class="hljs-comment"># 请求结束时teardown_request函数将被自动调用</span><br>    <span class="hljs-keyword">if</span> exception:<br>        app.logger.error(<span class="hljs-string">f&#x27;Error processing request: <span class="hljs-subst">&#123;exception&#125;</span>&#x27;</span>)<br>    <span class="hljs-keyword">else</span>:<br>        app.logger.info(<span class="hljs-string">&#x27;Request processing finished&#x27;</span>)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.run(debug=<span class="hljs-literal">True</span>)<br></code></pre></td></tr></table></figure>



<h4 id="7-留意代理"><a href="#7-留意代理" class="headerlink" title="(7) 留意代理"></a>(7) 留意代理</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">import</span> threading<br><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, request, current_app<br><br>app = Flask(__name__)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">worker</span>():<br>    <span class="hljs-keyword">with</span> app.app_context():                     <span class="hljs-comment"># 在新线程中打开应用程序上下文</span><br>        <span class="hljs-keyword">with</span> app.test_request_context():        <span class="hljs-comment"># 推送测试请求上下文</span><br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;请求方法：&quot;</span> + request.method)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;应用名称：&quot;</span> + current_app._get_current_object().name)<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)                                 </span><span class="hljs-comment"># _get_current_object()可获取应用程序对象而非代理对象</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():                                    <span class="hljs-comment"># 访问[127.0.0.1:5000]</span><br>    t = threading.Thread(target=worker)<br>    t.start()<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&lt;center&gt;Hello, Flask!&lt;/center&gt;&#x27;</span><br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.run(debug=<span class="hljs-literal">True</span>)<br></code></pre></td></tr></table></figure>



<h2 id="5-3-测试上下文"><a href="#5-3-测试上下文" class="headerlink" title="5-3 测试上下文"></a>5-3 测试上下文</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">import</span> unittest                                 <span class="hljs-comment"># test_context.py</span><br><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, request<br><br>app = Flask(__name__)<br>app.config[<span class="hljs-string">&#x27;TESTING&#x27;</span>] = <span class="hljs-literal">True</span><br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span>, methods=[<span class="hljs-string">&#x27;GET&#x27;</span>, <span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    <span class="hljs-keyword">if</span> request.method == <span class="hljs-string">&#x27;GET&#x27;</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">            &lt;form method=&quot;post&quot; style=&#x27;text-align: center;&#x27;&gt;</span><br><span class="hljs-string">                &lt;label for=&quot;name&quot;&gt;输入姓名&lt;/label&gt;</span><br><span class="hljs-string">                &lt;input type=&quot;text&quot; id=&quot;name&quot; name=&quot;name&quot;&gt;</span><br><span class="hljs-string">                &lt;button type=&quot;submit&quot;&gt;提交&lt;/button&gt;</span><br><span class="hljs-string">            &lt;/form&gt;</span><br><span class="hljs-string">        &#x27;&#x27;&#x27;</span><br>    <span class="hljs-keyword">elif</span> request.method == <span class="hljs-string">&#x27;POST&#x27;</span>:<br>        name = request.form.get(<span class="hljs-string">&#x27;name&#x27;</span>)<br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> name:<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">f&#x27;&lt;center&gt;Error: Name is missing.&lt;/center&gt;&#x27;</span><br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">f&#x27;&lt;center&gt;Message: Hello, <span class="hljs-subst">&#123;name&#125;</span>!&lt;/center&gt;&#x27;</span><br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">TestApp</span>(unittest.TestCase):               <span class="hljs-comment"># 定义了两个测试用例</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">setUp</span>(<span class="hljs-params">self</span>):<br>        self.app = app.test_client()<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_index_get</span>(<span class="hljs-params">self</span>):                   <span class="hljs-comment"># 一个测试请求主页时的行为</span><br>        response = self.app.get(<span class="hljs-string">&#x27;/&#x27;</span>)            <span class="hljs-comment"># 使用测试客户端来发送模拟请求</span><br>        self.assertEqual(response.status_code, <span class="hljs-number">200</span>)<br>        self.assertIn(<span class="hljs-string">b&#x27;&lt;form&#x27;</span>, response.data)  <span class="hljs-comment"># 并断言响应是否符合预期</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_index_post</span>(<span class="hljs-params">self</span>):                  <span class="hljs-comment"># 一个测试提交表单时的行为</span><br>        response = self.app.post(<span class="hljs-string">&#x27;/&#x27;</span>)<br>        self.assertEqual(response.status_code, <span class="hljs-number">200</span>)<br>        self.assertIn(<span class="hljs-string">b&#x27;&lt;center&gt;Error: Name is missing.&lt;/center&gt;&#x27;</span>, response.data)<br><br>        response = self.app.post(<span class="hljs-string">&#x27;/&#x27;</span>, data=&#123;<span class="hljs-string">&#x27;name&#x27;</span>: <span class="hljs-string">&#x27;Alice&#x27;</span>&#125;)<br>        self.assertEqual(response.status_code, <span class="hljs-number">200</span>)<br>        self.assertIn(<span class="hljs-string">b&#x27;&lt;center&gt;Message: Hello, Alice!&lt;/center&gt;&#x27;</span>, response.data)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:                      <span class="hljs-comment"># 命令python test_context.py执行该测试用例</span><br>    unittest.main()                             <span class="hljs-comment"># 都通过为OK，若其中任何一个失败，则FAILED</span><br></code></pre></td></tr></table></figure>



<h1 id="6-蓝图实现模块化"><a href="#6-蓝图实现模块化" class="headerlink" title="6 蓝图实现模块化"></a>6 蓝图实现模块化</h1><ul>
<li>蓝图实现模块化<ul>
<li>允许把不同的URL请求处理程序组成一个蓝图，用于管理应用程序的不同功能部分，使代码易于维护和扩展。</li>
<li>每个模块相互独立，可以单独测试和调试，每个蓝图都有自己的路由和视图，可在主应用程序中注册和卸载。</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">import</span> random<br><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Blueprint                     <span class="hljs-comment"># module.py</span><br><br>blueprint = Blueprint(<span class="hljs-string">&#x27;blueprint&#x27;</span>, __name__)    <span class="hljs-comment"># Blueprint类的构造函数需蓝图名称和模块导入名称</span><br><br><br><span class="hljs-meta">@blueprint.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    num = random.randint(<span class="hljs-number">0</span>, <span class="hljs-number">10</span>)<br>    <span class="hljs-built_in">print</span>(num)<br>    variable = <span class="hljs-string">f&#x27;Hello, Flask! Num: <span class="hljs-subst">&#123;num&#125;</span>.&#x27;</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">f&#x27;&lt;center&gt;<span class="hljs-subst">&#123;variable&#125;</span>&lt;/center&gt;&#x27;</span><br></code></pre></td></tr></table></figure>



<h2 id="6-1-注册蓝图"><a href="#6-1-注册蓝图" class="headerlink" title="6-1 注册蓝图"></a>6-1 注册蓝图</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask                         <span class="hljs-comment"># app.py</span><br><span class="hljs-keyword">from</span> module <span class="hljs-keyword">import</span> blueprint                    <span class="hljs-comment"># 与module.py关联</span><br><br>app = Flask(__name__)                           <span class="hljs-comment"># 访问[127.0.0.1:5000]</span><br><br>app.register_blueprint(blueprint)               <span class="hljs-comment"># 在主应用程序中注册该蓝图</span><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.run(debug=<span class="hljs-literal">True</span>)                         <span class="hljs-comment"># 命令python app.py执行该应用</span><br></code></pre></td></tr></table></figure>



<h2 id="6-2-静态文件"><a href="#6-2-静态文件" class="headerlink" title="6-2 静态文件"></a>6-2 静态文件</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Blueprint                     <span class="hljs-comment"># module.py</span><br><br><span class="hljs-comment"># 使用蓝图对象的static_folder参数指定静态文件的文件夹为“static”</span><br><span class="hljs-comment"># static_url_path参数指定访问该文件夹的路径为“/static”，可放置任何静态文件，例如CSS、JavaScript或图像</span><br>blueprint = Blueprint(<span class="hljs-string">&#x27;blueprint&#x27;</span>, __name__, static_folder=<span class="hljs-string">&#x27;static&#x27;</span>, static_url_path=<span class="hljs-string">&#x27;/static&#x27;</span>)<br><br><span class="hljs-comment"># 通过以下方式在模板中引用上述指定的静态文件</span><br><span class="hljs-comment"># &lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;&#123;&#123;url_for(&#x27;blueprint.static&#x27;, filename=&#x27;style.css&#x27;)&#125;&#125;&quot;&gt;</span><br><span class="hljs-comment"># &lt;script type=&quot;text/javascript&quot; src=&quot;&#123;&#123;url_for(&#x27;blueprint.static&#x27;, filename=&#x27;script.js&#x27;)&#125;&#125;&quot;&gt;&lt;/script&gt;</span><br><span class="hljs-comment"># &lt;img src=&quot;&#123;&#123;url_for(&#x27;blueprint.static&#x27;, filename=&#x27;image.jpg&#x27;)&#125;&#125;&quot; alt=&quot;Image&quot;&gt;</span><br><br><br><span class="hljs-meta">@blueprint.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&lt;center&gt;Hello, Flask!&lt;/center&gt;&#x27;</span><br></code></pre></td></tr></table></figure>



<h2 id="6-3-资源文件夹"><a href="#6-3-资源文件夹" class="headerlink" title="6-3 资源文件夹"></a>6-3 资源文件夹</h2><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs Markdown">&lt;!-- 项目目录结构 --&gt;<br><span class="hljs-bullet">-</span> app.py                                          &lt;!-- 内容不变 --&gt;<br><span class="hljs-bullet">-</span> module.py                                       &lt;!-- 修改文件 --&gt;<br><span class="hljs-bullet">-</span> static<br><span class="hljs-bullet">    -</span> data.json<br><span class="hljs-bullet">-</span> templates<br><span class="hljs-bullet">    -</span> index.html<br>&lt;!-- 命令窗口下执行&#x27;python app.py&#x27;，访问[http://127.0.0.1:5000] --&gt;<br></code></pre></td></tr></table></figure>



<h4 id="1-data-json"><a href="#1-data-json" class="headerlink" title="(1) data.json"></a>(1) data.json</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs Json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;My Website&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;John&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;age&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">30</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;gender&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;male&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;email&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;john@example.com&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;phone&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;123-456-7890&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;address&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;street&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;123 Main St&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;city&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Los Angeles&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;state&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;CA&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;zip&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;90012&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;interests&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;music&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-string">&quot;travel&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-string">&quot;movies&quot;</span><span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>



<h4 id="2-module-py"><a href="#2-module-py" class="headerlink" title="(2) module.py"></a>(2) module.py</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> json<br><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Blueprint, render_template<br><br>blueprint = Blueprint(<span class="hljs-string">&#x27;blueprint&#x27;</span>, __name__,    <span class="hljs-comment"># root_path指定应用程序的根目录</span><br>                      static_folder=<span class="hljs-string">&#x27;static&#x27;</span>,<br>                      static_url_path=<span class="hljs-string">&#x27;/static&#x27;</span>,<br>                      template_folder=<span class="hljs-string">&#x27;templates&#x27;</span>,<br>                      root_path=os.path.abspath(os.path.dirname(__file__)))<br><br><br><span class="hljs-meta">@blueprint.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)                           </span><span class="hljs-comment"># 访问[127.0.0.1:5000]</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    <span class="hljs-keyword">with</span> blueprint.open_resource(<span class="hljs-string">&#x27;static/data.json&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>        data = json.load(f)<br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;index.html&#x27;</span>, data=data)<br></code></pre></td></tr></table></figure>



<h4 id="3-index-html"><a href="#3-index-html" class="headerlink" title="(3) index.html"></a>(3) index.html</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs Html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>&#123;&#123; data.title &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="language-css"></span><br><span class="language-css">        <span class="hljs-selector-tag">body</span> &#123;</span><br><span class="language-css">            <span class="hljs-attribute">font-family</span>: Arial, Helvetica, sans-serif;</span><br><span class="language-css">            <span class="hljs-attribute">text-align</span>: center;  <span class="hljs-comment">/* 将页面内容居中显示 */</span></span><br><span class="language-css">        &#125;</span><br><span class="language-css">        <span class="hljs-selector-tag">h1</span> &#123;<span class="hljs-attribute">color</span>: blue;&#125;</span><br><span class="language-css">        <span class="hljs-selector-tag">p</span> &#123;<span class="hljs-attribute">line-height</span>: <span class="hljs-number">1.5em</span>;&#125;</span><br><span class="language-css">        <span class="hljs-selector-tag">ul</span> &#123;<span class="hljs-attribute">padding</span>: <span class="hljs-number">0px</span>;&#125;</span><br><span class="language-css">        <span class="hljs-selector-tag">table</span> &#123;<span class="hljs-attribute">margin</span>: auto; <span class="hljs-attribute">border-collapse</span>: collapse;&#125;</span><br><span class="language-css">        <span class="hljs-selector-tag">tr</span><span class="hljs-selector-pseudo">:hover</span> &#123;<span class="hljs-attribute">background-color</span>: <span class="hljs-number">#f5f5f5</span>;&#125;</span><br><span class="language-css">        <span class="hljs-selector-tag">td</span> &#123;<span class="hljs-attribute">padding</span>: <span class="hljs-number">8px</span>; <span class="hljs-attribute">text-align</span>: left; <span class="hljs-attribute">border-bottom</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#ddd</span>;&#125;</span><br><span class="language-css">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Hello, &#123;&#123;data.name&#125;&#125;!<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>You are &#123;&#123;data.age&#125;&#125; years old, and your email is &#123;&#123;data.email&#125;&#125;.<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>You live in &#123;&#123;data.address.city&#125;&#125;, &#123;&#123;data.address.state&#125;&#125;.<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>Interests are as follows<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span><br>        &#123;% for interest in data.interests %&#125;<br>            <span class="hljs-tag">&lt;<span class="hljs-name">table</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>&#123;&#123; interest &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span><br>        &#123;% endfor %&#125;<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure>



<h2 id="6-4-蓝图构造URL"><a href="#6-4-蓝图构造URL" class="headerlink" title="6-4 蓝图构造URL"></a>6-4 蓝图构造URL</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Blueprint, url_for, Flask<br><br>app = Flask(__name__)<br>app.config[<span class="hljs-string">&#x27;SERVER_NAME&#x27;</span>] = <span class="hljs-string">&#x27;localhost:5000&#x27;</span>    <span class="hljs-comment"># 设置SERVER_NAME配置</span><br>blueprint = Blueprint(<span class="hljs-string">&#x27;bp&#x27;</span>, __name__, url_prefix=<span class="hljs-string">&#x27;/my&#x27;</span>)<br><br><br><span class="hljs-meta">@blueprint.route(<span class="hljs-params"><span class="hljs-string">&#x27;/index&#x27;</span></span>)                      </span><span class="hljs-comment"># url_prefix指蓝图的URL前缀</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():                                    <span class="hljs-comment"># 访问[http://localhost:5000/my/index]</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&lt;center&gt;Hello, Flask!&lt;/center&gt;&#x27;</span>     <span class="hljs-comment"># 访问[http://127.0.0.1:5000/my/index]无效</span><br><br><br>app.register_blueprint(blueprint)               <span class="hljs-comment"># 注册蓝图</span><br><br><span class="hljs-keyword">with</span> app.app_context():<br>    url = url_for(<span class="hljs-string">&#x27;bp.index&#x27;</span>)                   <span class="hljs-comment"># 使用蓝图构造URL</span><br>    <span class="hljs-built_in">print</span>(url)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.run(debug=<span class="hljs-literal">True</span>)<br></code></pre></td></tr></table></figure>



<h1 id="7-Flask与Shell结合"><a href="#7-Flask与Shell结合" class="headerlink" title="7 Flask与Shell结合"></a>7 Flask与Shell结合</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, g<br><br>app = Flask(__name__)<br><br><br><span class="hljs-meta">@app.before_request</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">before_request</span>():<br>    g.request_start_time = time.time()          <span class="hljs-comment"># request_start_time变量记录请求开始时间</span><br><br><br><span class="hljs-meta">@app.after_request</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">after_request</span>(<span class="hljs-params">response</span>):                    <span class="hljs-comment"># 计算请求执行时间，并使用日志记录功能记录该时间</span><br>    request_time = time.time() - g.request_start_time<br>    app.logger.info(<span class="hljs-string">&#x27;Request Time: %f&#x27;</span>, request_time)<br>    <span class="hljs-keyword">return</span> response<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)                                 </span><span class="hljs-comment"># 访问[127.0.0.1:5000]</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&lt;center&gt;Hello, Flask!&lt;/center&gt;&#x27;</span><br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-keyword">with</span> app.app_context():                     <span class="hljs-comment"># 创建一个请求上下文来启动Flask应用程序</span><br>        app.run(debug=<span class="hljs-literal">True</span>)        <br><br><br><span class="hljs-string">&quot;&quot;&quot; </span><br><span class="hljs-string"># 进入当前文件目录中，鼠标右击Git Bash Here，打开一个终端模拟器，进行以下交互式操作</span><br><span class="hljs-string"># 若报错Error: Could not locate a Flask application. Use ... in the current directory.</span><br><span class="hljs-string">$ export FLASK_APP=yourfilename                 # 注意：这里文件不需要扩展名</span><br><span class="hljs-string">$ flask shell</span><br><span class="hljs-string">Python 3.9.13 (main, Oct 25 2021, 23:51:50) [MSC v.1916 64 bit (AMD64)] on win32</span><br><span class="hljs-string">App: app</span><br><span class="hljs-string">Instance: D:\...\Flask\instance</span><br><span class="hljs-string"><span class="hljs-meta">&gt;&gt;&gt; </span>app                                         # 返回Flask应用程序定义的对象</span><br><span class="hljs-string">&lt;Flask &#x27;app&#x27;&gt;</span><br><span class="hljs-string"><span class="hljs-meta">&gt;&gt;&gt; </span>ctx = app.test_request_context()            # 创建一个测试请求上下文对象ctx</span><br><span class="hljs-string"><span class="hljs-meta">&gt;&gt;&gt; </span>ctx.push()                                  # 将ctx推到栈中，以便访问上下文中的变量和对象</span><br><span class="hljs-string"><span class="hljs-meta">&gt;&gt;&gt; </span>app.preprocess_request()                    # 激活预处理器函数，将在请求处理之前自动调用</span><br><span class="hljs-string"><span class="hljs-meta">&gt;&gt;&gt; </span>app.process_response(app.response_class())  # 激活相应处理器函数，负责处理产生HTTP响应的内容</span><br><span class="hljs-string">&lt;Response 0 bytes [200 OK]&gt;</span><br><span class="hljs-string"><span class="hljs-meta">&gt;&gt;&gt; </span>ctx.pop()                                   # 当测试请求上下文处理完毕后，需要将其从栈中弹出</span><br><span class="hljs-string"><span class="hljs-meta">&gt;&gt;&gt; </span>exit()                                      # 退出Shell会话</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br></code></pre></td></tr></table></figure>



              
            </div>
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/Python/" class="category-chain-item">Python</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/Flask/">#Flask</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>Python Flask</div>
      <div>https://stitch-top.github.io/2021/12/10/python/python13-python-flask/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>Dr.626</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2021年12月10日 22:43:15</div>
        </div>
      
      
      <div class="license-meta-item">
        <div>许可协议</div>
        <div>
          
            
            
              <a target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">
              <span class="hint--top hint--rounded" aria-label="BY - 署名">
                <i class="iconfont icon-by"></i>
              </span>
              </a>
            
              <a target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">
              <span class="hint--top hint--rounded" aria-label="NC - 非商业性使用">
                <i class="iconfont icon-nc"></i>
              </span>
              </a>
            
              <a target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">
              <span class="hint--top hint--rounded" aria-label="SA - 相同方式共享">
                <i class="iconfont icon-sa"></i>
              </span>
              </a>
            
          
        </div>
      </div>
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2022/01/05/ce-shi-gong-ju/tt01-jmeter/tt01-01-chang-yong-zu-jian/" title="常用组件">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">常用组件</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2021/11/03/python/python12-python-mongodb/" title="Python MongoDB">
                        <span class="hidden-mobile">Python MongoDB</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  <article id="comments">
    
  <div id="valine"></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#valine', function() {
      Fluid.utils.createScript('https://cdn.staticfile.org/valine/1.5.1/Valine.min.js', function() {
        var options = Object.assign(
          {"appId":"Jg3BjUa3RtnEFSREy3wsmUR5-MdYXbMMI","appKey":"DwsEb5BeMxwdz0CEJ6MUBdu3","path":"window.location.pathname","placeholder":"赠人玫瑰，手留余香(～o￣3￣)～","avatar":"monsterid","meta":["nick","mail","link"],"requiredFields":["nick","mail"],"pageSize":13,"lang":"zh-CN","highlight":"ture","recordIP":"ture","serverURLs":"","emojiCDN":null,"emojiMaps":null,"enableQQ":"ture"},
          {
            el: "#valine",
            path: window.location.pathname
          }
        )
        new Valine(options);
        Fluid.utils.waitElementVisible('#valine .vcontent', () => {
          var imgSelector = '#valine .vcontent img:not(.vemoji)';
          Fluid.plugins.imageCaption(imgSelector);
          Fluid.plugins.fancyBox(imgSelector);
        })
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


  </article>


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar category-bar" style="margin-left: -1rem">
    





<div class="category-list">
  
  
    
    
    
    <div class="category row nomargin-x">
      <a class="category-item 
          list-group-item category-item-action col-10 col-md-11 col-xm-11" title="Python"
        id="heading-a7f5f35426b927411fc9231b56382173" role="tab" data-toggle="collapse" href="#collapse-a7f5f35426b927411fc9231b56382173"
        aria-expanded="true"
      >
        Python
        <span class="list-group-count">(13)</span>
        <i class="iconfont icon-arrowright"></i>
      </a>
      
      <div class="category-collapse collapse show" id="collapse-a7f5f35426b927411fc9231b56382173"
           role="tabpanel" aria-labelledby="heading-a7f5f35426b927411fc9231b56382173">
        
        
          
  <div class="category-post-list">
    
    
      
      
        <a href="/2021/01/01/python/python01-python-ji-chu-yi/" title="Python 基础(一)"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">Python 基础(一)</span>
        </a>
      
    
      
      
        <a href="/2021/01/15/python/python02-python-ji-chu-er/" title="Python 基础(二)"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">Python 基础(二)</span>
        </a>
      
    
      
      
        <a href="/2021/02/03/python/python03-python-wen-jian-chu-li/" title="Python 文件处理"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">Python 文件处理</span>
        </a>
      
    
      
      
        <a href="/2021/03/01/python/python04-python-numpy-ji-chu/" title="Python NumPy 基础"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">Python NumPy 基础</span>
        </a>
      
    
      
      
        <a href="/2021/04/06/python/python05-python-numpy-sui-ji/" title="Python NumPy 随机"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">Python NumPy 随机</span>
        </a>
      
    
      
      
        <a href="/2021/05/05/python/python06-python-numpy-han-shu/" title="Python NumPy 函数"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">Python NumPy 函数</span>
        </a>
      
    
      
      
        <a href="/2021/06/08/python/python07-python-pandas/" title="Python Pandas"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">Python Pandas</span>
        </a>
      
    
      
      
        <a href="/2021/07/09/python/python08-python-scipy/" title="Python SciPy"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">Python SciPy</span>
        </a>
      
    
      
      
        <a href="/2021/08/02/python/python09-python-matplotlib/" title="Python Matplotlib"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">Python Matplotlib</span>
        </a>
      
    
      
      
        <a href="/2021/09/04/python/python10-python-ji-qi-xue-xi/" title="Python 机器学习"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">Python 机器学习</span>
        </a>
      
    
      
      
        <a href="/2021/10/07/python/python11-python-mysql/" title="Python MySQL"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">Python MySQL</span>
        </a>
      
    
      
      
        <a href="/2021/11/03/python/python12-python-mongodb/" title="Python MongoDB"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">Python MongoDB</span>
        </a>
      
    
      
      
        <a href="/2021/12/10/python/python13-python-flask/" title="Python Flask"
           class="list-group-item list-group-item-action
           active">
          <span class="category-post">Python Flask</span>
        </a>
      
    
  </div>

        
      </div>
    </div>
  
</div>


  </aside>


    </div>
  </div>
</div>





  



  



  



  



  






    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a><span>Copyright © 2021 - 2024</span></a> <i class="iconfont icon-love"></i> <a href="https://stitch-top.github.io" target="_blank" rel="nofollow noopener"><span>Dr.626</span></a> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="leancloud-site-pv-container" style="display: none">
        📈 总访问量 
        <span id="leancloud-site-pv"></span>
         次
      </span>
    
    
      <span id="leancloud-site-uv-container" style="display: none">
        🌹 📊 总访客数 
        <span id="leancloud-site-uv"></span>
         人
      </span>
    
    

  
</div>

  
  
  
  
  <!-- 添加网站运行时间 -->
  <div class="footer-content">
    <div>
      <span id="timeDate">载入天数...</span>
      <span id="times">载入时分秒...</span>
      <script>
      var now = new Date();
      function createtime(){
          var grt= new Date("01/01/2021 00:00:00");   //此处修改你的建站时间或者网站上线时间
          now.setTime(now.getTime()+250);
          days = (now - grt ) / 1000 / 60 / 60 / 24;
          dnum = Math.floor(days);
          hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum);
          hnum = Math.floor(hours);
          if(String(hnum).length ==1 ){
              hnum = "0" + hnum;
          }
          minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum);
          mnum = Math.floor(minutes);
          if(String(mnum).length ==1 ){
                    mnum = "0" + mnum;
          }
          seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);
          snum = Math.round(seconds);
          if(String(snum).length ==1 ){
                    snum = "0" + snum;
          }
          document.getElementById("timeDate").innerHTML = "本站已安全运行&nbsp"+dnum+"&nbsp天";
          document.getElementById("times").innerHTML = hnum + "&nbsp小时&nbsp" + mnum + "&nbsp分&nbsp" + snum + "&nbsp秒";
      }
      setInterval("createtime()", 250);
      </script>
    </div>
  </div>
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://cdn.staticfile.org/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.staticfile.org/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.staticfile.org/jquery/3.7.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  

  

  

  

  

  

  
    
  




  
    
      <script  src="/js/img-lazyload.js" ></script>
    
  




  
<script>
  Fluid.utils.createScript('https://cdn.staticfile.org/tocbot/4.21.0/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      headingSelector : CONFIG.toc.headingSelector || 'h1,h2,h3,h4,h5,h6',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      collapseDepth   : CONFIG.toc.collapseDepth || 0,
      scrollSmooth    : true,
      headingsOffset  : -boardTop
    });
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }
  });
</script>


  <script>
  (function() {
    var enableLang = CONFIG.code_language.enable && CONFIG.code_language.default;
    var enableCopy = CONFIG.copy_btn;
    if (!enableLang && !enableCopy) {
      return;
    }

    function getBgClass(ele) {
      return Fluid.utils.getBackgroundLightness(ele) >= 0 ? 'code-widget-light' : 'code-widget-dark';
    }

    var copyTmpl = '';
    copyTmpl += '<div class="code-widget">';
    copyTmpl += 'LANG';
    copyTmpl += '</div>';
    jQuery('.markdown-body pre').each(function() {
      var $pre = jQuery(this);
      if ($pre.find('code.mermaid').length > 0) {
        return;
      }
      if ($pre.find('span.line').length > 0) {
        return;
      }

      var lang = '';

      if (enableLang) {
        lang = CONFIG.code_language.default;
        if ($pre[0].children.length > 0 && $pre[0].children[0].classList.length >= 2 && $pre.children().hasClass('hljs')) {
          lang = $pre[0].children[0].classList[1];
        } else if ($pre[0].getAttribute('data-language')) {
          lang = $pre[0].getAttribute('data-language');
        } else if ($pre.parent().hasClass('sourceCode') && $pre[0].children.length > 0 && $pre[0].children[0].classList.length >= 2) {
          lang = $pre[0].children[0].classList[1];
          $pre.parent().addClass('code-wrapper');
        } else if ($pre.parent().hasClass('markdown-body') && $pre[0].classList.length === 0) {
          $pre.wrap('<div class="code-wrapper"></div>');
        }
        lang = lang.toUpperCase().replace('NONE', CONFIG.code_language.default);
      }
      $pre.append(copyTmpl.replace('LANG', lang).replace('code-widget">',
        getBgClass($pre[0]) + (enableCopy ? ' code-widget copy-btn" data-clipboard-snippet><i class="iconfont icon-copy"></i>' : ' code-widget">')));

      if (enableCopy) {
        Fluid.utils.createScript('https://cdn.staticfile.org/clipboard.js/2.0.11/clipboard.min.js', function() {
          var clipboard = new window.ClipboardJS('.copy-btn', {
            target: function(trigger) {
              var nodes = trigger.parentNode.childNodes;
              for (var i = 0; i < nodes.length; i++) {
                if (nodes[i].tagName === 'CODE') {
                  return nodes[i];
                }
              }
            }
          });
          clipboard.on('success', function(e) {
            e.clearSelection();
            e.trigger.innerHTML = e.trigger.innerHTML.replace('icon-copy', 'icon-success');
            setTimeout(function() {
              e.trigger.innerHTML = e.trigger.innerHTML.replace('icon-success', 'icon-copy');
            }, 2000);
          });
        });
      }
    });
  })();
</script>


  
<script>
  Fluid.utils.createScript('https://cdn.staticfile.org/anchor-js/5.0.0/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));
  });
</script>


  
<script>
  Fluid.utils.createScript('https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="/js/leancloud.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
