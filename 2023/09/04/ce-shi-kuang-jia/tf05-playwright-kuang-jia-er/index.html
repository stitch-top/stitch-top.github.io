

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/logo.png">
  <link rel="icon" href="/img/logo.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Dr.626">
  <meta name="keywords" content="">
  
    <meta name="description" content="Playwright用于跨浏览器测试，支持Chrome、Firefox、Edge等，提供一个简单而强大的API模拟用户在浏览器中的交互操作。">
<meta property="og:type" content="article">
<meta property="og:title" content="PlayWright 框架(二)">
<meta property="og:url" content="https://stitch-top.github.io/2023/09/04/ce-shi-kuang-jia/tf05-playwright-kuang-jia-er/index.html">
<meta property="og:site_name" content="Dr.626">
<meta property="og:description" content="Playwright用于跨浏览器测试，支持Chrome、Firefox、Edge等，提供一个简单而强大的API模拟用户在浏览器中的交互操作。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://stitch-top.github.io/img/ThemeMap/9314065155.jpg">
<meta property="article:published_time" content="2023-09-04T13:10:10.000Z">
<meta property="article:modified_time" content="2023-12-17T08:17:20.852Z">
<meta property="article:author" content="Dr.626">
<meta property="article:tag" content="Python">
<meta property="article:tag" content="PlayWright">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://stitch-top.github.io/img/ThemeMap/9314065155.jpg">
  
  
    <meta name="referrer" content="no-referrer-when-downgrade">
  
  
  <title>PlayWright 框架(二) - Dr.626</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  



  
<link rel="stylesheet" href="/css/my.css">
<link rel="stylesheet" href="/css/scrollbar.css">



  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"stitch-top.github.io","root":"/","version":"1.9.0","typing":{"enable":true,"typeSpeed":70,"cursorChar":"|","loop":true,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":"(ง •_•)ง"},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"left","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/load.gif","onlypost":true,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>

  
  
<meta name="generator" content="Hexo 6.2.0"></head>


<body>
  
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Dr.626</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-link-fill"></i>
                友链
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/back.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="PlayWright 框架(二)"></span>
          
        </div>

        
          
  <div class="mt-3">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-author" aria-hidden="true"></i>
        Dr.626
      </span>
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2023-09-04 21:10" pubdate>
          2023年9月4日 21:10:10
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          49k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          411 分钟
        
      </span>
    

    
    
      
        <span id="busuanzi_container_page_pv" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="busuanzi_value_page_pv"></span> 次
        </span>
        
      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
  
  <!-- 动态线条背景 -->
  <script type="text/javascript"
  color="0 0 255" opacity='1' zIndex="-2" count="200" src="../js/canvas-nest.js">
  </script>
  
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="padding-left: 2rem; margin-right: -1rem">
    <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">PlayWright 框架(二)</h1>
            
            <div class="markdown-body">
              
              <p>Playwright用于跨浏览器测试，支持Chrome、Firefox、Edge等，提供一个简单而强大的API模拟用户在浏览器中的交互操作。</p>
<span id="more"></span>



<h1 id="1-方法汇总"><a href="#1-方法汇总" class="headerlink" title="1 方法汇总"></a>1 方法汇总</h1><ul>
<li>方法汇总<ul>
<li>Playwright中的测试层级：Browser &gt; Context &gt; Page &gt; Locator &gt; ElementHandle。</li>
<li>Page对象：直接在整个页面范围内进行元素查找和判断。<ul>
<li><code>page.is_hidden(selector: str)</code>·····判断指定选择器对应的元素是否隐藏</li>
<li><code>page.is_visible(selector: str)</code>····判断指定选择器对应的元素是否可见</li>
<li><code>page.is_enabled(selector: str)</code>····判断指定选择器对应的元素是否可用</li>
<li><code>page.is_editable(selector: str)</code>···判断指定选择器对应的元素是否可编辑</li>
<li><code>page.is_disabled(selector: str)</code>···判断指定选择器对应的元素是否不可用</li>
<li><code>page.is_checked(selector: str)</code>····判断指定选择器对应的单选Radio或复选Checkbox，元素是否被选中</li>
</ul>
</li>
<li>Locator对象：通过Page页面对象的定位方法，例如使用<code>page.locator(selector)</code>来获取ElementHandle元素句柄。<ul>
<li><code>locator.is_hidden()</code>···············判断该定位器对象对应的元素是否隐藏</li>
<li><code>locator.is_visible()</code>··············判断该定位器对象对应的元素是否可见</li>
<li><code>locator.is_enabled()</code>··············判断该定位器对象对应的元素是否可用</li>
<li><code>locator.is_editable()</code>·············判断该定位器对象对应的元素是否可编辑</li>
<li><code>locator.is_disabled()</code>·············判断该定位器对象对应的元素是否不可用</li>
<li><code>locator.is_checked()</code>··············判断该定位器对象对应的单选Radio或复选Checkbox，元素是否被选中</li>
</ul>
</li>
<li>ElementHandle对象：通过使用<code>page.query_selector()</code>方法，来调用返回的ElementHandle元素句柄，一般不常用。<ul>
<li><code>element_handle.is_hidden()</code>········判断该元素句柄对象对应的元素是否隐藏</li>
<li><code>element_handle.is_visible()</code>·······判断该元素句柄对象对应的元素是否可见</li>
<li><code>element_handle.is_enabled()</code>·······判断该元素句柄对象对应的元素是否可用</li>
<li><code>element_handle.is_editable()</code>······判断该元素句柄对象对应的元素是否可编辑</li>
<li><code>element_handle.is_disabled()</code>······判断该元素句柄对象对应的元素是否不可用</li>
<li><code>element_handle.is_checked()</code>·······判断该元素句柄对象对应的单选Radio或复选Checkbox，元素是否被选中</li>
</ul>
</li>
<li>Expect常用的断言方法<ul>
<li><code>expect(api_response).to_be_ok()</code>·········断言API响应是否成功</li>
<li>Page页面断言<ul>
<li><code>expect(page).to_have_url()</code>··········断言页面的URL是否符合预期</li>
<li><code>expect(page).not_to_have_url()</code>······断言页面的URL是否不存在</li>
<li><code>expect(page).to_have_title()</code>········断言页面的标题是否符合预期</li>
<li><code>expect(page).not_to_have_title()</code>····断言页面的标题是否不存在</li>
</ul>
</li>
<li><code>expect(locator).to_be_empty()</code>···········断言locator对应的元素是否为空</li>
<li><code>expect(locator).to_be_hidden()</code>··········断言locator对应的元素是否隐藏</li>
<li><code>expect(locator).to_be_visible()</code>·········断言locator对应的元素是否可见</li>
<li><code>expect(locator).to_be_enabled()</code>·········断言locator对应的元素是否可用</li>
<li><code>expect(locator).to_be_editable()</code>········断言locator对应的元素是否可编辑</li>
<li><code>expect(locator).to_be_disabled()</code>········断言locator对应的元素是否不可用</li>
<li><code>expect(locator).to_be_focused()</code>·········断言locator对应的元素是否处于焦点状态</li>
<li><code>expect(locator).to_be_checked()</code>·········断言locator对应的复选框或单选框元素是否被选中</li>
<li><code>expect(locator).to_have_id()</code>············断言locator对应的元素是否具有特定的id</li>
<li><code>expect(locator).to_have_count()</code>·········断言locator对应的元素数量是否符合预期</li>
<li><code>expect(locator).to_have_value()</code>·········断言locator对应的元素的值是否符合预期</li>
<li><code>expect(locator).to_have_text()</code>··········断言locator对应的元素是否具有特定的文本</li>
<li><code>expect(locator).to_have_class()</code>·········断言locator对应的元素是否具有特定的类名</li>
<li><code>expect(locator).to_have_css()</code>···········断言locator对应的元素是否具有特定的CSS样式</li>
<li><code>expect(locator).to_have_values()</code>········断言locator对应的元素的值集合是否符合预期</li>
<li><code>expect(locator).to_have_attribute()</code>·····断言locator对应的元素是否具有特定的属性</li>
<li><code>expect(locator).to_have_js_property()</code>···断言locator对应的元素是否具有特定的JavaScript属性</li>
<li><code>expect(locator).to_contain_text()</code>·······断言locator对应的元素是否包含特定的文本</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="1-1-页面导航"><a href="#1-1-页面导航" class="headerlink" title="1-1 页面导航*"></a>1-1 页面导航*</h2><ul>
<li>页面导航<ul>
<li>异步导航(Async navigation)<ul>
<li>指等待页面完成导航的操作，页面完成导航后再执行后续的操作。</li>
<li>可使用<code>page.goto()</code>或<code>page.wait_for_navigation()</code>方法来等待页面导航完成。</li>
<li>异步导航通常用于单一的页面导航，等待页面跳转，或加载完毕后再进行后续操作。</li>
<li>触发的导航：指代导航到新的URL、在同一网页中刷新、后退或前进，这四种情况。</li>
</ul>
</li>
<li>多重导航(Multiple navigations)<ul>
<li>多重导航指连续进行多次页面导航的操作，每次导航都需要等待页面完成跳转或加载。</li>
<li>可使用<code>page.goto()</code>或<code>page.expect_navigation()</code>方法来明确等待特定的导航完成。</li>
<li>通常用于需进行连续多次页面跳转的情况，如应用程序中执行多步骤操作，或测试期间模拟用户浏览。</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">import</span> asyncio<br><span class="hljs-keyword">from</span> playwright.async_api <span class="hljs-keyword">import</span> async_playwright<br><span class="hljs-keyword">from</span> playwright._impl._api_types <span class="hljs-keyword">import</span> TimeoutError<br><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">example</span>():<br>    <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> async_playwright() <span class="hljs-keyword">as</span> p:<br>        browser = <span class="hljs-keyword">await</span> p.chromium.launch(headless=<span class="hljs-literal">False</span>)<br>        page = <span class="hljs-keyword">await</span> browser.new_page()<br><br>        <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">on_navigation</span>(<span class="hljs-params">page, **kwargs</span>):                <span class="hljs-comment"># 监听页面导航事件</span><br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;页面导航完成&quot;</span>)<br>        page.on(<span class="hljs-string">&quot;navigation&quot;</span>, on_navigation)                    <span class="hljs-comment"># 添加导航事件监听器</span><br>        <span class="hljs-keyword">await</span> page.goto(<span class="hljs-string">&quot;https://www.baidu.com/&quot;</span>)               <span class="hljs-comment"># 导航到指定URL</span><br>        <span class="hljs-keyword">try</span>:<br>            <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> page.expect_navigation():                <span class="hljs-comment"># 等待页面导航完成</span><br>                <span class="hljs-keyword">await</span> page.click(<span class="hljs-string">&#x27;//*[@id=&quot;s-top-left&quot;]/a[1]&#x27;</span>)<br>        <span class="hljs-keyword">except</span> TimeoutError:                                    <span class="hljs-comment"># 为啥还会导航超时？</span><br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;页面导航超时&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;页面导航完成，新页面加载成功&quot;</span>)<br><br>        <span class="hljs-keyword">await</span> browser.close()                                   <span class="hljs-comment"># 关闭浏览器</span><br><br>asyncio.run(example())                                          <span class="hljs-comment"># 运行代码</span><br></code></pre></td></tr></table></figure>



<h2 id="1-2-高级模式"><a href="#1-2-高级模式" class="headerlink" title="1-2 高级模式"></a>1-2 高级模式</h2><ul>
<li>高级模式<ul>
<li><code>page.wait_for_function()</code>：用于等待指定的JavaScript函数返回true或非空结果。</li>
<li>可用于检查页面上的某些条件是否满足，例如：等待特定元素出现或特定文本被更新。</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">import</span> asyncio<br><span class="hljs-keyword">from</span> playwright.async_api <span class="hljs-keyword">import</span> async_playwright<br><br><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">wait_for_example</span>():<br>    <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> async_playwright() <span class="hljs-keyword">as</span> p:<br>        browser = <span class="hljs-keyword">await</span> p.chromium.launch(headless=<span class="hljs-literal">False</span>)<br>        page = <span class="hljs-keyword">await</span> browser.new_page()<br><br>        <span class="hljs-keyword">await</span> page.goto(<span class="hljs-string">&#x27;https://www.baidu.com/&#x27;</span>)               <span class="hljs-comment"># 打开页面</span><br>        <span class="hljs-keyword">await</span> page.wait_for_function(                           <span class="hljs-comment"># 等待页面上的标题元素出现</span><br>            <span class="hljs-string">&#x27;() =&gt; document.querySelector(&quot;title&quot;) !== null&#x27;</span><br>        )<br>        title_text = <span class="hljs-keyword">await</span> page.evaluate(                       <span class="hljs-comment"># 检查标题文本是否符合预期</span><br>            <span class="hljs-string">&#x27;document.querySelector(&quot;title&quot;).textContent&#x27;</span><br>        )<br>        <span class="hljs-keyword">if</span> title_text == <span class="hljs-string">&#x27;百度一下，你就知道&#x27;</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;标题文本符合预期&#x27;</span>)<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;标题文本不符合预期&#x27;</span>)<br><br>        <span class="hljs-keyword">await</span> browser.close()                                   <span class="hljs-comment"># 关闭浏览器对象</span><br><br>asyncio.run(wait_for_example())<br></code></pre></td></tr></table></figure>



<h2 id="1-3-svg元素操作"><a href="#1-3-svg元素操作" class="headerlink" title="1-3 svg元素操作"></a>1-3 svg元素操作</h2><ul>
<li>svg元素操作<ul>
<li>SVG即Scalable Vector Graphics，由W3C制定，用于描述二维矢量图形的XML(可扩展标记语言)文件格式。</li>
<li>无法用普通的标签定位到，如<code>$x(&#39;//svg&#39;)</code>，只能通过<code>name()</code>函数定位，如<code>$x(&quot;//*[name()=&#39;svg&#39;]&quot;)</code>。</li>
<li>如果页面上有多个svg元素，<code>//*[name()=&quot;svg&quot;]</code>将定位出全部的svg元素。<ul>
<li>可以通过父元素来进行区分，例如：<code>//*[@id=&quot;box1&quot;]//*[name()=&quot;svg&quot;]</code>。</li>
<li>可使用<code>and</code>组合其他属性，例如：<code>//*[name()=&quot;svg&quot; and @width=&quot;500&quot;]</code>。</li>
</ul>
</li>
<li>定位svg上的子元素，仍然可以通过<code>name()</code>函数定位，如<code>$x(&quot;//*[name()=&#39;svg&#39;]/*[name()=&#39;path&#39;]&quot;)</code>。</li>
<li>svg元素下的circle是可以拖动的，例如：往右拖动100个像素，那么cx值就由原先的<code>cx=&quot;100&quot;</code>变为<code>cx=200</code>。</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> playwright.sync_api <span class="hljs-keyword">import</span> sync_playwright<br><br><span class="hljs-keyword">with</span> sync_playwright() <span class="hljs-keyword">as</span> p:<br>    browser = p.chromium.launch(headless=<span class="hljs-literal">False</span>)<br>    page = browser.new_page()<br>    page.goto(<span class="hljs-string">&#x27;https://www.w3school.com.cn/svg/circle1.svg&#x27;</span>)<br><br>    circle = page.locator(<br>        <span class="hljs-string">&quot;//*[name()=&#x27;svg&#x27;]/*[name()=&#x27;circle&#x27;]&quot;</span><br>    )                                                           <span class="hljs-comment"># svg元素定位</span><br>    <span class="hljs-built_in">print</span>(circle.bounding_box())<br>    box = circle.bounding_box()<br><br>    circle.evaluate(                                            <span class="hljs-comment"># 添加事件监听</span><br>        <span class="hljs-string">&#x27;node =&gt; node.addEventListener(&quot;mousedown&quot;, function()&#x27;</span><br>        <span class="hljs-string">&#x27;&#123;console.log(&quot;目标元素被鼠标down了&quot;);&#125;);&#x27;</span><br>    )<br><br>    page.mouse.move(                                            <span class="hljs-comment"># svg元素拖拽</span><br>        x=box[<span class="hljs-string">&#x27;x&#x27;</span>] + box[<span class="hljs-string">&#x27;width&#x27;</span>] / <span class="hljs-number">2</span>,<br>        y=box[<span class="hljs-string">&#x27;y&#x27;</span>] + box[<span class="hljs-string">&#x27;height&#x27;</span>] / <span class="hljs-number">2</span><br>    )<br>    page.mouse.down()<br>    page.mouse.move(<br>        x=box[<span class="hljs-string">&#x27;x&#x27;</span>] + box[<span class="hljs-string">&#x27;width&#x27;</span>] / <span class="hljs-number">2</span> + <span class="hljs-number">100</span>,<br>        y=box[<span class="hljs-string">&#x27;y&#x27;</span>] + box[<span class="hljs-string">&#x27;height&#x27;</span>] / <span class="hljs-number">2</span><br>    )<br>    page.mouse.up(button=<span class="hljs-string">&quot;middle&quot;</span>)<br>    page.pause()                                                <span class="hljs-comment"># F12的console查看</span><br><br>    browser.close()                                             <span class="hljs-comment"># 关闭浏览器对象</span><br></code></pre></td></tr></table></figure>



<h2 id="1-4-日期控件输入"><a href="#1-4-日期控件输入" class="headerlink" title="1-4 日期控件输入"></a>1-4 日期控件输入</h2><ul>
<li>日期控件输入<ul>
<li>输入框是日期控件时，先看能否直接输入日期，可以直接输入的情况下就不用点开了。</li>
<li>若有<code>readonly</code>属性就不能直接输入，这种情况下可以使用JavaScript去掉属性再输入。</li>
</ul>
</li>
</ul>
<h4 id="1-直接输入"><a href="#1-直接输入" class="headerlink" title="(1) 直接输入"></a>(1) 直接输入</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> playwright.sync_api <span class="hljs-keyword">import</span> sync_playwright<br><br><span class="hljs-keyword">with</span> sync_playwright() <span class="hljs-keyword">as</span> p:<br>    browser = p.chromium.launch(headless=<span class="hljs-literal">False</span>)<br>    context = browser.new_context()<br>    page = context.new_page()<br>    page.goto(<br>        <span class="hljs-string">r&#x27;http://wyeditor.com/layui_demo/%E6%97%A5%E6%9C%9F&#x27;</span><br>        <span class="hljs-string">r&#x27;%E5%92%8C%E6%97%B6%E9%97%B4%E7%BB%84%E4%BB%B6.html&#x27;</span><br>    )<br>    page.locator(<br>        <span class="hljs-string">&#x27;//*[@id=&quot;LayEdit_267858&quot;]&#x27;</span><br>    ).fill(<span class="hljs-string">&#x27;2023-09-01&#x27;</span>)                                        <span class="hljs-comment"># 日期控件直接输入</span><br>    page.pause()<br><br>    browser.close()                                             <span class="hljs-comment"># 关闭浏览器对象</span><br></code></pre></td></tr></table></figure>



<h4 id="2-readonly"><a href="#2-readonly" class="headerlink" title="(2) readonly"></a>(2) readonly</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> playwright.sync_api <span class="hljs-keyword">import</span> sync_playwright<br><br><span class="hljs-keyword">with</span> sync_playwright() <span class="hljs-keyword">as</span> p:<br>    browser = p.chromium.launch(headless=<span class="hljs-literal">False</span>)<br>    context = browser.new_context()<br>    page = context.new_page()<br>    page.goto(<span class="hljs-string">r&#x27;http://www.jemui.com/jedate/#5&#x27;</span>)<br>    page.locator(<span class="hljs-string">&#x27;//*[@id=&quot;ymd01&quot;]&#x27;</span>).hover()                    <span class="hljs-comment"># 定位悬停到具体位置</span><br>    page.wait_for_timeout(<span class="hljs-number">1000</span>)<br>    js1 = <span class="hljs-string">&#x27;document.getElementById(&quot;ymd01&quot;).removeAttribute(&quot;readonly&quot;);&#x27;</span><br>    page.evaluate(js1)                                          <span class="hljs-comment"># 去掉readonly属性</span><br>    js2 = <span class="hljs-string">&#x27;document.getElementById(&quot;ymd01&quot;).value=&quot;2023-09-01 15:15:15&quot;;&#x27;</span><br>    page.evaluate(js2)<br>    page.pause()<br><br>    browser.close()                                             <span class="hljs-comment"># 关闭浏览器对象</span><br></code></pre></td></tr></table></figure>



<h2 id="1-5-Trace-Viewer"><a href="#1-5-Trace-Viewer" class="headerlink" title="1-5 Trace Viewer"></a>1-5 Trace Viewer</h2><ul>
<li>Trace Viewer<ul>
<li>执行自动化用例的过程中，出现一些不稳定偶然性的Bug，需复现还原Bug出现的过程。</li>
<li>Playwright Trace Viewer可探索记录Playwright的测试跟踪，直观查看操作期间的情况。</li>
<li>查看<ul>
<li>使用Playwright CLI在terminal中输入<code>playwright show-trace trace.zip</code>，打开跟踪。</li>
<li>通过单击每个操作，或使用时间轴悬停来查看测试的痕迹，并查看操作前后页面的状态。</li>
<li>在每个步骤中检查日志、源和网络，跟踪查看器创建一个DOM快照，可与其完全交互，打开devtools等。</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> playwright.sync_api <span class="hljs-keyword">import</span> sync_playwright<br><br><span class="hljs-keyword">with</span> sync_playwright() <span class="hljs-keyword">as</span> p:<br>    browser = p.chromium.launch(headless=<span class="hljs-literal">False</span>)<br>    context = browser.new_context()<br><br>    context.tracing.start(                                      <span class="hljs-comment"># 记录跟踪</span><br>        screenshots=<span class="hljs-literal">True</span>, snapshots=<span class="hljs-literal">True</span>, sources=<span class="hljs-literal">True</span><br>    )<br>    page = context.new_page()<br>    page.goto(<span class="hljs-string">&#x27;https://www.baidu.com/&#x27;</span>)<br>    page.locator(<span class="hljs-string">&#x27;//*[@id=&quot;s-hotsearch-wrapper&quot;]/div/a[1]/div&#x27;</span>).click()<br>    context.tracing.stop(path=<span class="hljs-string">&quot;trace.zip&quot;</span>)                      <span class="hljs-comment"># 保存为.zip文件</span><br><br>    browser.close()                                             <span class="hljs-comment"># 关闭浏览器对象</span><br></code></pre></td></tr></table></figure>



<h2 id="1-6-table表格标签"><a href="#1-6-table表格标签" class="headerlink" title="1-6 table表格标签"></a>1-6 table表格标签</h2><ul>
<li>table表格标签<ul>
<li>table表格的常用标签：table(一个表格)、tr(一行)、th(表头单元格)、td(内容单元格)。</li>
<li>使用xpath定位table表格数据，例如<code>/html/body/div[1]/table[1]/tbody/tr[1]/td[2]</code>。</li>
</ul>
</li>
</ul>
<h4 id="1-表格定位"><a href="#1-表格定位" class="headerlink" title="(1) 表格定位"></a>(1) 表格定位</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> playwright.sync_api <span class="hljs-keyword">import</span> sync_playwright<br><br><span class="hljs-keyword">with</span> sync_playwright() <span class="hljs-keyword">as</span> p:<br>    browser = p.chromium.launch(headless=<span class="hljs-literal">False</span>)<br>    context = browser.new_context()<br>    page = context.new_page()<br>    page.goto(<span class="hljs-string">&#x27;http://www.bootstrapmb.com/item/10229&#x27;</span>)<br>    <span class="hljs-keyword">with</span> context.expect_page() <span class="hljs-keyword">as</span> new_page_info:<br>        page.get_by_text(<span class="hljs-string">&#x27;预 览&#x27;</span>).click()<br>        page.wait_for_timeout(<span class="hljs-number">1000</span>)<br>    new_page = new_page_info.value                              <span class="hljs-comment"># 切换到预览table页</span><br>    <span class="hljs-built_in">print</span>(new_page.title())<br><br>    new_page.wait_for_load_state(<span class="hljs-string">&#x27;networkidle&#x27;</span>)                 <span class="hljs-comment"># 等待页面加载完毕</span><br>    iframe = new_page.frame_locator(<span class="hljs-string">&#x27;//*[@id=&quot;iframe&quot;]&#x27;</span>)<br>    n1 = iframe.locator(<span class="hljs-string">&#x27;//table[2]/tbody/tr&#x27;</span>)<br>    <span class="hljs-comment"># n1 = iframe.locator(&#x27;/html/body/div[1]/table[2]/tbody/tr&#x27;)</span><br>    <span class="hljs-comment"># 报错：playwright._impl._api_types.Error: Unexpected token &quot;/&quot; while parsing selector</span><br>    <span class="hljs-built_in">print</span>(n1.count())                                           <span class="hljs-comment"># 获取内容单元格总行数</span><br>    n2 = iframe.locator(<span class="hljs-string">&#x27;//*[@id=&quot;one-part-th&quot;]&#x27;</span>)<br>    <span class="hljs-built_in">print</span>(n2.inner_text())                                      <span class="hljs-comment"># 获取表头单元格的第二行数据</span><br>    n3 = iframe.locator(<span class="hljs-string">&#x27;//table[2]/tbody/tr/td[4]&#x27;</span>)            <span class="hljs-comment"># 不同tr提取同一td[4]</span><br>    <span class="hljs-keyword">for</span> td <span class="hljs-keyword">in</span> n3.<span class="hljs-built_in">all</span>():<br>        <span class="hljs-built_in">print</span>(td.inner_text())                                  <span class="hljs-comment"># 获取内容单元格第4列的数据</span><br><br>    browser.close()                                             <span class="hljs-comment"># 关闭浏览器对象</span><br></code></pre></td></tr></table></figure>



<h4 id="2-数据获取"><a href="#2-数据获取" class="headerlink" title="(2) 数据获取"></a>(2) 数据获取</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> playwright.sync_api <span class="hljs-keyword">import</span> sync_playwright<br><br><span class="hljs-keyword">with</span> sync_playwright() <span class="hljs-keyword">as</span> p:<br>    browser = p.chromium.launch(headless=<span class="hljs-literal">False</span>)<br>    context = browser.new_context()<br>    page = context.new_page()<br>    page.goto(<span class="hljs-string">&#x27;http://www.bootstrapmb.com/item/14227&#x27;</span>)<br>    <span class="hljs-keyword">with</span> context.expect_page() <span class="hljs-keyword">as</span> new_page_info:<br>        page.get_by_text(<span class="hljs-string">&#x27;预 览&#x27;</span>).click()<br>        page.wait_for_timeout(<span class="hljs-number">1000</span>)<br>    new_page = new_page_info.value                              <span class="hljs-comment"># 切换到预览table页</span><br>    <span class="hljs-built_in">print</span>(new_page.title())<br><br>    new_page.wait_for_load_state(<span class="hljs-string">&#x27;networkidle&#x27;</span>)                 <span class="hljs-comment"># 等待页面加载完毕</span><br>    iframe = new_page.frame_locator(<span class="hljs-string">&#x27;//*[@id=&quot;iframe&quot;]&#x27;</span>)<br><br>    col_name = iframe.locator(<span class="hljs-string">&#x27;//*[@id=&quot;table-0&quot;]/div/div[1]&#x27;</span>)<br>    col_text = [item.inner_text() <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> col_name.<span class="hljs-built_in">all</span>()]<br>    <span class="hljs-built_in">print</span>(col_text)                                             <span class="hljs-comment"># 列表形式单列输出</span><br><br>    tit_name = iframe.locator(<span class="hljs-string">&#x27;//*[@id=&quot;table-0&quot;]/div[1]&#x27;</span>)<br>    tit_list = [item.inner_text() <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> tit_name.<span class="hljs-built_in">all</span>()]<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;标题：&quot;</span>, [item.strip() <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> tit_list[<span class="hljs-number">0</span>].split(<span class="hljs-string">&#x27;\n&#x27;</span>)])<br><br>    num = iframe.locator(<span class="hljs-string">&#x27;//*[@id=&quot;table-0&quot;]/div&#x27;</span>).count()      <span class="hljs-comment"># 获取总行数</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;行数：&quot;</span>, num)<br><br>    <span class="hljs-keyword">for</span> n <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>, num+<span class="hljs-number">1</span>):<br>        element = <span class="hljs-string">r&#x27;//*[@id=&quot;table-0&quot;]/&#x27;</span> + <span class="hljs-string">&#x27;div[&#x27;</span> + <span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;n&#125;</span>&#x27;</span> + <span class="hljs-string">&#x27;]&#x27;</span><br>        row_name = iframe.locator(element)<br>        row_text = [item.inner_text() <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> row_name.<span class="hljs-built_in">all</span>()]<br>        row_list = [item.strip() <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> row_text[<span class="hljs-number">0</span>].split(<span class="hljs-string">&#x27;\n&#x27;</span>)]<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;&#x27;</span> <span class="hljs-keyword">in</span> row_list:                                      <span class="hljs-comment"># 处理第11行之后的数据</span><br>            row_list = [item.strip() <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> row_list <span class="hljs-keyword">if</span> item.strip()]<br>        <span class="hljs-built_in">print</span>(row_list)                                         <span class="hljs-comment"># 打印所有的数据行</span><br><br>    browser.close()                                             <span class="hljs-comment"># 关闭浏览器对象</span><br></code></pre></td></tr></table></figure>



<h1 id="2-图相似度对比"><a href="#2-图相似度对比" class="headerlink" title="2 图相似度对比"></a>2 图相似度对比</h1><ul>
<li>图相似度对比<ul>
<li>pip命令安装airtest和aircv：<code>pip install airtest</code>、<code>pip install aircv</code>。</li>
<li>Python安装目录中，找到Lib\site-packages\airtest\aircv\cal_confidence.py。</li>
<li>相似度对比时需用到cal_confidence.py中的函数<code>cal_ccoeff_confidence()</code>。</li>
<li>对比图时需要将图片的大小设为一致，可以使用<code>cv2.resize()</code>方法进行处理。</li>
<li><code>cv2.resize(src, dsize, dst=None, fx=None, fy=None, interpolation=None)</code><ul>
<li><code>src</code>源图像、<code>dsize</code>图像的大小、<code>fx</code>width方向的缩放比例。</li>
<li><code>fy</code>height方向的缩放比例、<code>interpolation</code>指定插值的方式。</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">import</span> cv2<br><span class="hljs-keyword">from</span> PIL <span class="hljs-keyword">import</span> Image<br><span class="hljs-keyword">from</span> playwright.sync_api <span class="hljs-keyword">import</span> sync_playwright<br><span class="hljs-keyword">import</span> airtest.aircv.cal_confidence <span class="hljs-keyword">as</span> cal_confidence           <span class="hljs-comment"># 引用函数</span><br><br><br><span class="hljs-keyword">with</span> sync_playwright() <span class="hljs-keyword">as</span> playwright:<br>    browser = playwright.chromium.launch(headless=<span class="hljs-literal">False</span>)<br>    page = browser.new_page()<br>    page.goto(<br>        <span class="hljs-string">&quot;https://img.zcool.cn/community/012e9a5ecfd&quot;</span><br>        <span class="hljs-string">&quot;26aa80120662183278c.jpg@1280w_1l_2o_100sh.jpg&quot;</span><br>    )<br>    screenshot_path = <span class="hljs-string">&#x27;pictures/image1.png&#x27;</span><br>    page.screenshot(path=screenshot_path)                       <span class="hljs-comment"># 截图保存到本地</span><br>    browser.close()                                             <span class="hljs-comment"># 关闭浏览器对象</span><br><br>image = Image.<span class="hljs-built_in">open</span>(screenshot_path)                             <span class="hljs-comment"># 将保存下来的图片裁剪成两半</span><br>half1 = image.crop((<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, image.width // <span class="hljs-number">2</span>, image.height))<br>half2 = image.crop((image.width // <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, image.width, image.height))<br>half1.save(<span class="hljs-string">&quot;pictures/image2.png&quot;</span>)                               <span class="hljs-comment"># 左图</span><br>half2.save(<span class="hljs-string">&quot;pictures/image3.png&quot;</span>)                               <span class="hljs-comment"># 右图</span><br><br>im1 = cv2.resize(cv2.imread(<span class="hljs-string">&quot;pictures/image2.png&quot;</span>), (<span class="hljs-number">100</span>, <span class="hljs-number">100</span>))<br>im2 = cv2.resize(cv2.imread(<span class="hljs-string">&quot;pictures/image3.png&quot;</span>), (<span class="hljs-number">100</span>, <span class="hljs-number">100</span>))<br>res = cal_confidence.cal_ccoeff_confidence(im1, im2)            <span class="hljs-comment"># 相似度对比</span><br><span class="hljs-built_in">print</span>(res)<br></code></pre></td></tr></table></figure>



<h1 id="3-插件编写用例"><a href="#3-插件编写用例" class="headerlink" title="3 插件编写用例"></a>3 插件编写用例</h1><ul>
<li>插件编写用例<ul>
<li>pytest-playwright插件完美地继承了pytest框架和playwright基础使用的封装，满足基本工作需求。</li>
<li>pip install pytest-playwright -i <a target="_blank" rel="noopener" href="http://pypi.douban.com/simple/">http://pypi.douban.com/simple/</a> –trusted-host pypi.douban.com</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">import</span> re                                                       <span class="hljs-comment"># test_plugin.py</span><br><span class="hljs-keyword">from</span> playwright.sync_api <span class="hljs-keyword">import</span> Page, expect<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_homepage</span>(<span class="hljs-params">page: Page</span>):                                  <span class="hljs-comment"># 网页测试</span><br>    page.goto(<span class="hljs-string">&quot;https://playwright.dev/&quot;</span>)                        <span class="hljs-comment"># 访问指定的URL</span><br>    expect(page).to_have_title(re.<span class="hljs-built_in">compile</span>(<span class="hljs-string">&quot;Playwright&quot;</span>))        <span class="hljs-comment"># 判断页面标题是否包含&quot;Playwright&quot;</span><br>    get_started = page.get_by_role(<span class="hljs-string">&quot;link&quot;</span>, name=<span class="hljs-string">&quot;Get started&quot;</span>)  <span class="hljs-comment"># 获取元素role为link，name为Get started</span><br>    expect(get_started).to_have_attribute(<span class="hljs-string">&quot;href&quot;</span>, <span class="hljs-string">&quot;/docs/intro&quot;</span>)<br>    get_started.click()                                         <span class="hljs-comment"># 点击获取到的元素</span><br>    expect(page).to_have_url(re.<span class="hljs-built_in">compile</span>(<span class="hljs-string">&quot;.*intro&quot;</span>))             <span class="hljs-comment"># 正则判断页面的URL是否包含&quot;intro&quot;</span><br><br><span class="hljs-comment"># pytest test_plugin.py                                         # 无头模式运行，测试结果和日志在终端显示</span><br><span class="hljs-comment"># pytest test_plugin.py --headed                                # 浏览器UI运行</span><br></code></pre></td></tr></table></figure>



<h2 id="3-1-CLI参数"><a href="#3-1-CLI参数" class="headerlink" title="3-1 CLI参数"></a>3-1 CLI参数</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs Powershell">pytest                                                          <span class="hljs-comment"># 默认在chromium上运行测试</span><br>pytest ./test_xxx/                                              <span class="hljs-comment"># 运行一组测试文件</span><br>pytest test_plugin.py                                           <span class="hljs-comment"># 运行单个测试文件</span><br>pytest test_plugin.py <span class="hljs-literal">-k</span> <span class="hljs-string">&quot;test_homepage&quot;</span>                        <span class="hljs-comment"># 使用函数名运行测试</span><br>pytest test_plugin.py <span class="hljs-literal">--headed</span>                                  <span class="hljs-comment"># 有头模式运行测试(默认无头)</span><br>pytest test_plugin.py <span class="hljs-literal">--browser</span> webkit                          <span class="hljs-comment"># 特定浏览器运行测试</span><br>pytest test_plugin.py <span class="hljs-literal">--browser</span> webkit <span class="hljs-literal">--browser</span> firefox        <span class="hljs-comment"># 多个浏览器运行测试</span><br>pytest test_plugin.py <span class="hljs-literal">--browser-channel</span> chrome                  <span class="hljs-comment"># 指定浏览器通道运行测试</span><br>pytest test_plugin.py <span class="hljs-literal">--slowmo</span> <span class="hljs-number">100</span>                              <span class="hljs-comment"># 指定延迟不超过100ms来减缓测试执行速度</span><br>pytest test_plugin.py <span class="hljs-literal">--device</span>=<span class="hljs-string">&quot;iPhone 12&quot;</span>                      <span class="hljs-comment"># 模拟iPhone 12设备运行测试</span><br>pytest test_plugin.py <span class="hljs-literal">--output</span>=<span class="hljs-string">&quot;my_results&quot;</span> <span class="hljs-literal">--video</span>=on          <span class="hljs-comment"># 测试生成的工作目录(默认test-results)</span><br>pytest test_plugin.py <span class="hljs-literal">--tracing</span>=on                              <span class="hljs-comment"># 为每个测试记录轨迹</span><br>pytest test_plugin.py <span class="hljs-literal">--video</span>=on                                <span class="hljs-comment"># 为每次测试录制视频</span><br>pytest test_plugin.py <span class="hljs-literal">--screenshot</span>=on                           <span class="hljs-comment"># 截图(on、默认off、retain-on-failure)</span><br><br>pip install py<span class="hljs-built_in">test-xdist</span><br>pytest <span class="hljs-literal">--numprocesses</span> auto                                      <span class="hljs-comment"># 多进程运行测试</span><br></code></pre></td></tr></table></figure>



<h2 id="3-2-用例编写"><a href="#3-2-用例编写" class="headerlink" title="3-2 用例编写"></a>3-2 用例编写</h2><ul>
<li>用例编写<ul>
<li>浏览器上下文使得页面在测试之间被隔离，相当于一个全新的浏览器配置文件，每个测试都会获得一个新环境。</li>
<li>可以使用各种fixture在测试之前或者之后执行代码，并在它们之间共享对象，例如：beforeEach、afterEach等。</li>
<li><a href="https://stitch-top.github.io/2023/03/03/ce-shi-kuang-jia/tf02-pytest-ce-shi-kuang-jia/#5-fixture%E9%A2%84%E7%BD%AE%E6%9D%A1%E4%BB%B6">内置fixture</a><ul>
<li>Function scope：这些固定装置在测试功能中请求时创建，并在测试结束时销毁。<ul>
<li>page：用于测试的新浏览器页面。</li>
<li>context：用于测试的新浏览器上下文。</li>
</ul>
</li>
<li>Session scope：这些固定装置在测试函数中请求时创建，并在所有测试结束时销毁。<ul>
<li>browser_name：浏览器名称作为字符串。</li>
<li>browser：由Playwright启动的浏览器实例。</li>
<li>browser_channel：浏览器通道作为字符串。</li>
<li>browser_type：当前浏览器的BrowserType实例。</li>
<li>is_chromium，is_webkit，is_firefox：相应浏览器类型的布尔值。</li>
</ul>
</li>
<li>自定义fixture选项：对于browser和context ，使用以下fixture来自定义启动选项。<ul>
<li>browser_context_args：覆盖browser.new_context()的选项，返回一个字典。</li>
<li>browser_type_launch_args：覆盖browser_type.launch()的启动参数，返回一个字典。</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> playwright.sync_api <span class="hljs-keyword">import</span> Page                             <span class="hljs-comment"># test_example.py</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_baidu</span>(<span class="hljs-params">page: Page</span>):                                      <span class="hljs-comment"># 充当测试用例</span><br>    page.goto(<span class="hljs-string">&quot;https://www.baidu.com/&quot;</span>)                          <span class="hljs-comment"># 结合conftest.py使用</span><br>    page.wait_for_timeout(<span class="hljs-number">3000</span>)<br><br>    page.close()<br></code></pre></td></tr></table></figure>



<h4 id="1-跳过浏览器"><a href="#1-跳过浏览器" class="headerlink" title="(1) 跳过浏览器"></a>(1) 跳过浏览器</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">import</span> pytest                                                    <span class="hljs-comment"># test_skip.py</span><br><br><br><span class="hljs-meta">@pytest.mark.skip_browser(<span class="hljs-params"><span class="hljs-string">&quot;firefox&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_example</span>(<span class="hljs-params">page</span>):<br>    page.goto(<span class="hljs-string">&quot;https://playwright.dev/&quot;</span>)<br><br><span class="hljs-comment"># pytest test_skip.py --browser firefox                          # 执行用例查看效果</span><br></code></pre></td></tr></table></figure>



<h4 id="2-指定浏览器"><a href="#2-指定浏览器" class="headerlink" title="(2) 指定浏览器"></a>(2) 指定浏览器</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">import</span> pytest                                                   <span class="hljs-comment"># test_browser.py</span><br><br><br><span class="hljs-meta">@pytest.mark.only_browser(<span class="hljs-params"><span class="hljs-string">&quot;firefox&quot;</span></span>)                            </span><span class="hljs-comment"># 【方法一】指定浏览器</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_example</span>(<span class="hljs-params">page</span>):<br>    page.goto(<span class="hljs-string">&quot;https://playwright.dev/&quot;</span>)<br><br><span class="hljs-comment"># pytest test_browser.py --headed                               # 默认chromium执行</span><br><span class="hljs-comment"># pytest test_browser.py --browser firefox                      # 【方法二】</span><br><span class="hljs-comment"># pytest test_browser.py --browser-channel chromium             # 命令行参数指定浏览器</span><br></code></pre></td></tr></table></figure>



<h4 id="3-配置base-url"><a href="#3-配置base-url" class="headerlink" title="(3) 配置base-url"></a>(3) 配置base-url</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_example</span>(<span class="hljs-params">page</span>):                                         <span class="hljs-comment"># test_base_url.py</span><br>    page.goto(<span class="hljs-string">&quot;/Login.aspx&quot;</span>)                                    <span class="hljs-comment"># 用到了pytest-base-url插件</span><br><br><span class="hljs-comment"># pytest test_base_url.py --base-url https://mall.cnki.net      # 【方法一】命令行参数访问</span><br><span class="hljs-comment"># 另外：PlayWright框架(一)的上下文代码中，base_url参数是在new_context()新建上下文时使用的</span><br>    <span class="hljs-comment"># 即browser.new_context(base_url=&quot;https://www.baidu.com&quot;)   # 【方法二】新建上下文使用</span><br>    <span class="hljs-comment"># 后续page.goto(&quot;/&quot;)使用时，只需要填入相对地址&quot;/&quot;就可以访问了</span><br><br><span class="hljs-comment">###########################################################################################</span><br>[pytest]                                                        <span class="hljs-comment"># pytest.ini</span><br><br>base_url=https://mall.cnki.net<br><br><span class="hljs-comment"># pytest test_base_url.py --headed                              # 【方法三】pytest.ini中配置</span><br></code></pre></td></tr></table></figure>



<h4 id="4-设置手机设备"><a href="#4-设置手机设备" class="headerlink" title="(4) 设置手机设备"></a>(4) 设置手机设备</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">import</span> pytest                                                   <span class="hljs-comment"># conftest.py</span><br><br><br><span class="hljs-meta">@pytest.fixture(<span class="hljs-params">scope=<span class="hljs-string">&quot;session&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">browser_context_args</span>(<span class="hljs-params">browser_context_args, playwright</span>):<br>    iphone_11 = playwright.devices[<span class="hljs-string">&#x27;iPhone 11 Pro&#x27;</span>]             <span class="hljs-comment"># 指定手机型号运行用例</span><br>    <span class="hljs-keyword">return</span> &#123;<br>        **browser_context_args,<br>        **iphone_11,<br>    &#125;<br><br><span class="hljs-comment"># pytest test_example.py --headed                               # 执行用例查看效果</span><br></code></pre></td></tr></table></figure>



<h4 id="5-忽略https错误"><a href="#5-忽略https错误" class="headerlink" title="(5) 忽略https错误"></a>(5) 忽略https错误</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">import</span> pytest                                                   <span class="hljs-comment"># conftest.py</span><br><br><br><span class="hljs-meta">@pytest.fixture(<span class="hljs-params">scope=<span class="hljs-string">&quot;session&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">browser_context_args</span>(<span class="hljs-params">browser_context_args</span>):<br>    <span class="hljs-keyword">return</span> &#123;<br>        **browser_context_args,<br>        <span class="hljs-string">&quot;ignore_https_errors&quot;</span>: <span class="hljs-literal">True</span><br>    &#125;<br><br><span class="hljs-comment"># pytest test_example.py --headed                               # 执行用例查看效果</span><br></code></pre></td></tr></table></figure>



<h4 id="6-持久的context"><a href="#6-持久的context" class="headerlink" title="(6) 持久的context"></a>(6) 持久的context</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">import</span> pytest                                                   <span class="hljs-comment"># conftest.py</span><br><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">Dict</span><br><span class="hljs-keyword">from</span> playwright.sync_api <span class="hljs-keyword">import</span> BrowserType<br><br><br><span class="hljs-meta">@pytest.fixture(<span class="hljs-params">scope=<span class="hljs-string">&quot;session&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">context</span>(<span class="hljs-params">                                                    <span class="hljs-comment"># 测试中的所有页面</span></span><br><span class="hljs-params">        browser_type: BrowserType,                              <span class="hljs-comment"># 都是从持久上下文创建的</span></span><br><span class="hljs-params">        browser_type_launch_args: <span class="hljs-type">Dict</span>,</span><br><span class="hljs-params">        browser_context_args: <span class="hljs-type">Dict</span></span>):<br>    context = browser_type.launch_persistent_context(<span class="hljs-string">&quot;./foobar&quot;</span>, **&#123;<br>        **browser_type_launch_args,<br>        **browser_context_args,<br>        <span class="hljs-string">&quot;locale&quot;</span>: <span class="hljs-string">&quot;de-DE&quot;</span>,<br>    &#125;)<br>    <span class="hljs-keyword">yield</span> context<br>    context.close()<br><br><span class="hljs-comment"># pytest test_example.py --headed                               # 执行用例查看效果</span><br></code></pre></td></tr></table></figure>



<h4 id="7-浏览器窗口大小"><a href="#7-浏览器窗口大小" class="headerlink" title="(7) 浏览器窗口大小"></a>(7) 浏览器窗口大小</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">import</span> pytest                                                   <span class="hljs-comment"># conftest.py</span><br><br><br><span class="hljs-meta">@pytest.fixture(<span class="hljs-params">scope=<span class="hljs-string">&quot;session&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">browser_context_args</span>(<span class="hljs-params">browser_context_args</span>):<br>    <span class="hljs-keyword">return</span> &#123;<br>        **browser_context_args,<br>        <span class="hljs-string">&quot;viewport&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;width&quot;</span>: <span class="hljs-number">1920</span>,<br>            <span class="hljs-string">&quot;height&quot;</span>: <span class="hljs-number">1080</span>,<br>        &#125;<br>    &#125;<br><br><span class="hljs-comment"># pytest test_example.py --headed                               # 执行用例查看效果</span><br></code></pre></td></tr></table></figure>



<h2 id="3-3-多进程执行"><a href="#3-3-多进程执行" class="headerlink" title="3-3 多进程执行"></a>3-3 多进程执行</h2><ul>
<li>多进程执行<ul>
<li>原则<ul>
<li>用例之间相互独立，没有依赖，每个用例都可独立运行。</li>
<li>用例执行之间没有顺序要求，随机顺序都可以正常执行。</li>
<li>每个用例都能重复执行，运行结果不会影响到其他用例。</li>
</ul>
</li>
<li>使用PIP包管理工具安装pytest-xdist插件：<code>pip install pytest-xdist</code>。</li>
<li>线程(Thread)是进程(Process)内的实际执行单位，一进程可包含多个线程。</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs Python">url = <span class="hljs-string">&quot;https://www.baidu.com/&quot;</span>                                  <span class="hljs-comment"># test_process.py</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_case1</span>():<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;case1------&quot;</span>)<br>    <span class="hljs-keyword">assert</span> url == <span class="hljs-string">&quot;https://www.baidu.com/&quot;</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_case2</span>():<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;case2------&quot;</span>)<br>    <span class="hljs-keyword">assert</span> url == <span class="hljs-string">&quot;https://www.baidu.com/&quot;</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_case3</span>():<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;case3------&quot;</span>)<br>    <span class="hljs-keyword">assert</span> url == <span class="hljs-string">&quot;https://www.baidu.com/&quot;</span><br><br><span class="hljs-comment"># pytest test_process.py -n 2                                   # 并行执行用例</span><br><span class="hljs-comment"># pytest test_process.py -n auto                                # 自动获取CPU核数，执行速度慢</span><br></code></pre></td></tr></table></figure>



<h2 id="3-4-命令行选项"><a href="#3-4-命令行选项" class="headerlink" title="3-4 命令行选项"></a>3-4 命令行选项</h2><ul>
<li>命令行选项<ul>
<li>测试分布算法配置：指在分布式测试执行期间使用的算法和相关设置。<ul>
<li>通过测试分布，可以将测试用例并行在多个浏览器、设备或环境中执行，以加快测试执行速度。</li>
<li>常见的测试分布算法配置选项<ul>
<li>轮询：将待执行的测试用例依次轮流分发给可用的执行器，以均匀地分配测试负载。</li>
<li>随机：随机选择可用的执行器来运行测试用例，从而可能在某些情况下提高测试效率。</li>
<li>基于负载：根据执行器的负载情况动态分发测试用例，以确保执行器的负载大致相等。</li>
</ul>
</li>
</ul>
</li>
<li>在Playwright中，dist命令行选项用于配置测试分布算法。<ul>
<li><code>--repeat-each 3</code>：每个测试用例将被执行3次。</li>
<li><code>--workers 3</code>：使用3个工作进程来执行测试用例。</li>
<li><code>--shard 1/3</code>：使用3个分片中的第1个分片来执行测试用例。</li>
<li><code>--max-failures 3</code>：如果测试用例失败的次数达到3次，则测试执行将停止。</li>
<li><code>--dist loadfile</code>：使用基于负载的分布算法，并根据测试文件来分发测试用例。</li>
<li><code>--dist loadgroup</code>：使用基于负载的分布算法，并根据测试分组来分发测试用例。<ul>
<li>使用<code>@pytest.mark.xdist_group(name=&quot; &quot;)</code>装饰器为测试用例指定不同的分组名称。</li>
<li>当执行测试时，pytest-xdist插件可以并行地执行同一分组的测试用例，提高执行效率。</li>
</ul>
</li>
<li><code>--dist loadscope</code>：使用基于负载的分布算法，并按作用域来动态分配测试用例。</li>
<li><code>--dist load</code>(默认方式)：使用基于负载的分布算法，根据执行器的负载情况来动态地分配测试用例。</li>
<li><code>--dist no</code>：禁用测试分布，即不进行分布式测试执行，而是在单个执行器上依次执行所有测试用例。</li>
<li><code>--dist worksteal</code>：使用worksteal算法分发用例，算法允许空闲的执行器从繁忙的执行器那里窃取用例以平衡负载。</li>
<li><code>--max-sched-chunk=3</code>：限制并发执行的最大数量为3，从而在多线程进行测试时可以限制同时执行的测试用例数量。</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">import</span> pytest                                                   <span class="hljs-comment"># test_xdist_group.py</span><br><br>url = <span class="hljs-string">&quot;https://www.baidu.com/&quot;</span><br><br><br><span class="hljs-meta">@pytest.mark.xdist_group(<span class="hljs-params">name=<span class="hljs-string">&quot;group1&quot;</span></span>)                         </span><span class="hljs-comment"># 装饰器指定分组名称group1</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_case1</span>():                                               <span class="hljs-comment"># 并行执行group1分组的用例</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;case1------&quot;</span>)<br>    <span class="hljs-keyword">assert</span> url == <span class="hljs-string">&quot;https://www.baidu.com/&quot;</span><br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">TestA</span>:<br><span class="hljs-meta">    @pytest.mark.xdist_group(<span class="hljs-params"><span class="hljs-string">&quot;group1&quot;</span></span>)</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_case2</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;case2------&quot;</span>)<br>        <span class="hljs-keyword">assert</span> url == <span class="hljs-string">&quot;https://www.baidu.com/&quot;</span><br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">TestB</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_case3</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;case3------&quot;</span>)<br>        <span class="hljs-keyword">assert</span> url == <span class="hljs-string">&quot;https://www.baidu.com/&quot;</span><br><br><span class="hljs-comment"># pytest -n auto test_xdist_group.py</span><br></code></pre></td></tr></table></figure>



<h2 id="3-5-插件结合使用"><a href="#3-5-插件结合使用" class="headerlink" title="3-5 插件结合使用"></a>3-5 插件结合使用</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_case1</span>(<span class="hljs-params">base_url</span>):                                       <span class="hljs-comment"># test_xdist_url.py</span><br>    <span class="hljs-built_in">print</span>(base_url)                                             <span class="hljs-comment"># pytest-xdist与pytest-base-url结合使用</span><br>    <span class="hljs-keyword">assert</span> base_url == <span class="hljs-string">&quot;https://www.baidu.com/&quot;</span>                 <span class="hljs-comment"># 会遇到xdist不适配的情况，可以参看解决方案</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_case2</span>(<span class="hljs-params">base_url</span>):<br>    <span class="hljs-built_in">print</span>(base_url)<br>    <span class="hljs-keyword">assert</span> base_url == <span class="hljs-string">&quot;https://www.baidu.com/&quot;</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_case3</span>(<span class="hljs-params">base_url</span>):<br>    <span class="hljs-built_in">print</span>(base_url)<br>    <span class="hljs-keyword">assert</span> base_url == <span class="hljs-string">&quot;https://www.baidu.com/&quot;</span><br></code></pre></td></tr></table></figure>



<h4 id="1-pytest-ini"><a href="#1-pytest-ini" class="headerlink" title="(1) pytest.ini"></a>(1) pytest.ini</h4><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs Ini"><span class="hljs-section">[pytest]</span>                                                         <span class="hljs-comment"># pytest.ini</span><br><br><span class="hljs-attr">base_url</span>=https://www.baidu.com/<br><br><span class="hljs-comment"># pytest test_xdist_url.py                                       # 执行正常</span><br><span class="hljs-comment"># pytest test_xdist_url.py -n 2                                  # 执行会报错，会获取不到base_url</span><br><span class="hljs-comment"># don&#x27;t run configure on xdist worker nodes                      # 源码文件注释，说明不适配xdist</span><br></code></pre></td></tr></table></figure>



<h4 id="2-解决方案一"><a href="#2-解决方案一" class="headerlink" title="(2) 解决方案一"></a>(2) 解决方案一</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-meta">@pytest.fixture(<span class="hljs-params">scope=<span class="hljs-string">&quot;session&quot;</span></span>)                                </span><span class="hljs-comment"># PyCharm中，Ctrl+右键点击base_url</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">base_url</span>(<span class="hljs-params">request</span>):                                          <span class="hljs-comment"># 加载plugin.py文件，找到左侧代码段</span><br>    <span class="hljs-string">&quot;&quot;&quot;Return a base URL&quot;&quot;&quot;</span><br>    config = request.config<br>    <span class="hljs-comment"># base_url = config.getoption(&quot;base_url&quot;)                   # 修改该行代码为下一行代码内容，保存</span><br>    base_url = config.getoption(<span class="hljs-string">&quot;base_url&quot;</span>) <span class="hljs-keyword">or</span> config.getini(<span class="hljs-string">&quot;base_url&quot;</span>)<br>    <span class="hljs-keyword">if</span> base_url <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<br>        <span class="hljs-keyword">return</span> base_url<br><br><span class="hljs-comment"># 再次执行命令pytest test_xdist_url.py -n 2，就不会再报错了，随后执行pytest命令时都出现以下问题</span><br><span class="hljs-comment"># UnicodeDecodeError: &#x27;gbk&#x27; codec can&#x27;t decode byte 0xa1 in position 185: illegal multibyte sequence</span><br><span class="hljs-comment"># 将pytest.ini文件的编码格式由UTF-8改为GBK即可解决(不清楚是不是由于修改源文件内容引起的，不推荐使用该解决方案)</span><br></code></pre></td></tr></table></figure>



<h4 id="3-解决方案二"><a href="#3-解决方案二" class="headerlink" title="(3) 解决方案二"></a>(3) 解决方案二</h4><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs Ini"><span class="hljs-section">[pytest]</span>                                                         <span class="hljs-comment"># pytest.ini</span><br><br><span class="hljs-attr">addopts</span> = --base-url=https://www.baidu.com/                      <span class="hljs-comment"># 不配置ini参数，配置命令行参数</span><br></code></pre></td></tr></table></figure>



<h1 id="4-页面对象模型"><a href="#4-页面对象模型" class="headerlink" title="4 页面对象模型"></a>4 页面对象模型</h1><ul>
<li>页面对象模型<ul>
<li>POM是一种软件测试设计模式，用于在自动化测试中组织和管理网页的元素和操作。</li>
<li>该模式将每个网页视为一个独立的对象，并且使用对象来表示该页面的元素和行为。</li>
<li>基本原则是将页面结构和行为与测试代码分离开来，若结构发生变化，只需更新页面对象的代码。</li>
<li>以测试注册页面为例<ul>
<li>根据输入框的内容，可以编写多个有效等价和无效等价的测试用例。</li>
<li>用例操作是在页面元素上点点点，将元素定位和操作封装成一个类。</li>
</ul>
</li>
<li>搭建JForum论坛<ul>
<li><a target="_blank" rel="noopener" href="https://nchc.dl.sourceforge.net/project/xampp/XAMPP%20Windows/5.6.40/xampp-windows-x64-5.6.40-1-VC11-installer.exe">xampp-windows-x64-5.6.40-1-VC11-installer.exe</a>：下载，傻瓜式安装。<ul>
<li>MySQL将my.ini文件中的端口3306修改为3311，Apache将httpd.conf文件中的端口80修改为81。</li>
<li>&#x2F;Xampp&#x2F;phpMyAdmin&#x2F;config.inc.php文件添加内容<code>$cfg[&#39;Servers&#39;][$i][&#39;port&#39;] = &#39;3311&#39;;</code>。</li>
<li>启动Apache、Tomcat、MySQL，下载“<a target="_blank" rel="noopener" href="https://master.dl.sourceforge.net/project/jforum2/jforum-2.7.0.war?viasf=1">jforum-2.7.0.war</a>”剪贴到Xampp&#x2F;tomcat&#x2F;webapps目录。</li>
</ul>
</li>
<li>若浏览器正常访问“<a target="_blank" rel="noopener" href="http://localhost:81/phpmyadmin/">http://localhost:81/phpmyadmin/</a>”，说明文件配置正确。<ul>
<li>phpMyAdmin中新建一个名为<code>jforum</code>，编码为<code>utf8_general_ci</code>的数据库。</li>
<li>phpMyAdmin界面，点击账户，将用户名为root的权限密码全部改为123456。</li>
<li>&#x2F;Xampp&#x2F;phpMyAdmin&#x2F;config.inc.php文件，改<code>[&#39;password&#39;] = &#39;123456&#39;;</code>。</li>
</ul>
</li>
<li>浏览器访问“<a target="_blank" rel="noopener" href="http://127.0.0.1:8080/jforum-2.7.0/install.jsp">http://127.0.0.1:8080/jforum-2.7.0/install.jsp</a>”，部署本地论坛。</li>
<li>数据库端口3311，数据库用户账号为root，密码123456，系统管理员密码123456。</li>
<li>部署完成后访问论坛首页：<a target="_blank" rel="noopener" href="http://127.0.0.1:8080/jforum-2.7.0/forums/list.page">http://127.0.0.1:8080/jforum-2.7.0/forums/list.page</a>。</li>
<li>注意：访问论坛时只需启动Tomcat和MySQL，访问数据库则要开启Apache和MySQL。</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs Txt">- cases                                                          # 用于放置测试用例<br>    - test_register.py<br>    - __init__.py<br>- models                                                         # 用于放置封装好的类文件<br>    - register_page.py                                           # conftest.py的配置优先于pytest.ini<br>    - __init.py                                                  # 但仍然受到pytest.ini命令行选项的影响<br>- conftest.py                                                    # 用于定义共享的fixtures和钩子函数hooks<br>- pytest.ini                                                     # 配置文件，用于设置全局的测试选项和插件<br></code></pre></td></tr></table></figure>



<h2 id="4-1-封装成类"><a href="#4-1-封装成类" class="headerlink" title="4-1 封装成类"></a>4-1 封装成类</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> playwright.sync_api <span class="hljs-keyword">import</span> Page                            <span class="hljs-comment"># register_page.py</span><br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">RegisterPage</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, page: Page</span>):<br>        self.page = page<br>        self.pop_message = <span class="hljs-literal">None</span><br>        self.locator_username = page.locator(<br>            <span class="hljs-string">&#x27;//*[@id=&quot;formregister&quot;]/table[2]/tbody/tr[3]/td[2]/input&#x27;</span><br>        )                                                       <span class="hljs-comment"># 定位会员名称</span><br>        self.locator_email = page.locator(<br>            <span class="hljs-string">&#x27;//*[@id=&quot;formregister&quot;]/table[2]/tbody/tr[4]/td[2]/input&#x27;</span><br>        )                                                       <span class="hljs-comment"># 定位电子邮箱</span><br>        self.locator_password = page.locator(<br>            <span class="hljs-string">&#x27;//*[@id=&quot;password&quot;]&#x27;</span><br>        )                                                       <span class="hljs-comment"># 定位密码</span><br>        self.locator_password_confirm = page.locator(<br>            <span class="hljs-string">&#x27;//*[@id=&quot;formregister&quot;]/table[2]/tbody/tr[6]/td[2]/input&#x27;</span><br>        )                                                       <span class="hljs-comment"># 定位确认密码</span><br>        <span class="hljs-comment"># self.locator_register_btn = page.locator(</span><br>        <span class="hljs-comment">#     &#x27;//*[@id=&quot;formregister&quot;]/table[2]/tbody/tr[7]/td/input[1]&#x27;</span><br>        <span class="hljs-comment"># )                                                     # 定位确定按钮</span><br>        self.locator_register_btn = page.get_by_role(<span class="hljs-string">&quot;button&quot;</span>, name=<span class="hljs-string">&quot;确定&quot;</span>)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">navigate</span>(<span class="hljs-params">self</span>):                                         <span class="hljs-comment"># 导航到会员注册页面</span><br>        self.page.goto(<span class="hljs-string">&quot;http://127.0.0.1:8080/jforum-2.7.0/user/insert.page&quot;</span>)<br>        <span class="hljs-comment"># self.page.click(</span><br>        <span class="hljs-comment">#     &#x27;/html/body/table/tbody/tr[2]/td/table/tbody/tr[3]/td/input[1]&#x27;</span><br>        <span class="hljs-comment"># )                                                     # 同意协议，没定位到</span><br>        self.page.get_by_role(<span class="hljs-string">&quot;button&quot;</span>, name=<span class="hljs-string">&quot;我同意以上条款&quot;</span>).click()<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">handle_dialog</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">on_dialog</span>(<span class="hljs-params">dialog</span>):<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;弹窗提示内容：&quot;</span>, dialog.message)<br>            self.pop_message = dialog.message<br>            dialog.dismiss()<br>        self.page.on(<span class="hljs-string">&#x27;dialog&#x27;</span>, on_dialog)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">fill_username</span>(<span class="hljs-params">self, username</span>):                          <span class="hljs-comment"># 输入会员名称</span><br>        self.locator_username.fill(username)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">fill_email</span>(<span class="hljs-params">self, email</span>):                                <span class="hljs-comment"># 输入电子邮箱</span><br>        self.locator_email.fill(email)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">fill_password</span>(<span class="hljs-params">self, password</span>):                          <span class="hljs-comment"># 输入密码</span><br>        self.locator_password.fill(password)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">fill_password_confirm</span>(<span class="hljs-params">self, password_confirm</span>):          <span class="hljs-comment"># 输入确认密码</span><br>        self.locator_password_confirm.fill(password_confirm)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">click_register_button</span>(<span class="hljs-params">self</span>):                            <span class="hljs-comment"># 点击确定按钮</span><br>        self.locator_register_btn.wait_for(state=<span class="hljs-string">&quot;visible&quot;</span>)<br>        self.locator_register_btn.click()<br></code></pre></td></tr></table></figure>



<h2 id="4-2-conftest-py"><a href="#4-2-conftest-py" class="headerlink" title="4-2 conftest.py"></a>4-2 conftest.py</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">import</span> pytest                                                   <span class="hljs-comment"># conftest.py</span><br><span class="hljs-keyword">from</span> playwright.sync_api <span class="hljs-keyword">import</span> sync_playwright<br><br><br><span class="hljs-meta">@pytest.fixture(<span class="hljs-params">scope=<span class="hljs-string">&quot;session&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">context_chrome</span>():<br>    p = sync_playwright().start()                               <span class="hljs-comment"># 前置操作代码</span><br>    browser = p.chromium.launch(headless=<span class="hljs-literal">False</span>, slow_mo=<span class="hljs-number">1000</span>)<br>    context = browser.new_context()<br>    <span class="hljs-keyword">yield</span> context<br><br>    context.close()                                             <span class="hljs-comment"># 实现用例后置</span><br>    browser.close()                                             <span class="hljs-comment"># 后置操作代码</span><br>    p.stop()<br></code></pre></td></tr></table></figure>



<h2 id="4-3-测试用例部分"><a href="#4-3-测试用例部分" class="headerlink" title="4-3 测试用例部分"></a>4-3 测试用例部分</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">import</span> pytest                                                   <span class="hljs-comment"># test_register.py</span><br><span class="hljs-keyword">from</span> playwright.sync_api <span class="hljs-keyword">import</span> expect<br><span class="hljs-keyword">from</span> models.register_page <span class="hljs-keyword">import</span> RegisterPage<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">TestRegister</span>:<br><span class="hljs-meta">    @pytest.fixture(<span class="hljs-params">autouse=<span class="hljs-literal">True</span></span>)                               </span><span class="hljs-comment"># True为作用域内的用例自动调用</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">start_for_each</span>(<span class="hljs-params">self, context_chrome</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;访问注册页&quot;</span>)<br>        self.page = context_chrome.new_page()<br>        self.register = RegisterPage(self.page)<br>        self.register.navigate()<br>        <span class="hljs-keyword">yield</span>                                                   <span class="hljs-comment"># 将一个函数变成一个生成器</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;关闭注册页&quot;</span>)<br>        self.page.close()                                       <span class="hljs-comment"># 这个生成器用于测试注册页面</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_register_a</span>(<span class="hljs-params">self</span>):                                  <span class="hljs-comment"># 会员名称为空</span><br>        self.register.fill_username(<span class="hljs-string">&#x27;&#x27;</span>)                         <span class="hljs-comment"># 字段长度超过直接截断</span><br>        self.register.fill_email(<span class="hljs-string">&#x27;Alice@qq.com&#x27;</span>)                <span class="hljs-comment"># 这里不做验证</span><br>        self.register.fill_password(<span class="hljs-string">&#x27;123456&#x27;</span>)<br>        self.register.fill_password_confirm(<span class="hljs-string">&#x27;123456&#x27;</span>)<br>        self.register.handle_dialog()<br>        self.register.click_register_button()<br>        <span class="hljs-keyword">assert</span> self.register.pop_message == <span class="hljs-string">&quot;请填写会员名称输入框&quot;</span><br>        <span class="hljs-comment"># expect(                                               # expect断言获取不到内容</span><br>        <span class="hljs-comment">#     self.register.pop_message</span><br>        <span class="hljs-comment"># ).to_contain_text(&quot;请填写会员名称输入框&quot;)</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_register_b</span>(<span class="hljs-params">self</span>):                                  <span class="hljs-comment"># 电子邮箱为空</span><br>        self.register.fill_username(<span class="hljs-string">&#x27;Bob&#x27;</span>)<br>        self.register.fill_email(<span class="hljs-string">&#x27;&#x27;</span>)<br>        self.register.fill_password(<span class="hljs-string">&#x27;123456&#x27;</span>)<br>        self.register.fill_password_confirm(<span class="hljs-string">&#x27;123456&#x27;</span>)<br>        self.register.handle_dialog()<br>        self.register.click_register_button()<br>        <span class="hljs-keyword">assert</span> self.register.pop_message == <span class="hljs-string">&quot;请正确的填写电子邮件输入框&quot;</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_register_c</span>(<span class="hljs-params">self</span>):                                  <span class="hljs-comment"># 密码为空</span><br>        self.register.fill_username(<span class="hljs-string">&#x27;Celine&#x27;</span>)<br>        self.register.fill_email(<span class="hljs-string">&#x27;Celine@qq.com&#x27;</span>)<br>        self.register.fill_password(<span class="hljs-string">&#x27;&#x27;</span>)<br>        self.register.fill_password_confirm(<span class="hljs-string">&#x27;123456&#x27;</span>)<br>        self.register.handle_dialog()<br>        self.register.click_register_button()<br>        <span class="hljs-keyword">assert</span> self.register.pop_message == <span class="hljs-string">&quot;请填写密码输入框&quot;</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_register_d</span>(<span class="hljs-params">self</span>):                                  <span class="hljs-comment"># 密码与确认密码不一致</span><br>        self.register.fill_username(<span class="hljs-string">&#x27;Drayton&#x27;</span>)<br>        self.register.fill_email(<span class="hljs-string">&#x27;Drayton@qq.com&#x27;</span>)<br>        self.register.fill_password(<span class="hljs-string">&#x27;123456&#x27;</span>)<br>        self.register.fill_password_confirm(<span class="hljs-string">&#x27;123&#x27;</span>)<br>        self.register.handle_dialog()<br>        self.register.click_register_button()<br>        <span class="hljs-keyword">assert</span> self.register.pop_message == <span class="hljs-string">&quot;两次输入的密码不合&quot;</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_register_e</span>(<span class="hljs-params">self</span>):                                  <span class="hljs-comment"># 成功注册</span><br>        self.register.fill_username(<span class="hljs-string">&#x27;Elliott&#x27;</span>)<br>        self.register.fill_email(<span class="hljs-string">&#x27;Elliott@qq.com&#x27;</span>)<br>        self.register.fill_password(<span class="hljs-string">&#x27;123456&#x27;</span>)<br>        self.register.fill_password_confirm(<span class="hljs-string">&#x27;123456&#x27;</span>)<br>        self.register.handle_dialog()<br>        self.register.click_register_button()<br>        expect(self.register.page).to_have_title(<span class="hljs-string">&#x27;My Forum - your board description&#x27;</span>)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    pytest.main()<br></code></pre></td></tr></table></figure>



<h1 id="5-登录相关操作"><a href="#5-登录相关操作" class="headerlink" title="5 登录相关操作"></a>5 登录相关操作</h1><ul>
<li>登录相关操作<ul>
<li>身份验证方式、绕过登录验证码：以“页面对象模型”中搭建的“JForum论坛”为例进行说明。</li>
<li>登录页滑动解锁：<a target="_blank" rel="noopener" href="https://www.bootstrapmb.com/item/10579">https://www.bootstrapmb.com/item/10579</a>。</li>
<li>滑块拼图验证码：<a target="_blank" rel="noopener" href="https://www.bootstrapmb.com/item/2880">https://www.bootstrapmb.com/item/2880</a>。</li>
<li>登录验证码识别：<a target="_blank" rel="noopener" href="https://www.bootstrapmb.com/item/8462">https://www.bootstrapmb.com/item/8462</a>。</li>
<li>多线程登录账号、多账号登录问题：以“页面对象模型”中搭建的“JForum论坛”为例进行说明。</li>
</ul>
</li>
</ul>
<h2 id="5-1-身份验证方式"><a href="#5-1-身份验证方式" class="headerlink" title="5-1 身份验证方式"></a>5-1 身份验证方式</h2><ul>
<li>身份验证方式：以“页面对象模型”中搭建的“JForum论坛”为例进行说明。<ul>
<li>保存登录cookie：先登录，将cookie保存到本地，通过加载cookie的方式解决重复登录的问题。</li>
<li>Web应用程序使用基于cookie或基于令牌的身份验证，其中经过身份验证的状态存储为cookie或本地存储。</li>
<li>Playwright提供方法用于从经过身份验证的上下文中检索存储状态，然后创建具有预填充状态的新上下文。</li>
<li>会话存储：会话存储很少用于存储与登录状态相关的信息，常用于特定域，并且不会跨页面加载持续存在。</li>
<li>保存登录的cookie或基于本地存储状态的身份验证，可以跨不同的浏览器使用，取决于应用程序的身份验证模型。</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> playwright.sync_api <span class="hljs-keyword">import</span> sync_playwright<br><br><br><span class="hljs-keyword">with</span> sync_playwright() <span class="hljs-keyword">as</span> p:<br>    browser = p.chromium.launch(headless=<span class="hljs-literal">False</span>)<br>    context = browser.new_context()<br>    page = context.new_page()<br>    page.goto(<span class="hljs-string">&#x27;http://127.0.0.1:8080/jforum-2.7.0/user/login.page&#x27;</span>)<br><br>    page.locator(<br>        <span class="hljs-string">&#x27;//*[@id=&quot;loginform&quot;]/table[2]/tbody/tr[2]/td/table/tbody/tr[2]/td[2]/input&#x27;</span><br>    ).fill(<span class="hljs-string">&#x27;admin&#x27;</span>)<br>    page.locator(<br>        <span class="hljs-string">&#x27;//*[@id=&quot;loginform&quot;]/table[2]/tbody/tr[2]/td/table/tbody/tr[3]/td[2]/input&#x27;</span><br>    ).fill(<span class="hljs-string">&#x27;123456&#x27;</span>)<br>    page.locator(<br>        <span class="hljs-string">&#x27;//*[@id=&quot;loginform&quot;]/table[2]/tbody/tr[2]/td/table/tbody/tr[5]/td/input[2]&#x27;</span><br>    ).click()<br><br>    storage = context.storage_state(path=<span class="hljs-string">&#x27;auth/state.json&#x27;</span>)     <span class="hljs-comment"># 保存storageState到指定的文件</span><br><br>    context.close()                                             <span class="hljs-comment"># 关闭上下文</span><br>    browser.close()                                             <span class="hljs-comment"># 关闭浏览器对象</span><br></code></pre></td></tr></table></figure>



<h4 id="1-生成state-json"><a href="#1-生成state-json" class="headerlink" title="(1) 生成state.json"></a>(1) 生成state.json</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs Json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;cookies&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>        <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;JSESSIONID&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;value&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;B2BAB0E2E765073EA45904A266F0F1C0&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;domain&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;127.0.0.1&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;path&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;/jforum-2.7.0&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;expires&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-1</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;httpOnly&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;secure&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">false</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;sameSite&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Lax&quot;</span><br>        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;jforumUserId&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;value&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;domain&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;127.0.0.1&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;path&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;/jforum-2.7.0&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;expires&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1732842342.156105</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;httpOnly&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;secure&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">false</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;sameSite&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Lax&quot;</span><br>        <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;origins&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>



<h4 id="2-验证是否免登"><a href="#2-验证是否免登" class="headerlink" title="(2) 验证是否免登"></a>(2) 验证是否免登</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> playwright.sync_api <span class="hljs-keyword">import</span> sync_playwright<br><br><span class="hljs-keyword">with</span> sync_playwright() <span class="hljs-keyword">as</span> p:<br>    browser = p.chromium.launch(headless=<span class="hljs-literal">False</span>)<br>    context = browser.new_context(<br>        storage_state=<span class="hljs-string">&#x27;auth/state.json&#x27;</span><br>    )                                                           <span class="hljs-comment"># 加载本地cookies，实现免登</span><br>    page = context.new_page()<br>    page.wait_for_timeout(<span class="hljs-number">1000</span>)<br>    page.goto(<span class="hljs-string">&#x27;http://127.0.0.1:8080/jforum-2.7.0/forums/list.page&#x27;</span>)<br>    page.pause()                                                <span class="hljs-comment"># 打断点查看是否免登</span><br><br>    context.close()                                             <span class="hljs-comment"># 关闭上下文</span><br>    browser.close()                                             <span class="hljs-comment"># 关闭浏览器对象</span><br></code></pre></td></tr></table></figure>



<h4 id="3-本地会话存储"><a href="#3-本地会话存储" class="headerlink" title="(3) 本地会话存储"></a>(3) 本地会话存储</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">from</span> playwright.sync_api <span class="hljs-keyword">import</span> sync_playwright<br><br><span class="hljs-keyword">with</span> sync_playwright() <span class="hljs-keyword">as</span> p:<br>    browser = p.chromium.launch(headless=<span class="hljs-literal">False</span>)<br>    context = browser.new_context()<br>    page = context.new_page()                                   <span class="hljs-comment"># 导航到特定页面</span><br>    page.goto(<span class="hljs-string">&#x27;http://127.0.0.1:8080/jforum-2.7.0/user/login.page&#x27;</span>)<br>    session_storage = page.evaluate(                            <span class="hljs-comment"># 获取sessionStorage</span><br>        <span class="hljs-string">&quot;() =&gt; JSON.stringify(sessionStorage)&quot;</span><br>    )<br>    os.environ[<span class="hljs-string">&quot;SESSION_STORAGE&quot;</span>] = session_storage             <span class="hljs-comment"># 将其存储为环境变量</span><br>    session_storage = os.environ[<span class="hljs-string">&quot;SESSION_STORAGE&quot;</span>]             <span class="hljs-comment"># 在新的上下文中设置sessionStorage</span><br>    context.add_init_script(<span class="hljs-string">&quot;&quot;&quot;(storage =&gt; &#123;</span><br><span class="hljs-string">            if (window.location.hostname === &#x27;example.com&#x27;) &#123;</span><br><span class="hljs-string">                const entries = JSON.parse(storage)</span><br><span class="hljs-string">                for (const [key, value] of Object.entries(entries)) &#123;</span><br><span class="hljs-string">                    window.sessionStorage.setItem(key, value)</span><br><span class="hljs-string">                &#125;</span><br><span class="hljs-string">            &#125;</span><br><span class="hljs-string">        &#125;)(&#x27;&quot;&quot;&quot;</span> + session_storage + <span class="hljs-string">&quot;&#x27;)&quot;</span>)<br><br>    session_storage = os.getenv(<span class="hljs-string">&quot;SESSION_STORAGE&quot;</span>)              <span class="hljs-comment"># 检查环境变量是否设置了SESSION_STORAGE</span><br>    <span class="hljs-keyword">if</span> session_storage:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;环境变量SESSION_STORAGE已经设置&quot;</span>)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;环境变量SESSION_STORAGE尚未设置&quot;</span>)<br><br>    context.close()                                             <span class="hljs-comment"># 关闭上下文</span><br>    browser.close()                                             <span class="hljs-comment"># 关闭浏览器对象</span><br></code></pre></td></tr></table></figure>



<h2 id="5-2-绕过登录验证码"><a href="#5-2-绕过登录验证码" class="headerlink" title="5-2 绕过登录验证码"></a>5-2 绕过登录验证码</h2><ul>
<li>绕过登录验证码：以“页面对象模型”中搭建的“JForum论坛”为例进行说明。<ul>
<li>浏览器手工登录，再使用Playwright接管页面，绕过登录验证码操作。</li>
<li>找到Chrome属性，复制Chrome的起始位置，添加到Path环境变量下。</li>
<li>参数说明<ul>
<li><code>--start-maximized</code>窗口最大化。</li>
<li><code>--incognito</code>隐私模式打开、<code>--new-window</code>直接打开网址。</li>
<li><code>--remote-debugging-port</code>指定运行端口，需确保没被占用。</li>
<li><code>--user-data-dir</code>指定运行浏览器的运行数据，新建目录，不影响系统原数据。</li>
</ul>
</li>
<li><code>chrome.exe --remote-debugging-port=12345 --incognito --start-maximized --user-data-dir=</code></li>
<li><code>&#39;D:\Project\Python\demo&#39; --new-window http://127.0.0.1:8080/jforum-2.7.0/user/login.page</code></li>
<li>CMD窗口输入命令启动浏览器，并打开JForum论坛，手动输入账号密码登录后，执行以下Playwright代码。</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> playwright.sync_api <span class="hljs-keyword">import</span> sync_playwright<br><br><span class="hljs-keyword">with</span> sync_playwright() <span class="hljs-keyword">as</span> p:<br>    browser = p.chromium.connect_over_cdp(<br>        <span class="hljs-string">&#x27;http://localhost:12345/&#x27;</span><br>    )                                                           <span class="hljs-comment"># 连接现有的Chromium实例</span><br>    page = browser.contexts[<span class="hljs-number">0</span>].pages[<span class="hljs-number">0</span>]                         <span class="hljs-comment"># 获取page对象</span><br>    <span class="hljs-built_in">print</span>(page.title())<br>    <span class="hljs-built_in">print</span>(page.url)<br>    page.get_by_role(<span class="hljs-string">&quot;link&quot;</span>, name=<span class="hljs-string">&quot;进入后台管理&quot;</span>).click()<br><br>    <span class="hljs-comment"># connect_over_cdp()方法将现有的Chromium浏览器实例与Playwright代码进行绑定</span><br>    <span class="hljs-comment"># 而非在Playwright中创建一个新的浏览器实例，不需要再显示地关闭已连接的浏览器实例</span><br>    <span class="hljs-comment"># browser.close()</span><br></code></pre></td></tr></table></figure>



<h2 id="5-3-登录页滑动解锁"><a href="#5-3-登录页滑动解锁" class="headerlink" title="5-3 登录页滑动解锁"></a>5-3 登录页滑动解锁</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> playwright.sync_api <span class="hljs-keyword">import</span> sync_playwright<br><br><span class="hljs-keyword">with</span> sync_playwright() <span class="hljs-keyword">as</span> p:<br>    browser = p.chromium.launch(headless=<span class="hljs-literal">False</span>, slow_mo=<span class="hljs-number">1000</span>)<br>    context = browser.new_context()                             <span class="hljs-comment"># 创建上下文</span><br>    page = context.new_page()                                   <span class="hljs-comment"># 创建新页面</span><br>    page.goto(<span class="hljs-string">&#x27;https://www.bootstrapmb.com/item/10579&#x27;</span>)         <span class="hljs-comment"># 访问滑块效果页</span><br><br>    <span class="hljs-keyword">with</span> context.expect_page() <span class="hljs-keyword">as</span> new_page_info:                <span class="hljs-comment"># 切换到滑块页面</span><br>        page.get_by_role(<span class="hljs-string">&quot;link&quot;</span>, name=<span class="hljs-string">&quot;预 览&quot;</span>).click()<br>    new_page = new_page_info.value<br>    new_page.wait_for_load_state()                              <span class="hljs-comment"># 等待页面加载到指定状态</span><br>    <br>    iframe = new_page.frame_locator(<span class="hljs-string">&#x27;//*[@id=&quot;iframe&quot;]&#x27;</span>)        <span class="hljs-comment"># 滑动模块在iframe里面</span><br>    slider = iframe.get_by_text(<span class="hljs-string">&quot;→&quot;</span>).bounding_box()<br>    slider_x = slider[<span class="hljs-string">&#x27;x&#x27;</span>] + slider[<span class="hljs-string">&#x27;width&#x27;</span>] // <span class="hljs-number">2</span>               <span class="hljs-comment"># 滑块中心点的x坐标</span><br>    slider_y = slider[<span class="hljs-string">&#x27;y&#x27;</span>] + slider[<span class="hljs-string">&#x27;height&#x27;</span>] // <span class="hljs-number">2</span>              <span class="hljs-comment"># 滑块中心点的y坐标</span><br>    target = iframe.get_by_text(<span class="hljs-string">&quot;→ 向右滑动&quot;</span>).bounding_box()<br>    target_x = target[<span class="hljs-string">&#x27;width&#x27;</span>]                                  <span class="hljs-comment"># 滑块通道总长</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;x坐标：&quot;</span>, slider_x, <span class="hljs-string">&quot;\ny坐标：&quot;</span>, slider_y, <span class="hljs-string">&quot;\n最右侧x坐标：&quot;</span>, slider_x + target_x)<br><br>    new_page.mouse.move(slider_x, slider_y)<br>    new_page.mouse.down()                                       <span class="hljs-comment"># 按住鼠标左键</span><br>    <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>):                                         <span class="hljs-comment"># 循环执行代码10次</span><br>        slider_x += <span class="hljs-number">50</span>                                          <span class="hljs-comment"># 逐步移动鼠标至滑块右侧</span><br>        new_page.mouse.move(slider_x, slider_y)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;x坐标+50：&quot;</span>, slider_x)<br>    new_page.mouse.up()                                         <span class="hljs-comment"># 释放鼠标左键</span><br><br>    browser.close()                                             <span class="hljs-comment"># 关闭浏览器对象</span><br></code></pre></td></tr></table></figure>



<h2 id="5-4-滑块拼图验证码"><a href="#5-4-滑块拼图验证码" class="headerlink" title="5-4 滑块拼图验证码"></a>5-4 滑块拼图验证码</h2><ul>
<li>滑块拼图验证码<ul>
<li>首先需要得到滑块背景图，然后计算缺口位置，最后可能还要绕过防爬虫机制，计算滑动轨迹。</li>
<li>滑块背景图可以获取到一个图片地址，缺口可能获取到图片地址，可能由Canvas标签绘制而成。</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">import</span> re<br><span class="hljs-keyword">from</span> playwright.sync_api <span class="hljs-keyword">import</span> sync_playwright<br><br><span class="hljs-keyword">with</span> sync_playwright() <span class="hljs-keyword">as</span> p:<br>    browser = p.chromium.launch(headless=<span class="hljs-literal">False</span>, slow_mo=<span class="hljs-number">1000</span>)<br>    context = browser.new_context()                             <span class="hljs-comment"># 创建上下文</span><br>    page = context.new_page()                                   <span class="hljs-comment"># 创建新页面</span><br>    page.goto(<span class="hljs-string">&#x27;https://www.bootstrapmb.com/item/2880&#x27;</span>)          <span class="hljs-comment"># 访问滑块拼图页</span><br><br>    <span class="hljs-keyword">with</span> context.expect_page() <span class="hljs-keyword">as</span> new_page_info:                <span class="hljs-comment"># 切换到滑块拼图页</span><br>        page.get_by_role(<span class="hljs-string">&quot;link&quot;</span>, name=<span class="hljs-string">&quot;预 览&quot;</span>).click()<br>    new_page = new_page_info.value<br>    new_page.wait_for_load_state()                              <span class="hljs-comment"># 等待页面加载到指定状态</span><br><br>    iframe = new_page.frame_locator(<span class="hljs-string">&#x27;//*[@id=&quot;iframe&quot;]&#x27;</span>)        <span class="hljs-comment"># 滑动模块在iframe里面</span><br>    iframe.get_by_placeholder(<span class="hljs-string">&quot;用户名&quot;</span>).fill(<span class="hljs-string">&#x27;admin&#x27;</span>)<br>    iframe.get_by_placeholder(<span class="hljs-string">&quot;密码&quot;</span>).fill(<span class="hljs-string">&#x27;123456&#x27;</span>)<br>    iframe.get_by_role(<span class="hljs-string">&quot;button&quot;</span>, name=<span class="hljs-string">&quot;登录&quot;</span>).click()<br>    src = iframe.locator(<span class="hljs-string">&#x27;//*[@id=&quot;scream&quot;]&#x27;</span>).get_attribute(<span class="hljs-string">&#x27;src&#x27;</span>)<br>    pic = <span class="hljs-string">&#x27;https://v.bootstrapmb.com/2018/11/hxge32880/&#x27;</span> + src<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;背景图地址：<span class="hljs-subst">&#123;pic&#125;</span>&#x27;</span>)<br><br>    canvas_style = iframe.locator(<br>        <span class="hljs-string">&#x27;//*[@id=&quot;imgVer&quot;]/div[1]/div[1]/div[2]&#x27;</span><br>    ).get_attribute(<span class="hljs-string">&#x27;style&#x27;</span>)<br>    left_value = re.search(<span class="hljs-string">r&#x27;left:\s*(-?\d+)px&#x27;</span>, canvas_style).group(<span class="hljs-number">1</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;缺口需移动的距离：<span class="hljs-subst">&#123;left_value&#125;</span>&#x27;</span>)<br><br>    canvas = iframe.locator(<span class="hljs-string">&quot;#puzzleBox&quot;</span>).bounding_box()<br>    canvas_x = canvas[<span class="hljs-string">&#x27;x&#x27;</span>]                                      <span class="hljs-comment"># 左边距</span><br>    canvas_y = canvas[<span class="hljs-string">&#x27;y&#x27;</span>]                                      <span class="hljs-comment"># 上边距</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;canvas位置：左边距=<span class="hljs-subst">&#123;canvas_x&#125;</span>, 上边距=<span class="hljs-subst">&#123;canvas_y&#125;</span>&#x27;</span>)<br><br>    slider = iframe.locator(<span class="hljs-string">&quot;.slider-btn&quot;</span>).bounding_box()<br>    <span class="hljs-built_in">print</span>(slider)                                               <span class="hljs-comment"># 返回滑块的x，y，滑块大小</span><br><br>    new_page.mouse.move(x=<span class="hljs-built_in">int</span>(slider[<span class="hljs-string">&#x27;x&#x27;</span>]), y=slider[<span class="hljs-string">&#x27;y&#x27;</span>] + slider[<span class="hljs-string">&#x27;height&#x27;</span>]/<span class="hljs-number">2</span>)<br>    new_page.mouse.down(button=<span class="hljs-string">&#x27;middle&#x27;</span>)<br>    new_page.wait_for_timeout(<span class="hljs-number">1000</span>)<br>    new_page.mouse.move(<br>        x=<span class="hljs-built_in">int</span>(slider[<span class="hljs-string">&#x27;x&#x27;</span>])-<span class="hljs-built_in">int</span>(left_value), y=slider[<span class="hljs-string">&#x27;y&#x27;</span>] + slider[<span class="hljs-string">&#x27;height&#x27;</span>]/<span class="hljs-number">2</span><br>    )<br>    new_page.mouse.up()<br><br>    browser.close()                                             <span class="hljs-comment"># 关闭浏览器对象</span><br></code></pre></td></tr></table></figure>



<h2 id="5-5-登录验证码识别"><a href="#5-5-登录验证码识别" class="headerlink" title="5-5 登录验证码识别"></a>5-5 登录验证码识别</h2><ul>
<li>登录验证码识别<ul>
<li>思路：先获取到验证码图片，定位元素，对元素截图即可，再使用ddddocr库快速识别。</li>
<li>命令安装ddddocr库：<code>pip install ddddocr -i https://pypi.douban.com/simple</code>。</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">import</span> ddddocr<br><span class="hljs-keyword">from</span> playwright.sync_api <span class="hljs-keyword">import</span> sync_playwright<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">handle_dialog</span>(<span class="hljs-params">dialog</span>):                                      <span class="hljs-comment"># 触发弹出窗口的操作未知时使用</span><br>    <span class="hljs-built_in">print</span>(dialog.message)                                       <span class="hljs-comment"># 获取对话框中显示的消息</span><br>    <span class="hljs-keyword">assert</span> dialog.message == <span class="hljs-string">&#x27;提交成功！&#x27;</span><br>    dialog.dismiss()                                            <span class="hljs-comment"># 关闭对话框</span><br><br><br><span class="hljs-keyword">with</span> sync_playwright() <span class="hljs-keyword">as</span> p:<br>    browser = p.chromium.launch(headless=<span class="hljs-literal">False</span>, slow_mo=<span class="hljs-number">1000</span>)<br>    context = browser.new_context()                             <span class="hljs-comment"># 创建上下文</span><br>    page = context.new_page()                                   <span class="hljs-comment"># 创建新页面</span><br>    page.goto(<span class="hljs-string">&#x27;https://www.bootstrapmb.com/item/8462&#x27;</span>)          <span class="hljs-comment"># 访问验证码页</span><br><br>    <span class="hljs-keyword">with</span> context.expect_page() <span class="hljs-keyword">as</span> new_page_info:                <span class="hljs-comment"># 切换到验证码页</span><br>        page.get_by_role(<span class="hljs-string">&quot;link&quot;</span>, name=<span class="hljs-string">&quot;预 览&quot;</span>).click()<br>    new_page = new_page_info.value<br>    new_page.wait_for_load_state()                              <span class="hljs-comment"># 等待页面加载到指定状态</span><br><br>    iframe = new_page.frame_locator(<span class="hljs-string">&#x27;//*[@id=&quot;iframe&quot;]&#x27;</span>)        <span class="hljs-comment"># 滑动模块在iframe里面</span><br>    iframe.locator(<br>        <span class="hljs-string">&quot;#canvas&quot;</span><br>    ).screenshot(path=<span class="hljs-string">&#x27;pictures/code.png&#x27;</span>)                      <span class="hljs-comment"># 保存验证码</span><br><br>    ocr = ddddocr.DdddOcr(show_ad=<span class="hljs-literal">False</span>)                        <span class="hljs-comment"># 识别验证码，实例化</span><br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;pictures/code.png&#x27;</span>, <span class="hljs-string">&#x27;rb&#x27;</span>) <span class="hljs-keyword">as</span> f:                  <span class="hljs-comment"># 打开图片</span><br>        img_bytes = f.read()                                    <span class="hljs-comment"># 读取图片</span><br>    code = ocr.classification(img_bytes)                        <span class="hljs-comment"># 识别验证码</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;验证码：<span class="hljs-subst">&#123;code&#125;</span>&#x27;</span>)<br><br>    iframe.get_by_placeholder(<span class="hljs-string">&quot;请输入验证码（不区分大小写）&quot;</span>).fill(code)<br>    iframe.get_by_role(<span class="hljs-string">&quot;button&quot;</span>, name=<span class="hljs-string">&quot;提交&quot;</span>).click()<br>    new_page.on(<span class="hljs-string">&quot;dialog&quot;</span>, handle_dialog)<br><br>    browser.close()                                             <span class="hljs-comment"># 关闭浏览器对象</span><br></code></pre></td></tr></table></figure>



<h2 id="5-6-多线程登录账号"><a href="#5-6-多线程登录账号" class="headerlink" title="5-6 多线程登录账号"></a>5-6 多线程登录账号</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> threading <span class="hljs-keyword">import</span> Thread<br><span class="hljs-keyword">from</span> playwright.sync_api <span class="hljs-keyword">import</span> sync_playwright<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">do_some_thing</span>(<span class="hljs-params">username, password</span>):<br>    p = sync_playwright().start()<br>    browser = p.chromium.launch(headless=<span class="hljs-literal">False</span>, slow_mo=<span class="hljs-number">1000</span>)<br>    context = browser.new_context()<br>    page = context.new_page()<br>    page.goto(<span class="hljs-string">&quot;http://127.0.0.1:8080/jforum-2.7.0/user/login.page&quot;</span>)<br><br>    page.locator(<span class="hljs-string">&quot;input[name=\&quot;username\&quot;]&quot;</span>).fill(username)<br>    page.locator(<span class="hljs-string">&quot;input[name=\&quot;password\&quot;]&quot;</span>).fill(password)<br>    page.get_by_role(<span class="hljs-string">&quot;button&quot;</span>, name=<span class="hljs-string">&quot;登入&quot;</span>).click()<br><br>    page.pause()                                                <span class="hljs-comment"># 暂停查看效果</span><br>    context.close()<br>    browser.close()                                             <span class="hljs-comment"># 关闭浏览器对象</span><br><br><br>users = [[<span class="hljs-string">&quot;Admin&quot;</span>, <span class="hljs-string">&quot;123456&quot;</span>], [<span class="hljs-string">&quot;Mickey&quot;</span>, <span class="hljs-string">&quot;123456&quot;</span>], [<span class="hljs-string">&quot;Elliott&quot;</span>, <span class="hljs-string">&quot;123456&quot;</span>]]<br><span class="hljs-keyword">for</span> user <span class="hljs-keyword">in</span> users:                                              <span class="hljs-comment"># 多线程，3个账号同时操作</span><br>    thread = Thread(target=do_some_thing, args=user)<br>    thread.start()<br></code></pre></td></tr></table></figure>



<h2 id="5-7-多账号登录问题"><a href="#5-7-多账号登录问题" class="headerlink" title="5-7 多账号登录问题*"></a>5-7 多账号登录问题*</h2><ul>
<li>多账号登录问题：以“页面对象模型”中搭建的“JForum论坛”为例进行说明。<ul>
<li>Admin账号删除版块中的测试帖，进入后台管理，修改版块名称为“每日一言”。</li>
<li>用户的发帖与回帖功能，需要使用Admin管理员账号在后台管理中将验证码关闭。</li>
<li>双账号切换操作：代码实现Admin账号登录进行发帖，Mickey账号登录进行回帖。</li>
</ul>
</li>
</ul>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs Txt">- cases                                                          # 用于放置测试用例<br>    - test_login.py<br>    - __init__.py                                                # 空<br>- models                                                         # 用于放置封装好的类文件<br>    - post_page.py<br>    - login_page.py<br>    - __init.py                                                  # 空<br>- conftest.py                                                    # 用于定义共享的fixtures和钩子函数hooks<br></code></pre></td></tr></table></figure>



<h4 id="1-conftest-py"><a href="#1-conftest-py" class="headerlink" title="(1) conftest.py"></a>(1) conftest.py</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">import</span> pytest                                                   <span class="hljs-comment"># conftest.py</span><br><span class="hljs-keyword">from</span> playwright.sync_api <span class="hljs-keyword">import</span> sync_playwright<br><br><br><span class="hljs-meta">@pytest.fixture(<span class="hljs-params">scope=<span class="hljs-string">&quot;session&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">context_chrome</span>():<br>    p = sync_playwright().start()                               <span class="hljs-comment"># 前置操作代码</span><br>    browser = p.chromium.launch(headless=<span class="hljs-literal">False</span>, slow_mo=<span class="hljs-number">1000</span>)<br>    <span class="hljs-keyword">yield</span> browser<br><br>    browser.close()                                             <span class="hljs-comment"># 后置操作代码</span><br>    p.stop()<br></code></pre></td></tr></table></figure>



<h4 id="2-post-page-py"><a href="#2-post-page-py" class="headerlink" title="(2) post_page.py"></a>(2) post_page.py</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> playwright.sync_api <span class="hljs-keyword">import</span> Page                            <span class="hljs-comment"># post_page.py</span><br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">PostPage</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, page: Page</span>):<br>        self.page = page<br><br>        self.locator_section = page.get_by_role(<span class="hljs-string">&quot;link&quot;</span>, name=<span class="hljs-string">&quot;每日一言&quot;</span>)<br>        self.locator_topic = page.get_by_role(<br>            <span class="hljs-string">&quot;row&quot;</span>, name=<span class="hljs-string">&quot;搜索&quot;</span>, exact=<span class="hljs-literal">True</span><br>        ).get_by_role(<span class="hljs-string">&quot;cell&quot;</span>).first<br><br>        self.locator_post = page.get_by_role(<span class="hljs-string">&quot;link&quot;</span>, name=<span class="hljs-string">&quot;每日英语&quot;</span>)<br>        self.locator_english = page.locator(<br>            <span class="hljs-string">&quot;.bodyline &gt; table:nth-child(2) &gt; tbody &gt; tr &gt; td&quot;</span><br>        ).first<br><br>        self.locator_subject = page.locator(<span class="hljs-string">&quot;input[name=\&quot;subject\&quot;]&quot;</span>)<br>        self.locator_message = page.locator(<span class="hljs-string">&quot;textarea[name=\&quot;message\&quot;]&quot;</span>)<br>        self.locator_sending = page.get_by_role(<span class="hljs-string">&quot;button&quot;</span>, name=<span class="hljs-string">&quot;发送&quot;</span>)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">navigate_daily_word</span>(<span class="hljs-params">self</span>):<br>        self.locator_section.click()<br>        self.locator_topic.click()<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">posted</span>(<span class="hljs-params">self, subject, message</span>):                         <span class="hljs-comment"># 发帖</span><br>        self.locator_subject.fill(subject)<br>        self.locator_message.fill(message)<br>        self.locator_sending.click()<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">navigate_daily_english</span>(<span class="hljs-params">self</span>):<br>        self.locator_section.click()<br>        self.locator_post.click()<br>        self.locator_english.click()<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">reply</span>(<span class="hljs-params">self, message</span>):                                   <span class="hljs-comment"># 回帖</span><br>        self.locator_message.fill(message)<br>        self.locator_sending.click()<br></code></pre></td></tr></table></figure>



<h4 id="3-login-page-py"><a href="#3-login-page-py" class="headerlink" title="(3) login_page.py"></a>(3) login_page.py</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> playwright.sync_api <span class="hljs-keyword">import</span> Page                            <span class="hljs-comment"># login_page.py</span><br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">LoginPage</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, page: Page</span>):<br>        self.page = page<br>        self.locator_username = page.locator(<span class="hljs-string">&quot;input[name=\&quot;username\&quot;]&quot;</span>)<br>        self.locator_password = page.locator(<span class="hljs-string">&quot;input[name=\&quot;password\&quot;]&quot;</span>)<br>        self.locator_login_btn = page.get_by_role(<span class="hljs-string">&quot;button&quot;</span>, name=<span class="hljs-string">&quot;登入&quot;</span>)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">navigate</span>(<span class="hljs-params">self</span>):                                         <span class="hljs-comment"># 导航到登录页面</span><br>        self.page.goto(<span class="hljs-string">&quot;http://127.0.0.1:8080/jforum-2.7.0/user/login.page&quot;</span>)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">login</span>(<span class="hljs-params">self, username, password</span>):                        <span class="hljs-comment"># 登录</span><br>        self.locator_username.fill(username)<br>        self.locator_password.fill(password)<br>        self.locator_login_btn.click()<br></code></pre></td></tr></table></figure>



<h4 id="4-test-login-py"><a href="#4-test-login-py" class="headerlink" title="(4) test_login.py"></a>(4) test_login.py</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">import</span> pytest                                                   <span class="hljs-comment"># test_login.py</span><br><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">from</span> models.post_page <span class="hljs-keyword">import</span> PostPage<br><span class="hljs-keyword">from</span> models.login_page <span class="hljs-keyword">import</span> LoginPage<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">message_content</span>():<br>    response = requests.get(<span class="hljs-string">&#x27;https://api.vvhan.com/api/en?type=sj&#x27;</span>)<br>    <span class="hljs-keyword">if</span> response.status_code == <span class="hljs-number">200</span>:<br>        data = response.json()                                  <span class="hljs-comment"># 解析JSON响应</span><br>        zh_content = data[<span class="hljs-string">&#x27;data&#x27;</span>][<span class="hljs-string">&#x27;zh&#x27;</span>]                         <span class="hljs-comment"># 获取zh和en内容</span><br>        en_content = data[<span class="hljs-string">&#x27;data&#x27;</span>][<span class="hljs-string">&#x27;en&#x27;</span>]<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;en_content&#125;</span>&#x27;</span>)                                  <span class="hljs-comment"># 打印内容</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;zh_content&#125;</span>&#x27;</span>)<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;en_content&#125;</span>&#x27;</span> + <span class="hljs-string">&#x27;/n&#x27;</span> + <span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;zh_content&#125;</span>&#x27;</span><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;API获取每日英语失败。&quot;</span>)<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;API获取每日英语失败。&quot;</span><br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">TestMoreAccounts</span>:                                         <span class="hljs-comment"># 多账号切换操作</span><br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        测试流程：</span><br><span class="hljs-string">            step--Admin登录，发帖</span><br><span class="hljs-string">            step--Mickey登录，回帖</span><br><span class="hljs-string">        :return:</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br><span class="hljs-meta">    @pytest.fixture(<span class="hljs-params">autouse=<span class="hljs-literal">True</span></span>)                               </span><span class="hljs-comment"># True为作用域内的用例自动调用</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">start_for_each</span>(<span class="hljs-params">self, context_chrome</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;访问登录页&quot;</span>)<br><br>        admin_context = context_chrome.new_context()            <span class="hljs-comment"># 管理员登录</span><br>        admin_page = admin_context.new_page()<br>        self.user_admin_login = LoginPage(admin_page)<br>        self.user_admin_login.navigate()                        <span class="hljs-comment"># 每个账户操作</span><br>        self.user_admin_post = PostPage(admin_page)             <span class="hljs-comment"># 都将产生两个浏览器？？？</span><br><br>        general_context = context_chrome.new_context()          <span class="hljs-comment"># 普通用户登录</span><br>        general_page = general_context.new_page()<br>        self.uesr_general_login = LoginPage(general_page)<br>        self.uesr_general_login.navigate()<br>        self.user_general_reply = PostPage(general_page)<br><br>        <span class="hljs-keyword">yield</span>                                                   <span class="hljs-comment"># 将一个函数变成一个生成器</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;关闭登录页&quot;</span>)<br>        admin_context.close()<br>        general_context.close()                                 <span class="hljs-comment"># 关闭上下文</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_admin</span>(<span class="hljs-params">self</span>):<br>        self.user_admin_login.login(<span class="hljs-string">&quot;Admin&quot;</span>, <span class="hljs-string">&quot;123456&quot;</span>)<br>        self.user_admin_post.navigate_daily_word()<br>        self.user_admin_post.posted(<span class="hljs-string">&quot;每日英语&quot;</span>, message_content())<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_general</span>(<span class="hljs-params">self</span>):<br>        self.uesr_general_login.login(<span class="hljs-string">&quot;Mickey&quot;</span>, <span class="hljs-string">&quot;123456&quot;</span>)<br>        self.user_general_reply.navigate_daily_english()<br>        self.user_general_reply.reply(message_content())<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    pytest.main()<br></code></pre></td></tr></table></figure>



<h1 id="6-Mock接口返回"><a href="#6-Mock接口返回" class="headerlink" title="6 Mock接口返回"></a>6 Mock接口返回</h1><ul>
<li>Mock接口返回<ul>
<li>Playwright提供API，用来模拟和修改网络请求，包括HTTP和HTTPS。</li>
<li>页面执行的任何请求包括XHR和获取请求，都可以被跟踪、修改和模拟。</li>
<li>使用<code>page.route()</code>方法创建Route对象，指定要拦截的请求URL，或使用正则表达式进行匹配。</li>
<li>创建Route对象后，通过调用<code>route.abort()</code>、<code>route.fulfill()</code>等来控制请求的进一步处理。</li>
</ul>
</li>
</ul>
<h2 id="6-1-方法"><a href="#6-1-方法" class="headerlink" title="6-1 方法"></a>6-1 方法</h2><ul>
<li>方法<ul>
<li><code>route.abort()</code>，中止请求，可以选择指定的错误代码。</li>
<li><code>route.fetch()</code>，执行请求并在不满足的情况下获取结果，以修改完成响应。</li>
<li><code>route.fulfill()</code>，用于模拟完成请求，即手动提供响应数据，并结束请求。</li>
<li><code>route.fallback()</code>，用于指定当请求未匹配到任何拦截规则时候的回退行为。</li>
<li><code>route.continue_()</code>，继续请求，使其按照正常的流程继续发送，并接收响应。</li>
</ul>
</li>
</ul>
<h4 id="1-abort"><a href="#1-abort" class="headerlink" title="(1) abort()*"></a>(1) abort()*</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> playwright.sync_api <span class="hljs-keyword">import</span> sync_playwright<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">intercept_request</span>(<span class="hljs-params">route, request</span>):<br>    <span class="hljs-keyword">if</span> request.url.startswith(<span class="hljs-string">&quot;https://www.amap.com&quot;</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Intercepted request to: <span class="hljs-subst">&#123;request.url&#125;</span>&quot;</span>)<br>        route.abort()                                           <span class="hljs-comment"># 中止请求</span><br><br><br><span class="hljs-keyword">with</span> sync_playwright() <span class="hljs-keyword">as</span> p:<br>    browser = p.chromium.launch(headless=<span class="hljs-literal">False</span>, slow_mo=<span class="hljs-number">1000</span>)<br>    page = browser.new_page()<br>    page.route(                                                 <span class="hljs-comment"># 监听请求并拦截</span><br>        <span class="hljs-string">&quot;**/*&quot;</span>, <span class="hljs-keyword">lambda</span> route, request: intercept_request(route, request)<br>    )<br>    page.goto(<span class="hljs-string">&quot;https://www.amap.com/smog&quot;</span>)                      <span class="hljs-comment"># 报错，无法访问网站？？？</span><br>    browser.close()                                             <span class="hljs-comment"># 关闭浏览器对象</span><br></code></pre></td></tr></table></figure>



<h4 id="2-fetch"><a href="#2-fetch" class="headerlink" title="(2) fetch()"></a>(2) fetch()</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> playwright.sync_api <span class="hljs-keyword">import</span> sync_playwright<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">handle</span>(<span class="hljs-params">route</span>):<br>    response = route.fetch()                                    <span class="hljs-comment"># 获取网络请求的响应</span><br>    json = response.json()                                      <span class="hljs-comment"># 将响应转换成Json格式</span><br>    json[<span class="hljs-string">&quot;message&quot;</span>][<span class="hljs-string">&quot;big_red_dog&quot;</span>] = []                         <span class="hljs-comment"># 添加响应数据big_red_dog，属性值设为空</span><br>    route.fulfill(response=response, json=json)<br><br><br><span class="hljs-keyword">with</span> sync_playwright() <span class="hljs-keyword">as</span> p:<br>    browser = p.chromium.launch(headless=<span class="hljs-literal">False</span>, slow_mo=<span class="hljs-number">1000</span>)<br>    page = browser.new_page()<br>    page.route(<span class="hljs-string">&quot;https://dog.ceo/api/breeds/list/all&quot;</span>, handle)   <span class="hljs-comment"># 暂停后，在当前页面访问接口地址</span><br>    page.pause()                                                <span class="hljs-comment"># F12查看响应数据的添加情况</span><br>    browser.close()                                             <span class="hljs-comment"># 关闭浏览器对象</span><br></code></pre></td></tr></table></figure>



<h4 id="3-fulfill"><a href="#3-fulfill" class="headerlink" title="(3) fulfill()"></a>(3) fulfill()</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> playwright.sync_api <span class="hljs-keyword">import</span> sync_playwright<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">intercept_request</span>(<span class="hljs-params">route, request</span>):<br>    <span class="hljs-keyword">if</span> request.url.startswith(<span class="hljs-string">&quot;https://dog.ceo/api/breeds/list/all&quot;</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Intercepted request to: <span class="hljs-subst">&#123;request.url&#125;</span>&quot;</span>)<br>        route.fulfill(<br>            status=<span class="hljs-number">200</span>,                                         <span class="hljs-comment"># 状态码</span><br>            body=<span class="hljs-string">&#x27;&#123;&quot;message&quot;: &quot;Hello, World!&quot;&#125;&#x27;</span>,                <span class="hljs-comment"># 响应体</span><br>            headers=&#123;<span class="hljs-string">&#x27;Content-Type&#x27;</span>: <span class="hljs-string">&#x27;application/json&#x27;</span>&#125;        <span class="hljs-comment"># 响应头</span><br>        )                                                       <span class="hljs-comment"># 模拟完成请求</span><br>    <span class="hljs-keyword">else</span>:<br>        route.continue_()                                       <span class="hljs-comment"># 条件不符则允许请求正常进行</span><br><br><br><span class="hljs-keyword">with</span> sync_playwright() <span class="hljs-keyword">as</span> p:<br>    browser = p.chromium.launch(headless=<span class="hljs-literal">False</span>, slow_mo=<span class="hljs-number">1000</span>)<br>    page = browser.new_page()<br>    page.route(<br>        <span class="hljs-string">&quot;**/*&quot;</span>, <span class="hljs-keyword">lambda</span> route, request: intercept_request(route, request)<br>    )                                                           <span class="hljs-comment"># 监听请求并拦截</span><br>    page.goto(<span class="hljs-string">&quot;https://dog.ceo/api/breeds/list/all&quot;</span>)<br>    page.pause()<br>    browser.close()                                             <span class="hljs-comment"># 关闭浏览器对象</span><br></code></pre></td></tr></table></figure>



<h4 id="4-fallback"><a href="#4-fallback" class="headerlink" title="(4) fallback()"></a>(4) fallback()</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> playwright.sync_api <span class="hljs-keyword">import</span> sync_playwright<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">intercept_request</span>(<span class="hljs-params">route, request</span>):<br>    <span class="hljs-keyword">if</span> request.url.startswith(<span class="hljs-string">&quot;https://www.amap.com/smog&quot;</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Intercepted request to: <span class="hljs-subst">&#123;request.url&#125;</span>&quot;</span>)<br>        route.abort()                                           <span class="hljs-comment"># 中止请求</span><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Fallback: <span class="hljs-subst">&#123;request.url&#125;</span>&quot;</span>)                       <span class="hljs-comment"># 打印回退消息</span><br>        route.fallback()                                        <span class="hljs-comment"># 触发回退行为，允许请求正常继续</span><br><br><br><span class="hljs-keyword">with</span> sync_playwright() <span class="hljs-keyword">as</span> p:<br>    browser = p.chromium.launch(headless=<span class="hljs-literal">False</span>, slow_mo=<span class="hljs-number">1000</span>)<br>    page = browser.new_page()<br>    page.route(                                                 <span class="hljs-comment"># 监听请求并拦截</span><br>        <span class="hljs-string">&quot;**/*&quot;</span>, <span class="hljs-keyword">lambda</span> route, request: intercept_request(route, request)<br>    )<br>    page.goto(<span class="hljs-string">&quot;https://www.amap.com&quot;</span>)<br>    browser.close()                                             <span class="hljs-comment"># 关闭浏览器对象</span><br></code></pre></td></tr></table></figure>



<h4 id="5-continue"><a href="#5-continue" class="headerlink" title="(5) continue_()*"></a>(5) continue_()*</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> playwright.sync_api <span class="hljs-keyword">import</span> sync_playwright<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">intercept_request</span>(<span class="hljs-params">route, request</span>):<br>    <span class="hljs-keyword">if</span> request.url.startswith(<span class="hljs-string">&quot;https://www.amap.com&quot;</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Intercepted request to: <span class="hljs-subst">&#123;request.url&#125;</span>&quot;</span>)<br>        route.continue_()                                       <span class="hljs-comment"># 继续请求，报错？？？</span><br><br><br><span class="hljs-keyword">with</span> sync_playwright() <span class="hljs-keyword">as</span> p:<br>    browser = p.chromium.launch(headless=<span class="hljs-literal">False</span>, slow_mo=<span class="hljs-number">1000</span>)<br>    page = browser.new_page()<br>    page.route(                                                 <span class="hljs-comment"># 监听请求并拦截</span><br>        <span class="hljs-string">&quot;**/*&quot;</span>, <span class="hljs-keyword">lambda</span> route, request: intercept_request(route, request)<br>    )<br>    page.goto(<span class="hljs-string">&quot;https://www.amap.com/smog&quot;</span>)<br>    browser.close()                                             <span class="hljs-comment"># 关闭浏览器对象</span><br></code></pre></td></tr></table></figure>



<h2 id="6-2-属性"><a href="#6-2-属性" class="headerlink" title="6-2 属性"></a>6-2 属性</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> playwright.sync_api <span class="hljs-keyword">import</span> sync_playwright<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">intercept_request</span>(<span class="hljs-params">route, request</span>):<br>    <span class="hljs-keyword">if</span> request.url.startswith(<span class="hljs-string">&quot;https://dog.ceo/api/breeds/list/all&quot;</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Intercepted request to: <span class="hljs-subst">&#123;request.url&#125;</span>&quot;</span>)<br>        route.fulfill(<br>            status=<span class="hljs-number">200</span>,                                         <span class="hljs-comment"># 状态码</span><br>            body=<span class="hljs-string">&#x27;&#123;&quot;message&quot;: &quot;Hello, World!&quot;&#125;&#x27;</span>,                <span class="hljs-comment"># 响应体</span><br>            headers=&#123;<span class="hljs-string">&#x27;Content-Type&#x27;</span>: <span class="hljs-string">&#x27;application/json&#x27;</span>&#125;        <span class="hljs-comment"># 响应头</span><br>        )                                                       <span class="hljs-comment"># 模拟完成请求</span><br>        <span class="hljs-built_in">print</span>(route.request)                                    <span class="hljs-comment"># 获取当前请求的相关信息或属性</span><br>    <span class="hljs-keyword">else</span>:<br>        route.continue_()                                       <span class="hljs-comment"># 条件不符则允许请求正常进行</span><br><br><br><span class="hljs-keyword">with</span> sync_playwright() <span class="hljs-keyword">as</span> p:<br>    browser = p.chromium.launch(headless=<span class="hljs-literal">False</span>, slow_mo=<span class="hljs-number">1000</span>)<br>    page = browser.new_page()<br>    page.route(<br>        <span class="hljs-string">&quot;**/*&quot;</span>, <span class="hljs-keyword">lambda</span> route, request: intercept_request(route, request)<br>    )                                                           <span class="hljs-comment"># 监听请求并拦截</span><br>    page.goto(<span class="hljs-string">&quot;https://dog.ceo/api/breeds/list/all&quot;</span>)<br>    browser.close()                                             <span class="hljs-comment"># 关闭浏览器对象</span><br></code></pre></td></tr></table></figure>



<h1 id="7-JavaScript脚本"><a href="#7-JavaScript脚本" class="headerlink" title="7 JavaScript脚本"></a>7 JavaScript脚本</h1><ul>
<li>JavaScript脚本<ul>
<li>页面对象执行JavaScript脚本<ul>
<li>Playwright使用<code>page.evaluate()</code>执行JavaScript代码并返回调用执行的结果。</li>
<li>使用<code>page.evaluate_handle()</code>执行JavaScript代码，并返回执行结果的句柄。</li>
</ul>
</li>
<li>定位元素执行JavaScript脚本<ul>
<li>通过<code>locator.evaluate()</code>方法，对定位到的元素执行JavaScript代码。</li>
<li>使用<code>locator.evaluate_all()</code>对定位的所有元素执行JavaScript代码。</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="7-1-页面Js"><a href="#7-1-页面Js" class="headerlink" title="7-1 页面Js"></a>7-1 页面Js</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> playwright.sync_api <span class="hljs-keyword">import</span> sync_playwright<br><br><span class="hljs-keyword">with</span> sync_playwright() <span class="hljs-keyword">as</span> p:<br>    browser = p.chromium.launch(headless=<span class="hljs-literal">False</span>, slow_mo=<span class="hljs-number">1000</span>)<br>    page = browser.new_page()<br><br>    <span class="hljs-built_in">print</span>(page.evaluate(<span class="hljs-string">&quot;1 + 2&quot;</span>))                               <span class="hljs-comment"># 3</span><br>    x = <span class="hljs-number">10</span><br>    <span class="hljs-built_in">print</span>(page.evaluate(<span class="hljs-string">f&quot;1 + <span class="hljs-subst">&#123;x&#125;</span>&quot;</span>))                            <span class="hljs-comment"># 11</span><br><br>    res = page.evaluate(<span class="hljs-string">&quot;() =&gt; &#x27;Hello World!&#x27;&quot;</span>, )               <span class="hljs-comment"># 执行一个函数</span><br>    <span class="hljs-built_in">print</span>(res)                                                  <span class="hljs-comment"># Hello World!</span><br>    res = page.evaluate(<br>        <span class="hljs-string">&quot;([a, b]) =&gt; a+b+&#x27;World!&#x27;&quot;</span>, [<span class="hljs-string">&quot;Hello&quot;</span>, <span class="hljs-string">&#x27; &#x27;</span>]              <span class="hljs-comment"># 执行的函数可以带参数</span><br>    )<br>    <span class="hljs-built_in">print</span>(res)                                                  <span class="hljs-comment"># hello world</span><br><br>    page.goto(<span class="hljs-string">&quot;https://www.baidu.com/&quot;</span>)<br>    title = page.evaluate(<span class="hljs-string">&#x27;document.title&#x27;</span>)                     <span class="hljs-comment"># 获取页面的title</span><br>    <span class="hljs-built_in">print</span>(title)<br><br>    page = browser.new_page()                                   <span class="hljs-comment"># 需要开启JForum论坛服务</span><br>    page.goto(<span class="hljs-string">&quot;http://127.0.0.1:8080/jforum-2.7.0/user/login.page&quot;</span>)<br>    js = <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        document.querySelector(&#x27;input[name=&quot;username&quot;]&#x27;).value=&#x27;admin&#x27;;</span><br><span class="hljs-string">        document.querySelector(&#x27;input[name=&quot;password&quot;]&#x27;).value=&#x27;123456&#x27;;</span><br><span class="hljs-string">        document.querySelector(&#x27;input[name=&quot;login&quot;]&#x27;).click();</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>    page.evaluate(js)<br><br>    a_handle = page.evaluate_handle(<span class="hljs-string">&quot;document.body&quot;</span>)            <span class="hljs-comment"># 返回句柄JSHandle</span><br>    result_handle = page.evaluate_handle(<span class="hljs-string">&quot;body =&gt; body.innerHTML&quot;</span>, a_handle)<br>    <span class="hljs-built_in">print</span>(result_handle.json_value())<br>    result_handle.dispose()                                     <span class="hljs-comment"># 释放result_handle对象，避免内存泄漏</span><br><br>    browser.close()                                             <span class="hljs-comment"># 关闭浏览器对象</span><br></code></pre></td></tr></table></figure>



<h2 id="7-2-元素Js"><a href="#7-2-元素Js" class="headerlink" title="7-2 元素Js"></a>7-2 元素Js</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> playwright.sync_api <span class="hljs-keyword">import</span> sync_playwright<br><br><span class="hljs-keyword">with</span> sync_playwright() <span class="hljs-keyword">as</span> p:<br>    browser = p.chromium.launch(headless=<span class="hljs-literal">False</span>, slow_mo=<span class="hljs-number">1000</span>)<br>    page = browser.new_page()<br>    page.goto(<span class="hljs-string">&quot;http://127.0.0.1:8080/jforum-2.7.0/user/login.page&quot;</span>)<br>    username = page.locator(<br>        <span class="hljs-string">&#x27;//*[@id=&quot;loginform&quot;]/table[2]/tbody/tr[2]/td/table/tbody/tr[2]/td[2]/input&#x27;</span><br>    )<br>    username.evaluate(<span class="hljs-string">&#x27;node =&gt; node.value=&quot;admin&quot;&#x27;</span>)             <span class="hljs-comment"># 输入框输入内容</span><br>    input_value = username.evaluate(<span class="hljs-string">&#x27;node =&gt; node.value&#x27;</span>)<br>    <span class="hljs-built_in">print</span>(input_value)                                          <span class="hljs-comment"># 获取输入框内容</span><br><br>    page.goto(<span class="hljs-string">&quot;https://www.baidu.com/&quot;</span>)<br>    links = page.locator(<span class="hljs-string">&#x27;#s-top-left&gt;a&#x27;</span>)<br>    res = links.evaluate_all(<span class="hljs-string">&#x27;nodes =&gt; nodes.length&#x27;</span>)           <span class="hljs-comment"># 定位全部元素</span><br>    <span class="hljs-built_in">print</span>(res)                                                  <span class="hljs-comment"># nodes.length获取元素个数</span><br><br>    browser.close()                                             <span class="hljs-comment"># 关闭浏览器对象</span><br></code></pre></td></tr></table></figure>



<h1 id="8-Pyinstaller打包"><a href="#8-Pyinstaller打包" class="headerlink" title="8 Pyinstaller打包"></a>8 Pyinstaller打包</h1><ul>
<li>Pyinstaller打包<ul>
<li>Playwright与Pyinstaller三方插件结合使用，可用来创建独立的可执行文件。</li>
<li>例如：要打包一个files_pack.py文件。<ul>
<li>先在当前文件夹中设置环境变量：<code>set PLAYWRIGHT_BROWSERS_PATH=0</code>。</li>
<li>然后命令安装文件中使用到的浏览器：<code>playwright install chromium</code>。</li>
<li>最后使用命令查看浏览器的安装路径：<code>playwright install --dry-run</code>。</li>
<li>可以看到chromium-1048和ffmpeg-1008这两个文件，后缀数字是版本号。</li>
</ul>
</li>
<li>打包files_pack.py文件命令如下，打包后的可执行文件可在当前目录的dist文件夹中找到。<ul>
<li>依赖文件较多，首次打包需加载好一会：<code>pyinstaller -F files_pack.py</code>。</li>
<li>打包时自定义ico图标：<code>pyinstaller -F files_pack.py -i favicon.ico</code>。</li>
<li>ico图标制作可以使用地址“<a target="_blank" rel="noopener" href="https://www.bitbug.net/">在线制作ico图标</a>”，提供图片线上转换即可。</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="8-1-files-pack-py"><a href="#8-1-files-pack-py" class="headerlink" title="8-1 files_pack.py"></a>8-1 files_pack.py</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> playwright.sync_api <span class="hljs-keyword">import</span> sync_playwright                  <span class="hljs-comment"># files_pack.py</span><br><br><span class="hljs-keyword">with</span> sync_playwright() <span class="hljs-keyword">as</span> p:<br>    browser = p.chromium.launch(headless=<span class="hljs-literal">False</span>, slow_mo=<span class="hljs-number">1000</span>)<br>    page = browser.new_page()<br>    page.goto(<span class="hljs-string">&quot;http://whatsmyuseragent.org/&quot;</span>)<br>    page.screenshot(path=<span class="hljs-string">&quot;pictures/example.png&quot;</span>)<br>    browser.close()                                              <span class="hljs-comment"># 关闭浏览器对象</span><br></code></pre></td></tr></table></figure>



<h2 id="8-2-依赖环境配置"><a href="#8-2-依赖环境配置" class="headerlink" title="8-2 依赖环境配置"></a>8-2 依赖环境配置</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs Powershell">(base) D:\Program\Project\Python&gt; <span class="hljs-built_in">set</span> PLAYWRIGHT_BROWSERS_PATH=<span class="hljs-number">0</span><br>(base) D:\Program\Project\Python&gt; playwright install chromium<br>(base) D:\Program\Project\Python&gt; playwright install <span class="hljs-literal">--dry-run</span><br>browser: chromium version <span class="hljs-number">111.0</span>.<span class="hljs-number">5563.19</span><br>  Install location:    C:\Users\Admin\AppData\Roaming\Python\Python39\site<span class="hljs-literal">-packages</span>\...\chromium<span class="hljs-literal">-1048</span><br>  Download url:        https://playwright.azureedge.net/builds/chromium/<span class="hljs-number">1048</span>/chromium<span class="hljs-literal">-win64</span>.zip<br>  Download fallback <span class="hljs-number">1</span>: https://playwright<span class="hljs-literal">-akamai</span>.azureedge.net/builds/chromium/<span class="hljs-number">1048</span>/chromium<span class="hljs-literal">-win64</span>.zip<br>  Download fallback <span class="hljs-number">2</span>: https://playwright<span class="hljs-literal">-verizon</span>.azureedge.net/builds/chromium/<span class="hljs-number">1048</span>/chromium<span class="hljs-literal">-win64</span>.zip<br><br>browser: firefox version <span class="hljs-number">109.0</span><br>  Install location:    C:\Users\Admin\AppData\Roaming\Python\Python39\site<span class="hljs-literal">-packages</span>\...\firefox<span class="hljs-literal">-1378</span><br>  Download url:        https://playwright.azureedge.net/builds/firefox/<span class="hljs-number">1378</span>/firefox<span class="hljs-literal">-win64</span>.zip<br>  Download fallback <span class="hljs-number">1</span>: https://playwright<span class="hljs-literal">-akamai</span>.azureedge.net/builds/firefox/<span class="hljs-number">1378</span>/firefox<span class="hljs-literal">-win64</span>.zip<br>  Download fallback <span class="hljs-number">2</span>: https://playwright<span class="hljs-literal">-verizon</span>.azureedge.net/builds/firefox/<span class="hljs-number">1378</span>/firefox<span class="hljs-literal">-win64</span>.zip<br><br>browser: webkit version <span class="hljs-number">16.4</span><br>  Install location:    C:\Users\Admin\AppData\Roaming\Python\Python39\site<span class="hljs-literal">-packages</span>\...\webkit<span class="hljs-literal">-1792</span><br>  Download url:        https://playwright.azureedge.net/builds/webkit/<span class="hljs-number">1792</span>/webkit<span class="hljs-literal">-win64</span>.zip<br>  Download fallback <span class="hljs-number">1</span>: https://playwright<span class="hljs-literal">-akamai</span>.azureedge.net/builds/webkit/<span class="hljs-number">1792</span>/webkit<span class="hljs-literal">-win64</span>.zip<br>  Download fallback <span class="hljs-number">2</span>: https://playwright<span class="hljs-literal">-verizon</span>.azureedge.net/builds/webkit/<span class="hljs-number">1792</span>/webkit<span class="hljs-literal">-win64</span>.zip<br><br>browser: ffmpeg<br>  Install location:    C:\Users\Admin\AppData\Roaming\Python\Python39\site<span class="hljs-literal">-packages</span>\...\ffmpeg<span class="hljs-literal">-1008</span><br>  Download url:        https://playwright.azureedge.net/builds/ffmpeg/<span class="hljs-number">1008</span>/ffmpeg<span class="hljs-literal">-win64</span>.zip<br>  Download fallback <span class="hljs-number">1</span>: https://playwright<span class="hljs-literal">-akamai</span>.azureedge.net/builds/ffmpeg/<span class="hljs-number">1008</span>/ffmpeg<span class="hljs-literal">-win64</span>.zip<br>  Download fallback <span class="hljs-number">2</span>: https://playwright<span class="hljs-literal">-verizon</span>.azureedge.net/builds/ffmpeg/<span class="hljs-number">1008</span>/ffmpeg<span class="hljs-literal">-win64</span>.zip<br><br>(base) D:\Program\Project\Python&gt; pyinstaller <span class="hljs-operator">-F</span> files_pack.py<br>(base) D:\Program\Project\Python&gt; pyinstaller <span class="hljs-operator">-F</span> files_pack.py <span class="hljs-literal">-i</span> pictures/favicon.ico<br></code></pre></td></tr></table></figure>



              
            </div>
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/%E6%B5%8B%E8%AF%95%E6%A1%86%E6%9E%B6/" class="category-chain-item">测试框架</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/Python/">#Python</a>
      
        <a href="/tags/PlayWright/">#PlayWright</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>PlayWright 框架(二)</div>
      <div>https://stitch-top.github.io/2023/09/04/ce-shi-kuang-jia/tf05-playwright-kuang-jia-er/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>Dr.626</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2023年9月4日 21:10:10</div>
        </div>
      
      
      <div class="license-meta-item">
        <div>许可协议</div>
        <div>
          
            
            
              <a target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">
              <span class="hint--top hint--rounded" aria-label="BY - 署名">
                <i class="iconfont icon-by"></i>
              </span>
              </a>
            
              <a target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">
              <span class="hint--top hint--rounded" aria-label="NC - 非商业性使用">
                <i class="iconfont icon-nc"></i>
              </span>
              </a>
            
              <a target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">
              <span class="hint--top hint--rounded" aria-label="SA - 相同方式共享">
                <i class="iconfont icon-sa"></i>
              </span>
              </a>
            
          
        </div>
      </div>
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2023/07/09/ce-shi-kuang-jia/tf04-playwright-kuang-jia-yi/" title="PlayWright 框架(一)">
                        <span class="hidden-mobile">PlayWright 框架(一)</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  <article id="comments">
    
  <div id="valine"></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#valine', function() {
      Fluid.utils.createScript('https://cdn.staticfile.org/valine/1.5.1/Valine.min.js', function() {
        var options = Object.assign(
          {"appId":"bsRkWxXK7zLX6NWYygwknNXv-gzGzoHsz","appKey":"qqiNDCxGTOGVmiM1xAbd5pzk","path":"window.location.pathname","placeholder":"赠人玫瑰，手留余香(～o￣3￣)～","avatar":"retro","meta":["nick","mail","link"],"requiredFields":[],"pageSize":10,"lang":"zh-CN","highlight":"ture","recordIP":"ture","serverURLs":"","emojiCDN":null,"emojiMaps":null,"enableQQ":"ture"},
          {
            el: "#valine",
            path: window.location.pathname
          }
        )
        new Valine(options);
        Fluid.utils.waitElementVisible('#valine .vcontent', () => {
          var imgSelector = '#valine .vcontent img:not(.vemoji)';
          Fluid.plugins.imageCaption(imgSelector);
          Fluid.plugins.fancyBox(imgSelector);
        })
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


  </article>


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar category-bar" style="margin-left: -1rem">
    





<div class="category-list">
  
  
    
    
    
    <div class="category row nomargin-x">
      <a class="category-item 
          list-group-item category-item-action col-10 col-md-11 col-xm-11" title="测试框架"
        id="heading-893b664e5ce5fe8882ce6ce630f2f650" role="tab" data-toggle="collapse" href="#collapse-893b664e5ce5fe8882ce6ce630f2f650"
        aria-expanded="true"
      >
        测试框架
        <span class="list-group-count">(5)</span>
        <i class="iconfont icon-arrowright"></i>
      </a>
      
      <div class="category-collapse collapse show" id="collapse-893b664e5ce5fe8882ce6ce630f2f650"
           role="tabpanel" aria-labelledby="heading-893b664e5ce5fe8882ce6ce630f2f650">
        
        
          
  <div class="category-post-list">
    
    
      
      
        <a href="/2023/01/08/ce-shi-kuang-jia/tf01-selenium/" title="Selenium"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">Selenium</span>
        </a>
      
    
      
      
        <a href="/2023/03/03/ce-shi-kuang-jia/tf02-pytest-ce-shi-kuang-jia/" title="Pytest 测试框架"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">Pytest 测试框架</span>
        </a>
      
    
      
      
        <a href="/2023/05/01/ce-shi-kuang-jia/tf03-allure-ce-shi-bao-gao/" title="Allure 测试报告"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">Allure 测试报告</span>
        </a>
      
    
      
      
        <a href="/2023/07/09/ce-shi-kuang-jia/tf04-playwright-kuang-jia-yi/" title="PlayWright 框架(一)"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">PlayWright 框架(一)</span>
        </a>
      
    
      
      
        <a href="/2023/09/04/ce-shi-kuang-jia/tf05-playwright-kuang-jia-er/" title="PlayWright 框架(二)"
           class="list-group-item list-group-item-action
           active">
          <span class="category-post">PlayWright 框架(二)</span>
        </a>
      
    
  </div>

        
      </div>
    </div>
  
</div>


  </aside>


    </div>
  </div>
</div>





  



  



  



  



  






    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a><span>Copyright © 2021 - 2023</span></a> <i class="iconfont icon-love"></i> <a href="https://stitch-top.github.io" target="_blank" rel="nofollow noopener"><span>Dr.626</span></a> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="busuanzi_container_site_pv" style="display: none">
        总访问量 
        <span id="busuanzi_value_site_pv"></span>
         次
      </span>
    
    
      <span id="busuanzi_container_site_uv" style="display: none">
        总访客数 
        <span id="busuanzi_value_site_uv"></span>
         人
      </span>
    
    
  
</div>

  
  
  
  
  <!-- 添加网站运行时间 -->
  <div class="footer-content">
    <div>
      <span id="timeDate">载入天数...</span>
      <span id="times">载入时分秒...</span>
      <script>
      var now = new Date();
      function createtime(){
          var grt= new Date("01/01/2021 00:00:00");   //此处修改你的建站时间或者网站上线时间
          now.setTime(now.getTime()+250);
          days = (now - grt ) / 1000 / 60 / 60 / 24;
          dnum = Math.floor(days);
          hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum);
          hnum = Math.floor(hours);
          if(String(hnum).length ==1 ){
              hnum = "0" + hnum;
          }
          minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum);
          mnum = Math.floor(minutes);
          if(String(mnum).length ==1 ){
                    mnum = "0" + mnum;
          }
          seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);
          snum = Math.round(seconds);
          if(String(snum).length ==1 ){
                    snum = "0" + snum;
          }
          document.getElementById("timeDate").innerHTML = "本站已安全运行&nbsp"+dnum+"&nbsp天";
          document.getElementById("times").innerHTML = hnum + "&nbsp小时&nbsp" + mnum + "&nbsp分&nbsp" + snum + "&nbsp秒";
      }
      setInterval("createtime()", 250);
      </script>
    </div>
  </div>
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://cdn.staticfile.org/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.staticfile.org/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.staticfile.org/jquery/3.7.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  

  

  

  

  

  

  




  
    
      <script  src="/js/img-lazyload.js" ></script>
    
  




  
<script>
  Fluid.utils.createScript('https://cdn.staticfile.org/tocbot/4.21.0/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      headingSelector : CONFIG.toc.headingSelector || 'h1,h2,h3,h4,h5,h6',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      collapseDepth   : CONFIG.toc.collapseDepth || 0,
      scrollSmooth    : true,
      headingsOffset  : -boardTop
    });
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }
  });
</script>


  <script>
  (function() {
    var enableLang = CONFIG.code_language.enable && CONFIG.code_language.default;
    var enableCopy = CONFIG.copy_btn;
    if (!enableLang && !enableCopy) {
      return;
    }

    function getBgClass(ele) {
      return Fluid.utils.getBackgroundLightness(ele) >= 0 ? 'code-widget-light' : 'code-widget-dark';
    }

    var copyTmpl = '';
    copyTmpl += '<div class="code-widget">';
    copyTmpl += 'LANG';
    copyTmpl += '</div>';
    jQuery('.markdown-body pre').each(function() {
      var $pre = jQuery(this);
      if ($pre.find('code.mermaid').length > 0) {
        return;
      }
      if ($pre.find('span.line').length > 0) {
        return;
      }

      var lang = '';

      if (enableLang) {
        lang = CONFIG.code_language.default;
        if ($pre[0].children.length > 0 && $pre[0].children[0].classList.length >= 2 && $pre.children().hasClass('hljs')) {
          lang = $pre[0].children[0].classList[1];
        } else if ($pre[0].getAttribute('data-language')) {
          lang = $pre[0].getAttribute('data-language');
        } else if ($pre.parent().hasClass('sourceCode') && $pre[0].children.length > 0 && $pre[0].children[0].classList.length >= 2) {
          lang = $pre[0].children[0].classList[1];
          $pre.parent().addClass('code-wrapper');
        } else if ($pre.parent().hasClass('markdown-body') && $pre[0].classList.length === 0) {
          $pre.wrap('<div class="code-wrapper"></div>');
        }
        lang = lang.toUpperCase().replace('NONE', CONFIG.code_language.default);
      }
      $pre.append(copyTmpl.replace('LANG', lang).replace('code-widget">',
        getBgClass($pre[0]) + (enableCopy ? ' code-widget copy-btn" data-clipboard-snippet><i class="iconfont icon-copy"></i>' : ' code-widget">')));

      if (enableCopy) {
        Fluid.utils.createScript('https://cdn.staticfile.org/clipboard.js/2.0.11/clipboard.min.js', function() {
          var clipboard = new window.ClipboardJS('.copy-btn', {
            target: function(trigger) {
              var nodes = trigger.parentNode.childNodes;
              for (var i = 0; i < nodes.length; i++) {
                if (nodes[i].tagName === 'CODE') {
                  return nodes[i];
                }
              }
            }
          });
          clipboard.on('success', function(e) {
            e.clearSelection();
            e.trigger.innerHTML = e.trigger.innerHTML.replace('icon-copy', 'icon-success');
            setTimeout(function() {
              e.trigger.innerHTML = e.trigger.innerHTML.replace('icon-success', 'icon-copy');
            }, 2000);
          });
        });
      }
    });
  })();
</script>


  
<script>
  Fluid.utils.createScript('https://cdn.staticfile.org/anchor-js/5.0.0/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));
  });
</script>


  
<script>
  Fluid.utils.createScript('https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="https://cdn.staticfile.org/busuanzi/2.3.0/busuanzi.pure.mini.js" ></script>




  
<script src="/js/snow.js"></script>



<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/assets/tororo.model.json"},"display":{"position":"right","width":180,"height":230},"mobile":{"show":false,"scale":0.3},"rect":{"opacityDefault":0.7,"opacityHover":1},"log":false});</script></body>
</html>
